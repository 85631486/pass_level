## 1. 文档概述

- **项目名称**：过关斩将-游戏教学平台 2.0  
- **定位**：将高校课程拆解为“关卡任务”，以游戏化机制驱动教学。  
- **服务对象**：课程教师、学生、教务/运营人员、系统管理员。  
- **编写目标**：基于既有概要、详细、学生端/教师端方案等文档，形成一份结构完整的一体化设计蓝本，指导后续产品、研发与运营协作。  
- **参考来源**：`参考/过关斩将平台概要设计.md`、`系统详细设计.md`、`功能详细设计.md`、学生/教师端方案、社交协作、数据分析增强说明、实现进度总结与工程映射等。

## 2. 平台愿景与目标

- **教学效果**：通过任务颗粒化、即时反馈与数据追踪，提升课堂完成率与学习质量。  
- **沉浸体验**：以 RPG 式关卡、角色成长、剧情故事线，增强 00 后学生的学习动机。  
- **AI辅助设计**：为教师提供AI助教工具，协助设计关卡任务、生成知识技能卡片，提升设计效率。  
- **数据驱动**：沉淀学生画像、预警策略、AB 测试能力，支撑持续优化和教务决策。  
- **可演进架构**：前后端解耦、模块化服务、配置化激励，便于未来扩展 AI、赛季活动等高阶能力。

## 3. 角色与核心诉求

| 角色 | 关键诉求 | 典型能力 |
| --- | --- | --- |
| 教师 | 设计游戏关卡和任务、配置知识技能卡片、AI辅助设计、查看学习数据、评阅任务 | 关卡任务工坊、AI助教、知识卡片/技能卡片配置、可见性管理、任务评阅、数据分析、学生画像 |
| 学生 | 顺序闯关、学习知识技能、完成任务答题、查看排名、兑换奖励 | 等级技能树、过关地图、关卡学习、任务提交、答题闯关、积分商城、总排名 |
| 教务/运营 | 模板沉淀、活动策划、质量监控、风险预警 | 模板中心、活动策划器、画像与预警、AB 测试 |
| 系统管理员 | 安全合规、资源审核、权限管控、集成配置 | 用户/角色、权限矩阵、审核与日志、统一认证 |

## 4. 整体架构与技术栈

### 4.1 逻辑分层

```
┌───────────────────────────────────────────┐
│              终端体验层                   │
│  学生端 H5/小程序 · 教师端 Web · 管理端   │
└───────────────▲─────────────────────────┘
                │
┌───────────────┴─────────────────────────┐
│              接口与服务层                │
│  Flask REST API · WebSocket ·           │
│  APScheduler 任务 · 判题/奖励/分析服务   │
│  AI助手服务（阿里千问模型）              │
└───────────────▲─────────────────────────┘
                │
┌───────────────┴─────────────────────────┐
│              数据与存储层                │
│  SQLite/MySQL · Redis · 对象存储 · BI    │
└──────────────────────────────────────────┘
```

- **前端**：Vue3 + TypeScript + Vite + Pinia，支持 PWA、响应式布局与 WebSocket 实时推送。  
- **后端**：Flask + SQLAlchemy 分层（API/Service/DAO），提供篇章、关卡、任务、题库、激励、社交、分析等模块化服务。  
- **AI助手**：集成阿里千问模型（通义千问），通过后台配置文件配置 API Key（sk），为教师端和学生端提供AI辅助功能。  
- **数据库**：开发阶段 SQLite，预留迁移至 MySQL/PostgreSQL；JSON1 扩展承载脚本、奖励配置等半结构化数据。  
- **缓存/实时**：Redis（排行榜、会话、验证码、限流）、WebSocket（实时排名推送、通知）。  
- **文件与媒体**：对象存储（MinIO/OSS）管理视频、提交物、战报、剧情资源。  
- **分析与日志**：ClickHouse/Superset 或 ELK，用于指标埋点、课堂战报、审计日志。

### 4.2 部署与环境

- **本地/试点**：Nginx + Flask 开发服务器 + SQLite，静态资源由 Nginx 提供，媒体保存在 `storage/`。  
- **生产建议**：Nginx + Gunicorn + Flask，数据库升级为 PostgreSQL，Redis 主从，文件接入云存储，接入校方统一身份认证。  
- **目录约定**：`/backend`（Flask），`/frontend`（Vue），`/storage/uploads`（提交物），`/storage/media`（视频/剧情），`/data/ggzj.db`（数据库），`/backend/config/ai_config.yaml`（AI助手配置文件，包含阿里千问 API Key）。  
- **CI/CD**：GitHub Actions/GitLab CI 执行 lint、测试、构建、镜像发布；环境变量管理密钥、第三方网关等配置。

### 4.3 非功能性要求

- **性能**：课堂高峰支持 500+ 并发学生闯关，关键接口 <2 秒，排行榜/直播采用增量推送。  
- **可用性**：任务与提交物 7×24 可用，数据库与对象存储按日备份，支持断点续传与前端离线缓存。  
- **安全**：JWT + 刷新 token、角色+课程范围的 ABAC 控制、CSRF 防护、文件上传校验、操作审计。  
- **可扩展性**：各模块以 Service 模式解耦，激励/道具/活动配置化，预留 AI 辅助与消息队列对接能力。

### 4.4 核心数据对象

- **篇章与关卡**：`chapters`（篇章，相当于原课程概念）、`levels`（关卡）、`level_maps`（过关地图配置），包含地图 JSON、关卡顺序关系、宝箱配置。  
- **任务与知识技能**：`tasks`、`task_resources`、`task_phases`（任务环节）、`task_steps`（任务步骤）、`task_phase_question_rel`（环节与闯关考题关联关系）、`task_question_rel`、`knowledge_cards`（知识卡片）、`skill_cards`（技能卡片）、`task_knowledge_rel`、`task_skill_rel`、`task_layout_configs`（关卡界面布局配置）。  
- **学生记录**：`student_task_records`、`student_task_phase_records`（学生任务环节记录）、`submissions`（环节步骤提交）、`student_level_progress`（关卡进度）、`student_level_scores`（关卡得分记录，支持重试）、`student_total_scores`（总得分与排名）。  
- **激励与成长**：`rewards`、`student_profiles`、`student_inventory`、`skill_nodes`、`student_skills`、`treasure_chests`（宝箱配置）、`point_mall`（积分商城）、`point_mall_items`（商城商品）、`student_points`（学生积分余额）、`point_transactions`（积分交易记录）。  
- **社交协作**：`level_learners`（关卡学习同学列表）、`achievements`（成就系统）。  
- **分析与运营**：`analytics_metrics`、`gamification_metrics`、`student_portraits`、`alert_rules`、`ab_tests`、`events`、`ai_assistant_logs`（AI助教交互日志）。  
- **系统管理**：`users`、`roles`、`permissions`、`admin_audit_logs`、`notification_channels` 等。

## 5. 关键业务流程

1. **篇章与关卡设计**：教师新建篇章 → 在篇章下打开地图编辑器 → **AI助理协助自动生成鱼骨图**（或手动设计）→ 使用鱼骨图设计关卡，生成关卡树（学习路径）→ 点击关卡进入关卡编辑页面 → **AI助理协助自动生成关卡任务**（或手动设置）→ **AI助理协助自动生成知识卡片和技能卡片**（或手动配置）→ **AI助理协助自动生成任务操作环节步骤**（或手动设置）→ 设置环节与闯关考题的关联关系（任务环节必须做完后才能做题，此关联关系可由教师设定）→ **编辑闯关考题（AI助理协助自动生成考题）** → 配置关卡界面布局（图文、视频）→ 设置关卡可见性 → 预览保存为草稿或模板 → 发布关卡。  
2. **关卡发布与可见性管理**：教师设置关卡可见性（可见/隐藏）→ 学生端根据可见性显示可闯关的关卡 → 教师可随时调整可见性状态。  
3. **学生闯关闭环**：学生登录后查看等级和技能树 → 进入过关地图（关卡树样式，显示关卡节点、宝箱、同学名单）→ 按顺序解锁关卡（跳关需使用道具）→ 进入关卡：查看任务 → 学习知识卡片和技能卡片（支持图文、视频）→ 按任务环节步骤顺序进行操作，提交每个环节步骤的操作结果 → 完成所有任务环节后（根据教师设定的关联关系）→ 进行闯关考题答题 → 系统计算任务环节得分+答题得分，≥60分解锁下一关，<60分可重新学习过关 → 获得积分奖励 → 累计得分计入总排名。  
4. **评分与反馈**：客观题自动判题 → 主观题/任务提交进入批改工作流，AI辅助评分 → 教师使用 Rubric/批注/语音反馈进行评阅 → 系统合成任务得分和答题得分，计算总分（≥60分解锁下一关）→ 学生可查看得分详情，对分数不满意可重新学习过关 → 累计得分更新总排名。  
5. **激励与积分商城**：关卡通过后获得积分奖励 → 开启地图上的宝箱获得道具/积分/礼品 → 积分累计可用于积分商城兑换道具和礼品 → 关卡得分累加形成总排名。  
6. **数据分析与画像**：行为日志与任务数据写入指标仓 → 画像定时任务计算学生能力维度与风险等级 → 教师仪表盘查看学生学习情况、统计分析、学生画像 → 查看关卡完成率、得分分布、总排名等数据。  
7. **运营活动**：运营人员在活动策划器配置主题活动、奖励池 → 审核发布 → 自动同步至学生端 → 结束后结算并沉淀模板。

## 6. 功能模块设计

### 6.1 教师端：篇章与关卡设计工坊

- **篇章管理**：篇章列表（由多个关卡组成，相当于原课程概念）、新建篇章、编辑篇章、篇章共享与模板化。  
- **过关地图编辑器**：在篇章下打开地图编辑器，**AI助理协助自动生成鱼骨图**（根据篇章主题、知识点等自动生成关卡主干与分支），或手动使用鱼骨图方式设计关卡，构建层级清晰的学习路径。支持拖拽节点、添加/删除关卡节点、配置主干与分支关系、设置关卡顺序、在指定关卡设置宝箱（道具/积分/礼品）、配置宝箱奖励内容、地图预览。鱼骨图支持展开/折叠、缩放、节点样式自定义。  
- **关卡编辑页面**：点击关卡节点进入关卡编辑页面，在此页面统一配置关卡的所有内容：
  - **任务设置**：**AI助理协助自动生成关卡任务**（根据关卡主题、知识点等自动生成任务描述、任务目标），或手动创建任务、编辑任务基本信息、任务描述、任务目标。
  - **学习卡片和技能卡片配置**：**AI助理协助自动生成知识卡片和技能卡片**（根据任务内容自动生成知识点和技能点），或手动为任务配置知识卡片（学习知识点）和技能卡片（掌握的技能），支持卡片内容编辑、排序、关联。
  - **任务操作环节步骤设置**：**AI助理协助自动生成任务操作环节步骤**（根据任务内容自动生成环节和步骤），或手动为任务设置多个操作环节，每个环节可包含多个步骤。配置环节名称、步骤内容、操作要求、提交项类型（文本/文件/链接等）、提交项校验规则、是否必做、环节顺序。学生需按环节步骤顺序进行操作，提交每个环节步骤的操作结果。
  - **环节与闯关考题关联设置**：设置任务环节与闯关考题的关联关系，可设定哪些环节必须完成后才能进行闯关考题答题。支持灵活配置关联规则（如：所有环节完成、指定环节完成、环节完成度达到阈值等）。
  - **闯关考题配置（最后一步）**：**AI助理协助自动生成闯关考题**（根据关卡内容、知识点、技能点等自动生成题目），或手动创建/编辑闯关考题，设置通过条件、评分权重。题目自动保存到题库（从关卡中自动提取）。
  - **关卡界面布局配置**：配置关卡界面布局（图文混排、视频播放位置等）。
  - **关卡其他设置**：关卡基本信息、关卡顺序设置（是否允许跳关，跳关所需道具）、可见性设置、评分权重等。
- **AI助教**：基于阿里千问模型（通义千问）的AI助手，在关卡设计和编辑全流程中提供协助：
  - **自动生成鱼骨图**：根据篇章主题、知识点等自动生成关卡主干与分支
  - **自动生成关卡任务**：根据关卡主题、知识点等自动生成任务描述和目标
  - **自动生成知识卡片和技能卡片**：根据任务内容自动生成知识点和技能点
  - **自动生成环节步骤**：根据任务内容自动生成操作环节和步骤
  - **自动生成闯关考题**：根据关卡内容、知识点、技能点等自动生成题目
  - 提供任务设计建议、优化关卡难度和流程
  - AI配置通过后台配置文件管理（API Key等）。  
- **可见性管理**：设置关卡是否可见，控制学生端显示哪些可闯关的关卡。  
- **版本与模板**：关卡历史版本回滚、复制到其他篇章、公共模板库。  
- **预览与试玩**：以学生视角快速走查流程，预览关卡界面布局效果。

### 6.2 教师端：数据分析与任务评阅

- **学生学习情况查看**：查看学生关卡完成情况、得分分布、学习进度、总排名、学习时长等统计数据。  
- **统计分析**：关卡完成率分析、得分分布统计、知识点掌握情况、技能树成长分析、学习路径分析、时间分布分析。  
- **学生画像**：多维度学生画像展示（学习能力、活跃度、风险等级等）、雷达图、风险指示器、行为时间轴、个性化建议。  
- **任务评阅**：查看学生提交的任务和答题情况、AI辅助评分（提供评分建议）、教师手动评阅（Rubric评分、批注、语音/图文点评）、评分结果确认、支持学生重新学习过关后的再次评阅。  
- **积分商城管理**：配置积分商城商品（道具、礼品）、设置兑换所需积分、商品库存管理、兑换记录查看。

### 6.3 学生端：等级技能树与过关地图

- **首页**：学生登录后首先看到自己的等级和技能树，展示当前等级、经验值、已掌握的技能节点、技能树可视化（雷达图或树状图）。  
- **过关地图**：关卡树样式的地图展示（基于鱼骨图），显示关卡节点（已通过/进行中/未解锁状态）、主干与分支层级、关卡顺序连线、宝箱位置（可开启/已开启）、地图上显示一起学习的同学名单（头像或昵称）、地图缩放与导航、鱼骨图展开/折叠。  
- **关卡顺序规则**：关卡必须按顺序通过，不能跳关；如需跳关需使用跳关道具；已通过的关卡可重新学习（对分数不满意时）。  
- **关卡学习流程**：进入关卡 → 查看任务说明 → 学习知识卡片（图文、视频支持）→ 学习技能卡片 → 按任务环节步骤顺序进行操作：查看环节步骤要求 → 完成操作 → 提交当前环节步骤的操作结果（支持草稿保存、多附件上传）→ 继续下一个环节步骤 → 完成所有任务环节（根据教师设定的关联关系）→ 进行闯关考题答题（客观题自动判分，主观题待教师评阅）→ 系统计算任务环节得分+答题得分，≥60分解锁下一关并累计总得分，<60分可重新学习过关。  
- **关卡界面**：支持图文并茂、视频播放，界面布局由教师端配置（图文混排位置、视频播放区域等）。  
- **AI学习助手**：基于阿里千问模型（通义千问）的AI助手，在学习过程中为学生提供学习指导、知识点解释、答题提示、学习建议等辅助功能，帮助学生更好地理解和掌握知识。AI配置通过后台配置文件管理（API Key等）。  
- **宝箱系统**：地图上教师指定关卡设置的宝箱可开启，获得教师配置的道具、积分或礼品。  
- **总排名**：每个关卡的得分会累加，形成总得分和总排名，实时更新。  
- **积分商城**：使用过关获得的积分在积分商城兑换道具和礼品，查看积分余额、兑换记录。

### 6.4 题库与判题

- **题库自动提取**：题库不是独立管理的，而是从各个关卡中自动提取出来的。教师在关卡编辑页面的最后一步编辑闯关考题时，所有创建的题目会自动保存到题库中，并关联到对应关卡。题库按篇章/关卡/知识点/难度/标签自动分类管理。  
- **题库查看与管理**：教师可查看从所有关卡中自动提取的题目，按篇章/关卡/知识点/难度/标签筛选查看，支持题目编辑、删除、复用（将题目复制到其他关卡）。  
- **题目导入导出**：Excel/QTI 模板导入，按筛选条件导出。  
- **判题引擎**：客观题自动判分、主观题待批阅队列、Rubric评分、语音评语、AI 辅助批改扩展、编程题沙箱接口。  
- **题目分析**：正确率、区分度、难度、引用关系，支持教师优化与题库维护。  
- **接口**：`questions` 自动提取和关联、`task_question_rel` 绑定、`/assessments/grade` 判分、`/subjective-reviews` 批改。

### 6.5 激励、成长与积分商城

- **关卡得分与排名**：每个关卡的任务得分+答题得分累加形成总得分，总排名实时更新，支持按总得分、关卡完成数等多维度排序。  
- **等级与技能树**：`skill_nodes` + `skill_relations` 定义技能树，`student_skills` 存储等级、经验，学生通过关卡学习技能卡片提升技能等级。  
- **宝箱系统**：`treasure_chests` 配置宝箱位置和奖励内容（道具/积分/礼品），学生开启宝箱获得奖励。  
- **积分系统**：关卡通过获得积分奖励，积分累计存储在 `student_points`，积分交易记录在 `point_transactions`。  
- **积分商城**：`point_mall` 和 `point_mall_items` 管理商城商品，学生使用积分兑换道具和礼品，支持商品分类、库存管理、兑换记录查询。  
- **道具系统**：道具包括跳关道具、提示卡、时间冻结等，可通过积分商城兑换或宝箱获得。

### 6.6 数据分析、画像与预警

- **学生画像系统**：学习能力、协作度、活跃度、风险等级等多维度评估，雷达图、风险指示器、行为时间轴、个性化建议。  
- **预警策略引擎**：未登录、任务失败、战斗力下滑、协作异常、活跃度下降等规则，冷却与通知策略、处理流转。  
- **AB 测试框架**：实验管理、分组策略（随机/哈希/平衡）、指标记录与显著性分析、报告输出。  
- **仪表盘**：篇章/关卡完成率、用时、任务漏斗、知识点薄弱、总排名、技能增长、道具使用、积分商城兑换、活动参与。  
- **接口与定时任务**：画像每日计算、预警每小时评估、AB 指标聚合、`/analytics/*` 导出、`/alerts` 处理、`/abtest` 管理。

### 6.7 系统管理与运营支持

- **用户/角色/权限**：RBAC + 篇章范围授权、运营精细权限、第三方账号绑定。  
- **资源审核与日志**：课程/任务资源、剧情脚本、题目等上线审核；奖励/活动调整二次确认与回滚；`admin_audit_logs` 审计。  
- **统一认证与集成**：校园 SSO、教务课表/成绩同步、消息通道配置、第三方推送。  
- **参数与配置**：奖励系数、活动主题、系统公告、运营位、通知策略、AI助手配置（阿里千问 API Key、模型参数等，通过配置文件管理）。  
- **监控与告警**：系统健康监控、API 限流、日志采集、异常通报。

## 7. 数据与接口设计概览

### 7.1 重要数据表分组

- **教学核心**：`chapters`（篇章）、`levels`（关卡）、`level_maps`（过关地图）、`tasks`、`task_steps`、`task_resources`、`knowledge_cards`（知识卡片）、`skill_cards`（技能卡片）、`task_knowledge_rel`、`task_skill_rel`、`task_layout_configs`（关卡界面布局配置）、`level_visibility`（关卡可见性设置）。  
- **评测与提交**：`questions`、`task_question_rel`、`submissions`、`submission_drafts`、`student_task_records`、`student_level_scores`（关卡得分记录，支持重试）、`student_total_scores`（总得分与排名）、`task_reviews`（任务评阅记录，包含AI辅助评分建议）。  
- **激励成长**：`rewards`、`student_profiles`、`skill_nodes`、`student_skills`、`items`、`student_inventory`、`treasure_chests`（宝箱配置）、`point_mall`（积分商城）、`point_mall_items`（商城商品）、`student_points`（学生积分余额）、`point_transactions`（积分交易记录）。  
- **社交运营**：`level_learners`（关卡学习同学列表）、`achievements`（成就系统）、`events`、`event_tasks`。  
- **分析与预警**：`analytics_metrics`、`gamification_metrics`、`student_portraits`、`alert_rules`、`alert_records`、`ab_tests`、`ab_test_results`、`ai_assistant_logs`（AI助教交互日志）。  
- **系统管理**：`users`、`roles`、`permissions`、`notification_channels`、`admin_audit_logs`。

### 7.2 接口分层

- **认证**：`POST /auth/login|refresh|logout`，SSO 对接入口。  
- **篇章/关卡/任务**：`GET/POST /chapters`、`/chapters/{id}/levels`、`GET /chapters/{id}/map`（获取地图配置）、`PUT /chapters/{id}/map`（更新地图配置，鱼骨图设计）、`GET /levels/{id}`（关卡详情，用于关卡编辑页面）、`PUT /levels/{id}`（更新关卡）、`POST /levels/{id}/visibility`（设置可见性）、`GET/POST /levels/{id}/tasks`（任务管理）、`GET/POST /tasks/{id}/phases`（任务环节管理）、`GET/POST /tasks/{id}/phases/{phase_id}/steps`（环节步骤管理）、`GET/POST /tasks/{id}/knowledge-cards`、`GET/POST /tasks/{id}/skill-cards`、`PUT /tasks/{id}/layout-config`、`PUT /tasks/{id}/phase-question-relation`（设置环节与闯关考题关联关系）、`POST /levels/{id}/treasure-chests`（在指定关卡设置宝箱）、`POST /ai-assistant/design-task`（AI助教设计任务，基于阿里千问）、`POST /ai-assistant/generate-cards`（AI生成知识/技能卡片，基于阿里千问）、`POST /ai-assistant/generate-phases`（AI生成环节步骤建议，基于阿里千问）。
- **学生端**：`GET /students/{id}/profile`（等级和技能树）、`/students/{id}/level-map`（过关地图，关卡树样式）、`/levels/{id}/detail`（关卡详情，包含任务、知识卡片、技能卡片、环节步骤）、`GET /tasks/{id}/phases`（获取任务环节列表）、`GET /tasks/{id}/phases/{phase_id}/steps`（获取环节步骤列表）、`POST /tasks/{id}/phases/{phase_id}/steps/{step_id}/submit`（提交环节步骤操作结果）、`GET /tasks/{id}/phases/{phase_id}/steps/{step_id}/status`（查询环节步骤完成状态）、`GET /tasks/{id}/can-take-exam`（检查是否可以答题，根据环节关联关系）、`POST /levels/{id}/assessments/submit`（答题提交）、`GET /levels/{id}/learners`（关卡学习同学列表）、`GET /students/{id}/total-score`（总得分和排名）、`POST /levels/{id}/retry`（重新学习过关）、`POST /treasure-chests/{id}/open`（开启宝箱）、`GET /point-mall`（积分商城）、`POST /point-mall/exchange`（积分兑换）、`POST /ai-assistant/learning-help`（AI学习助手，基于阿里千问，提供学习指导、知识点解释、答题提示等）。  
- **激励/排名**：`GET /leaderboards/total-scores`（总排名）、`WS /leaderboards/live`（实时排名推送）、`POST /rewards/use-item`（使用道具，如跳关道具）。  
- **活动与运营**：`POST /events`、`/events/{id}/publish`、`/daily-quests`、`/season-quests`、`/reward-pools`。  
- **分析与评阅**：`GET /analytics/chapters/{id}/overview`（篇章学习情况）、`/analytics/students/{id}/report`（学生报告）、`/analytics/students/{id}/portrait`（学生画像）、`/analytics/levels/{id}/statistics`（关卡统计分析）、`GET /tasks/{id}/submissions`（待评阅任务列表）、`POST /tasks/{id}/reviews`（任务评阅，包含AI辅助评分）、`GET /ai-assistant/score-suggestion`（AI评分建议，基于阿里千问）。  
- **系统管理**：`/admin/users|roles|permissions`、`/resource-audit`、`/config/notifications`、`/admin/point-mall`（积分商城管理）、`GET/POST /admin/ai-config`（AI助手配置管理，配置阿里千问 API Key等）。

### 7.3 后台定时与异步

- **画像计算**（每日凌晨）：更新能力维度与风险等级。  
- **预警评估**（每小时）：遍历规则触发通知。  
- **AB 测试聚合**（每小时）：刷新实验指标。  
- **活动调度**：定时开启/关闭活动任务、每日任务刷新。  
- **排行榜快照**：赛季结束或课堂结束时写入 `leaderboard_snapshots`。  
- **备份与清理**：数据库备份、过期通知/草稿清理、长时间未提交的草稿提醒。

## 8. 实施现状与里程碑

### 8.1 已完成功能（参考实现进度总结）

- **基础架构**：Flask 后端、Vue3 前端、SQLAlchemy 模型、WebSocket 通道、认证与权限基础、阿里千问AI助手集成。  
- **教师端**：篇章与关卡设计工坊、过关地图编辑器、AI助教、知识卡片/技能卡片配置、关卡可见性管理、任务评阅（含AI辅助评分）、数据分析与学生画像。  
- **学生端**：等级技能树首页、过关地图（消消乐样式）、关卡顺序闯关、知识卡片/技能卡片学习、AI学习助手（基于阿里千问）、任务提交与答题、关卡得分累加与总排名、宝箱系统、积分商城。  
- **社交协作**：关卡学习同学列表展示。  
- **数据模型与接口**：覆盖课程、任务、激励、社交、分析、题库、判题、画像、预警、AB 测试等。  
- **数据分析增强**：学生画像、预警引擎、AB 测试框架、仪表盘增强、调度任务。  
- **测试与脚本**：基础 API 测试、scheduler 脚本、初始化脚本等。

### 8.2 待完善工作

- 系统管理：权限矩阵 UI、资源审核流、审计报表。  
- 更全面的自动化测试与性能压测。  
- 生产级监控、日志与告警方案。  
- AI 辅助批改/题目生成、消息队列集成、移动端封装等高级能力。

### 8.3 推进建议

1. **MVP 验证**：优先生产篇章-关卡-任务-答题闭环 + 顺序闯关 + 积分商城 + 数据看板。  
2. **原型输出**：基于本设计完成教师/学生端关键页面中高保真原型。  
3. **试点篇章**：选取 1-2 个篇章运行，收集对关卡设计、知识技能卡片、积分商城、AI助教的反馈。  
4. **模板沉淀**：将优秀篇章、关卡设计、知识技能卡片配置沉淀到模板中心，降低教师设计成本。  
5. **分阶段迭代**：关卡任务闭环 → 顺序闯关/积分商城 → 数据分析/画像 → AI助教增强 → 扩展生态。

## 9. 测试、运维与风险

- **测试体系**：Pytest 单元/服务层测试 ≥80% 覆盖；HTTPX 接口测试；Cypress 前端 E2E；Locust 压测排行榜/提交接口；可视化冒烟脚本。  
- **运维策略**：灰度发布、课堂高峰前健康检查、实时监控 WebSocket 连接、定期备份数据库与对象存储。  
- **风险与应对**：  
  - 高并发课堂导致排行榜延迟 → Redis + WebSocket 增量推送 + 降级为轮询。  
  - 激励配置误操作 → 配置审批、版本回滚。  
  - 任务/题库泄密 → 权限隔离、访问日志、题目随机化。  
  - 社交内容不当 → 审核机制、关键词过滤、举报与追溯。  
  - 数据一致性 → 奖励、提交、战斗判定等核心流程使用事务并记录幂等键。

## 10. 未来扩展方向

- **数据层升级**：迁移 PostgreSQL、引入列式数仓或湖仓，用于大规模画像与日志分析。  
- **消息驱动架构**：接入 RabbitMQ/Kafka 处理通知、奖励、活动事件，降低耦合。  
- **AI 能力增强**：AI助教功能扩展（任务设计优化、知识技能卡片智能生成）、AI辅助评分精度提升、难度自适应推荐、情绪识别与干预。  
- **多端适配**：H5 基础上封装小程序/APP，接入课堂大屏与投影，提供 VR/AR 副本体验。  
- **开放生态**：第三方课程/任务市场、插件化激励组件、校园赛事联赛、跨校排行榜。


