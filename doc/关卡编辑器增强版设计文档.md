# 关卡编辑器增强版设计文档

**版本**: 2.0 Enhanced
**创建时间**: 2025-12-03
**设计目标**: 打造更友好、更强大、支持 Markdown 的响应式关卡编辑系统

---

## 🎯 设计理念

### 核心改进
1. **Markdown 全面支持** - 所有文本输入支持 Markdown 格式
2. **响应式设计** - 完美适配桌面端、平板和移动端
3. **现代化交互** - 流畅的动画和直观的操作流程
4. **可视化增强** - 卡片式布局和网格/列表切换
5. **实时反馈** - 即时保存和状态提示

---

## 📦 新增组件

### 1. MarkdownEditor.vue - 强大的 Markdown 编辑器

**功能特性：**
- ✏️ **三种模式**：
  - 编辑模式（纯编辑）
  - 分屏模式（编辑+预览）
  - 预览模式（纯预览）

- 🛠️ **工具栏功能**：
  - 标题快捷插入（H1, H2）
  - 文本格式（粗体、斜体、行内代码）
  - 列表（有序、无序、引用）
  - 代码块、表格
  - 链接和图片
  - 全屏模式

- ⌨️ **快捷键支持**：
  - Tab 键插入缩进
  - Ctrl/Cmd + B 加粗
  - Ctrl/Cmd + I 斜体

- 🎨 **渲染样式**：
  - 代码语法高亮（深色主题）
  - 表格样式
  - 引用块样式
  - 链接悬停效果
  - 图片圆角和阴影

**使用示例：**
```vue
<MarkdownEditor
  v-model="content"
  height="400px"
  placeholder="输入 Markdown 内容..."
/>
```

---

### 2. EnhancedTaskConfigPanel.vue - 增强的任务配置面板

**新增特性：**

#### 视图切换
- **网格视图** ⊞：卡片式布局，视觉效果更好
- **列表视图** ☰：紧凑布局，信息密度更高

#### 卡片设计
```
┌─────────────────────────────────┐
│ ✅ 任务名称              ✏️ 🗑️  │
├─────────────────────────────────┤
│ 任务描述（Markdown 渲染）        │
│                                 │
│ 🎯 任务目标                      │
│   • 学习目标 1                   │
│   • 学习目标 2                   │
├─────────────────────────────────┤
│ ID: 123        [✓ 已选中]       │
└─────────────────────────────────┘
```

#### 空状态设计
- 友好的空白状态提示
- 引导用户使用 AI 生成或手动创建

#### 编辑对话框
- 宽屏模式（900px）
- 集成 MarkdownEditor
- 实时字符统计

---

### 3. LevelEditorEnhanced.vue - 全新关卡编辑主页面

**布局结构：**

```
┌────────────────────────────────────────────────┐
│  ☰ ← 返回  关卡名称 [草稿]      💾 📢        │ 顶部导航栏
├──────┬─────────────────────────────────────────┤
│      │                                         │
│  📝  │                                         │
│  ✅  │         内容区域                         │
│  📚  │      (Tab 切换显示)                      │
│  🔄  │                                         │
│  📋  │                                         │
│  🎨  │                                         │
│      │                                         │
│ [统计]│                                         │
│ 完成度 │                                         │
└──────┴─────────────────────────────────────────┘
```

#### 顶部导航栏
- **左侧**：菜单按钮（移动端）、返回按钮、关卡信息、状态标签
- **右侧**：保存按钮、发布/取消发布按钮

#### 侧边栏
- **导航标签**：
  - 图标 + 文字标签
  - 激活状态高亮
  - 数量徽章（任务数、考题数）

- **统计卡片**：
  - 任务数量
  - 考题数量

- **进度卡片**：
  - 完成度百分比
  - 进度条可视化

#### 内容区域
- **平滑过渡动画**
- **响应式布局**
- **统一的卡片样式**

---

## 🎨 设计系统

### 颜色方案

#### 主色调
- **蓝色系** (Primary)：
  - 主要：#3b82f6
  - 深色：#2563eb
  - 浅色：#eff6ff, #dbeafe

- **绿色系** (Success)：
  - 主要：#10b981
  - 浅色：#d1fae5

- **黄色系** (Warning)：
  - 主要：#fbbf24
  - 浅色：#fef3c7, #fffbeb

- **红色系** (Danger)：
  - 主要：#dc2626
  - 浅色：#fee2e2

#### 中性色
- **灰色系**：
  - 深黑：#111827
  - 中灰：#6b7280
  - 浅灰：#d1d5db, #e5e7eb, #f3f4f6, #f9fafb

### 圆角规范
- **小圆角** (按钮、输入框)：6px, 8px
- **中圆角** (卡片)：12px
- **大圆角** (模态框)：16px
- **胶囊** (标签)：999px

### 阴影规范
- **微阴影**：`0 1px 3px rgba(0,0,0,0.05)`
- **标准阴影**：`0 2px 4px rgba(59,130,246,0.2)`
- **强阴影**：`0 4px 8px rgba(59,130,246,0.3)`
- **悬浮阴影**：`0 10px 30px rgba(0,0,0,0.3)`

### 间距规范
- 0.25rem (4px)
- 0.5rem (8px)
- 0.75rem (12px)
- 1rem (16px)
- 1.5rem (24px)
- 2rem (32px)

---

## 📱 响应式设计

### 断点设置
```css
/* 桌面端 */
@media (min-width: 1024px) {
  /* 侧边栏固定 260px */
  /* 内容区域充满剩余空间 */
}

/* 平板端 */
@media (max-width: 1024px) {
  /* 侧边栏变为抽屉式 */
  /* 显示菜单按钮 */
  /* 内容区域 padding 减小 */
}

/* 移动端 */
@media (max-width: 640px) {
  /* 隐藏按钮文字,只显示图标 */
  /* 统计卡片垂直排列 */
  /* 标签简化 */
}
```

### 移动端优化
1. **导航优化**：
   - 侧边栏折叠为抽屉
   - 汉堡菜单按钮显示
   - 滑动打开/关闭

2. **内容优化**：
   - 内边距减小
   - 字体大小调整
   - 网格变为单列

3. **交互优化**：
   - 触摸友好的按钮大小（最小 44px）
   - 防止误触
   - 滚动优化

---

## ✨ 交互动画

### 过渡效果
```css
/* 淡入淡出 */
.fade-enter-active,
.fade-leave-active {
  transition: all 0.3s;
}

/* 滑动进入 */
.slide-up {
  animation: slideUp 0.3s;
}

/* 旋转加载 */
.spinner {
  animation: spin 0.8s linear infinite;
}
```

### 动画时机
- **页面切换**：淡入淡出 (300ms)
- **模态框**：滑动进入 + 背景淡入
- **按钮悬停**：平移 + 阴影增强 (200ms)
- **卡片悬停**：上移 + 阴影 (200ms)
- **加载状态**：旋转动画

---

## 🚀 性能优化

### 1. 懒加载
```javascript
// 组件按需加载
const CardConfigPanel = defineAsyncComponent(() =>
  import('./CardConfigPanel.vue')
)
```

### 2. 虚拟滚动
- 当任务数量 > 100 时启用
- 使用 vue-virtual-scroller

### 3. 防抖节流
```javascript
// 搜索输入防抖
const debouncedSearch = debounce(handleSearch, 300)

// 滚动事件节流
const throttledScroll = throttle(handleScroll, 100)
```

### 4. 图片优化
- 懒加载
- WebP 格式
- 响应式图片

---

## 🔧 使用指南

### 启用新版编辑器

#### 方法1：修改路由（推荐）
```typescript
// frontend/src/router/index.ts
{
  path: 'levels/:levelId/editor',
  name: 'teacher-level-editor',
  component: LevelEditorEnhanced, // 改为新版
}
```

#### 方法2：并存两个版本
```typescript
// 保留旧版
{
  path: 'levels/:levelId/editor',
  name: 'teacher-level-editor',
  component: LevelEditor,
},

// 添加新版
{
  path: 'levels/:levelId/editor-v2',
  name: 'teacher-level-editor-v2',
  component: LevelEditorEnhanced,
}
```

### Markdown 编辑器独立使用

```vue
<template>
  <MarkdownEditor
    v-model="content"
    height="500px"
    placeholder="请输入内容..."
  />
</template>

<script setup>
import { ref } from 'vue'
import MarkdownEditor from '@/components/MarkdownEditor.vue'

const content = ref('# 标题\n\n这是一段文本')
</script>
```

---

## 📝 Markdown 语法支持

### 基础语法
```markdown
# 一级标题
## 二级标题
### 三级标题

**粗体文本**
*斜体文本*
`行内代码`

- 无序列表项 1
- 无序列表项 2

1. 有序列表项 1
2. 有序列表项 2

> 引用文本

[链接文字](https://example.com)
![图片描述](image-url.jpg)
```

### 代码块
````markdown
```python
def hello_world():
    print("Hello, World!")
```
````

### 表格
```markdown
| 列1 | 列2 | 列3 |
| --- | --- | --- |
| 内容1 | 内容2 | 内容3 |
```

---

## 🎯 未来规划

### 短期计划（1-2周）
- [x] Markdown 编辑器
- [x] 增强的任务面板
- [x] 新版主页面
- [ ] 拖拽排序功能
- [ ] 批量操作功能

### 中期计划（1个月）
- [ ] 图片上传功能
- [ ] 富文本编辑器（WYSIWYG）
- [ ] 模板系统
- [ ] 历史版本记录
- [ ] 协作编辑

### 长期计划（3个月）
- [ ] AI 智能推荐
- [ ] 内容复制/导入导出
- [ ] 多语言支持
- [ ] 主题定制
- [ ] 插件系统

---

## 💡 使用技巧

### 1. 快速创建任务
1. 使用 AI 生成功能
2. 输入详细的需求描述
3. 查看生成结果并调整
4. 一键接受并创建

### 2. Markdown 技巧
- 使用快捷键提高效率（Ctrl+B, Ctrl+I）
- 善用代码块展示示例代码
- 使用表格整理数据
- 用列表清晰表达要点

### 3. 布局建议
- **基本信息**：简洁明了，突出重点
- **任务配置**：先整体后细节
- **环节步骤**：循序渐进，步骤清晰
- **考题配置**：难度适中，覆盖全面

---

## 🐛 已知问题和注意事项

### 当前限制
1. **Markdown 渲染**：
   - 使用简化版渲染器，不支持所有高级语法
   - 建议未来集成 marked.js 或 markdown-it

2. **图片上传**：
   - 目前仅支持图片 URL
   - 需要实现文件上传功能

3. **移动端**：
   - Markdown 编辑器在移动端体验需优化
   - 建议使用平板或桌面端编辑

### 浏览器兼容性
- Chrome/Edge：✅ 完全支持
- Firefox：✅ 完全支持
- Safari：✅ 完全支持
- IE11：❌ 不支持

---

## 📖 参考资料

### Markdown 规范
- [CommonMark Spec](https://commonmark.org/)
- [GitHub Flavored Markdown](https://github.github.com/gfm/)

### UI/UX 设计
- [Material Design](https://material.io/)
- [Tailwind CSS](https://tailwindcss.com/)
- [Ant Design](https://ant.design/)

### 工具库推荐
- **Markdown**：marked, markdown-it, remark
- **代码高亮**：highlight.js, prism.js
- **拖拽**：vue-draggable, Sortable.js
- **图表**：Chart.js, ECharts

---

## 🙏 致谢

感谢用户的宝贵反馈，让我们不断改进产品体验！

---

**文档版本**: 1.0
**最后更新**: 2025-12-03
**维护者**: Claude Code Team
