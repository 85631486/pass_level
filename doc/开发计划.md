# 过关斩将游戏教学平台开发计划

## 文档说明

- **版本**：V1.0
- **制定日期**：2025-12-02
- **依据**：`过关斩将游戏教学平台完整设计文档.md`
- **当前基础**：Flask 后端 + Vue3 前端 + 用户认证系统（登录/注册）

## 开发原则

1. **模块化开发**：按功能模块逐步实现，每个模块包含数据模型、后端API、前端页面
2. **教师端与学生端同步**：确保每个功能模块的教师端和学生端同步开发，保持功能闭环
3. **数据驱动**：先建立数据模型，再实现业务逻辑，最后完善前端交互
4. **测试先行**：每个模块完成后进行单元测试和集成测试
5. **迭代优化**：每个阶段完成后进行功能验证和优化

## 开发阶段总览

| 阶段 | 模块名称 | 教师端功能 | 学生端功能 | 预计工期 |
|------|---------|-----------|-----------|---------|
| 阶段1 | 基础数据模型 | - | - | 3天 |
| 阶段2 | 篇章与地图编辑器（含AI） | 新建篇章 → AI生成鱼骨图 → 地图编辑器设计关卡树 | 首页、等级技能树 | 7天 |
| 阶段3 | 关卡编辑页面与AI助理（含题库） | 点击关卡 → AI生成任务/卡片/环节/考题 → 统一配置 → 发布关卡 | 过关地图展示（仅已发布关卡） | 9天 |
| 阶段4 | 学生关卡学习流程 | - | 按环节步骤学习并提交 | 5天 |
| 阶段5 | 判题与答题 | - | 答题功能 | 4天 |
| 阶段6 | 激励与积分商城 | 积分商城管理 | 积分商城、宝箱 | 5天 |
| 阶段7 | 数据分析与评阅 | 数据分析、任务评阅 | 总排名展示 | 6天 |
| 阶段8 | AI学习助手 | - | AI学习助手 | 3天 |
| 阶段9 | 系统管理与优化 | 权限管理、系统配置、题库查看 | - | 4天 |

**总预计工期**：46个工作日（约9周）

---

## 阶段1：基础数据模型（3天）

### 目标
建立核心数据模型，为后续功能开发奠定基础。

### 开发任务

#### 1.1 数据模型设计（1天）

**后端任务：**
- [ ] 创建 `models/chapter.py`：篇章模型（id, name, description, teacher_id, created_at等）
- [ ] 创建 `models/level.py`：关卡模型（id, chapter_id, name, order, is_visible等）
- [ ] 创建 `models/level_map.py`：过关地图模型（id, chapter_id, map_config_json）
- [ ] 创建 `models/task.py`：任务模型（id, level_id, name, description等）
- [ ] 创建 `models/task_phase.py`：任务环节模型（id, task_id, phase_name, order, is_required等）
- [ ] 创建 `models/task_step.py`：任务步骤模型（id, phase_id, step_name, content, requirements, submission_type, validation_rules, order等）
- [ ] 创建 `models/task_phase_question_rel.py`：环节与闯关考题关联关系模型
- [ ] 创建 `models/knowledge_card.py`：知识卡片模型
- [ ] 创建 `models/skill_card.py`：技能卡片模型
- [ ] 创建 `models/skill_node.py`：技能树节点模型
- [ ] 创建 `models/question.py`：题目模型
- [ ] 创建 `models/point_mall.py`：积分商城模型
- [ ] 创建 `models/treasure_chest.py`：宝箱模型
- [ ] 更新 `db/base.py`，导入所有模型

**验收标准：**
- 所有模型定义完整，包含必要字段和关系
- 数据库迁移脚本可正常执行
- 模型关系（外键、多对多）配置正确

#### 1.2 数据库迁移与初始化（1天）

**后端任务：**
- [ ] 创建 Alembic 迁移配置（或手动SQL脚本）
- [ ] 编写数据库初始化脚本 `scripts/init_db.py`
- [ ] 测试数据库创建和表结构

**验收标准：**
- 数据库表结构创建成功
- 外键约束正确
- 索引创建完成

#### 1.3 基础服务层框架（1天）

**后端任务：**
- [ ] 创建 `services/chapter_service.py`：篇章服务基架
- [ ] 创建 `services/level_service.py`：关卡服务基架
- [ ] 创建 `services/task_service.py`：任务服务基架
- [ ] 创建通用异常类 `core/exceptions.py`

**验收标准：**
- 服务层结构清晰，方法签名定义完整
- 异常处理机制建立

---

## 阶段2：篇章与地图编辑器（含AI助理）（7天）

### 目标
实现教师端连贯的篇章创建和地图设计流程：新建篇章 → 在篇章下打开地图编辑器 → **AI助理协助自动生成鱼骨图** → 使用鱼骨图设计关卡树。同时实现学生端首页和技能树。

### 开发任务

#### 2.1 教师端：篇章管理（1天）

**后端任务：**
- [ ] 实现 `ChapterService` 的 CRUD 方法
- [ ] 创建 `schemas/chapter.py`：篇章的 Pydantic 模型
- [ ] 创建 `api/routes/chapters.py`：篇章管理 API
  - `GET /api/v1/chapters`：篇章列表
  - `POST /api/v1/chapters`：创建篇章
  - `GET /api/v1/chapters/{id}`：篇章详情
  - `PUT /api/v1/chapters/{id}`：更新篇章
  - `DELETE /api/v1/chapters/{id}`：删除篇章

**前端任务（教师端）：**
- [ ] 创建 `pages/teacher/ChapterList.vue`：篇章列表页
- [ ] 创建 `pages/teacher/ChapterForm.vue`：篇章创建/编辑表单
- [ ] 创建 `api/chapters.ts`：篇章 API 客户端
- [ ] 更新路由：添加 `/teacher/chapters` 相关路由

**验收标准：**
- 教师可创建、编辑、删除篇章
- 篇章列表正确显示
- API 接口测试通过

#### 2.2 教师端：地图编辑器（鱼骨图设计关卡树）（3天）

**后端任务：**
- [ ] 完善 `LevelMap` 模型，支持鱼骨图配置 JSON（关卡树结构）
- [ ] 实现 `LevelService` 的基础 CRUD（在地图编辑器中创建关卡节点）
- [ ] 实现 `LevelMapService`：地图 CRUD 和鱼骨图配置管理
- [ ] 创建 `schemas/level.py`：关卡的 Pydantic 模型
- [ ] 创建 `api/routes/level_maps.py`：地图管理 API
  - `GET /api/v1/chapters/{chapter_id}/map`：获取地图配置（鱼骨图数据）
  - `PUT /api/v1/chapters/{chapter_id}/map`：更新地图配置（鱼骨图数据，包含关卡节点创建/更新）
  - `POST /api/v1/levels/{level_id}/treasure-chests`：在关卡设置宝箱
- [ ] 创建 `api/routes/levels.py`：关卡基础 API（用于地图编辑器）
  - `GET /api/v1/chapters/{chapter_id}/levels`：关卡列表（用于地图编辑器）
  - `POST /api/v1/chapters/{chapter_id}/levels`：创建关卡（在地图编辑器中）
  - `PUT /api/v1/levels/{id}`：更新关卡基本信息
  - `DELETE /api/v1/levels/{id}`：删除关卡

**前端任务（教师端）：**
- [ ] 创建 `pages/teacher/ChapterDetail.vue`：篇章详情页
  - 显示篇章信息
  - 提供"打开地图编辑器"入口
- [ ] 集成鱼骨图组件（如：可定制的 Fishbone 可视化库）
- [ ] 创建 `pages/teacher/LevelMapEditor.vue`：鱼骨图地图编辑器
  - 在篇章下打开地图编辑器
  - 鱼骨图节点添加/删除/编辑（对应关卡节点）
  - 关卡节点拖拽和层级关系配置
  - 生成关卡树（学习路径）
  - 关卡节点基本信息编辑（名称、描述等）
  - 设置宝箱位置和奖励
  - 地图预览（关卡树样式）
  - 点击关卡节点可跳转到关卡编辑页面（阶段3实现）
- [ ] 创建 `components/FishboneNode.vue`：鱼骨图节点组件
- [ ] 创建 `components/TreasureChestConfig.vue`：宝箱配置组件
- [ ] 创建 `api/level_maps.ts`：地图 API 客户端
- [ ] 创建 `api/levels.ts`：关卡 API 客户端
- [ ] 更新路由：添加 `/teacher/chapters/{id}/map-editor` 路由

**验收标准：**
- 教师可在篇章下打开地图编辑器
- 教师可使用鱼骨图设计关卡树
- 关卡节点可在地图编辑器中创建、编辑、删除
- 关卡层级关系和顺序配置正确
- 关卡树（学习路径）生成正确
- 宝箱位置和奖励配置功能正常
- 地图预览效果正确（关卡树样式）
- 点击关卡节点可跳转（跳转功能在阶段3实现）

#### 2.3 学生端：首页与等级技能树（2天）

**后端任务：**
- [ ] 创建 `models/student_profile.py`：学生档案模型（等级、经验值）
- [ ] 创建 `models/student_skill.py`：学生技能模型
- [ ] 实现 `StudentService.get_profile()`：获取学生等级和技能树
- [ ] 创建 `api/routes/students.py`：学生相关 API
  - `GET /api/v1/students/{id}/profile`：获取学生档案和技能树

**前端任务（学生端）：**
- [ ] 创建 `pages/student/Home.vue`：学生首页
  - 显示当前等级、经验值
  - 技能树可视化（雷达图或树状图）
- [ ] 创建 `components/SkillTree.vue`：技能树组件
- [ ] 创建 `api/students.ts`：学生 API 客户端
- [ ] 更新路由：设置 `/student/home` 为默认首页

**验收标准：**
- 学生登录后看到自己的等级和技能树
- 技能树可视化展示正确
- 数据实时更新

---

## 阶段3：关卡编辑页面与AI助理（含题库自动提取）（9天）

### 目标
实现关卡编辑页面，教师端点击关卡节点后进入编辑页面，**AI助理协助自动生成任务/卡片/环节/考题**，统一配置后编辑闯关考题（最后一步），题目自动提取到题库，并发布关卡。学生端展示已发布的关卡地图。

### 开发任务

#### 3.1 教师端：关卡编辑页面基础与AI助理（5天）

**后端任务：**
- [ ] 创建 `models/task_phase.py`：任务环节模型（phase_name, order, is_required等）
- [ ] 创建 `models/task_step.py`：任务步骤模型（step_name, content, requirements, submission_type, validation_rules, order等）
- [ ] 创建 `models/task_phase_question_rel.py`：环节与闯关考题关联关系模型（关联规则配置）
- [ ] 创建 `models/task_resource.py`：任务资源模型
- [ ] 创建 `models/task_layout_config.py`：关卡界面布局配置模型
- [ ] 创建 `models/question.py`：题目模型（支持多种题型）
- [ ] 创建 `models/task_question_rel.py`：任务-题目关联（题目自动关联到关卡）
- [ ] 实现 `LevelService.get_level_editor_data()`：获取关卡编辑页面所需数据
- [ ] 实现 `TaskService`：任务 CRUD 和配置管理
- [ ] 实现 `TaskPhaseService`：任务环节 CRUD
- [ ] 实现 `TaskStepService`：任务步骤 CRUD
- [ ] 实现 `QuestionService`：题目 CRUD（题目自动提取到题库）
- [ ] **实现AI助理功能**：
  - `AIService.generate_task()`：AI生成关卡任务
  - `AIService.generate_cards()`：AI生成知识卡片和技能卡片
  - `AIService.generate_phases()`：AI生成任务操作环节步骤
  - `AIService.generate_questions()`：AI生成闯关考题
- [ ] 创建 `api/routes/levels.py` 扩展
  - `GET /api/v1/levels/{id}`：获取关卡详情（用于编辑页面，包含所有配置数据）
  - `PUT /api/v1/levels/{id}`：更新关卡基本信息
  - `POST /api/v1/levels/{id}/publish`：发布关卡（在3.3中实现）
  - `POST /api/v1/levels/{id}/unpublish`：取消发布（在3.3中实现）
  - `GET /api/v1/levels/{id}/publish-status`：获取发布状态（在3.3中实现）
- [ ] 创建 `api/routes/tasks.py`：任务管理 API
  - `GET /api/v1/levels/{level_id}/tasks`：任务列表
  - `POST /api/v1/levels/{level_id}/tasks`：创建任务
  - `GET /api/v1/tasks/{id}`：任务详情
  - `PUT /api/v1/tasks/{id}`：更新任务
  - `PUT /api/v1/tasks/{id}/layout-config`：配置界面布局
- [ ] 创建 `api/routes/task_phases.py`：任务环节管理 API
  - `GET /api/v1/tasks/{task_id}/phases`：环节列表
  - `POST /api/v1/tasks/{task_id}/phases`：创建环节
  - `PUT /api/v1/tasks/{task_id}/phases/{phase_id}`：更新环节
  - `DELETE /api/v1/tasks/{task_id}/phases/{phase_id}`：删除环节
  - `PUT /api/v1/tasks/{task_id}/phases/{phase_id}/order`：调整环节顺序
- [ ] 创建 `api/routes/task_steps.py`：任务步骤管理 API
  - `GET /api/v1/tasks/{task_id}/phases/{phase_id}/steps`：步骤列表
  - `POST /api/v1/tasks/{task_id}/phases/{phase_id}/steps`：创建步骤
  - `PUT /api/v1/tasks/{task_id}/phases/{phase_id}/steps/{step_id}`：更新步骤
  - `DELETE /api/v1/tasks/{task_id}/phases/{phase_id}/steps/{step_id}`：删除步骤
  - `PUT /api/v1/tasks/{task_id}/phases/{phase_id}/steps/{step_id}/order`：调整步骤顺序
- [ ] 创建 `api/routes/task_phase_question_rel.py`：环节与考题关联 API
  - `GET /api/v1/tasks/{task_id}/phase-question-relation`：获取关联关系
  - `PUT /api/v1/tasks/{task_id}/phase-question-relation`：设置关联关系
- [ ] 创建 `api/routes/questions.py`：题目管理 API（在关卡编辑页面中使用）
  - `GET /api/v1/levels/{level_id}/questions`：获取关卡题目列表
  - `POST /api/v1/levels/{level_id}/questions`：创建题目（**自动关联到关卡，自动提取到题库**）
  - `GET /api/v1/questions/{id}`：题目详情
  - `PUT /api/v1/questions/{id}`：更新题目
  - `DELETE /api/v1/questions/{id}`：删除题目
- [ ] 更新 `api/routes/ai_assistant.py`（扩展AI助理API）
  - `POST /api/v1/ai-assistant/generate-task`：AI生成关卡任务
  - `POST /api/v1/ai-assistant/generate-cards`：AI生成知识/技能卡片
  - `POST /api/v1/ai-assistant/generate-phases`：AI生成环节步骤
  - `POST /api/v1/ai-assistant/generate-questions`：AI生成闯关考题

**前端任务（教师端）：**
- [ ] 创建 `pages/teacher/LevelEditor.vue`：关卡编辑页面（整合所有配置，集成AI助理）
  - 关卡基本信息编辑
  - **任务设置**：
    - **AI生成任务按钮**（根据关卡主题自动生成任务描述和目标）
    - **AI生成结果展示和编辑**（可接受、修改或拒绝AI生成的任务）
    - 手动创建/编辑任务
  - **学习卡片和技能卡片配置**：
    - **AI生成卡片按钮**（根据任务内容自动生成知识卡片和技能卡片）
    - **AI生成结果展示和编辑**（可接受、修改或拒绝AI生成的卡片）
    - 手动配置知识卡片和技能卡片（在任务下）
  - **任务操作环节步骤设置**：
    - **AI生成环节步骤按钮**（根据任务内容自动生成环节和步骤）
    - **AI生成结果展示和编辑**（可接受、修改或拒绝AI生成的环节步骤）
    - 手动添加/编辑/删除环节（在任务下）
    - 在环节下添加/编辑/删除步骤
    - 配置步骤内容、操作要求、提交项类型、校验规则
    - 环节和步骤顺序调整
  - 环节与闯关考题关联设置（配置哪些环节完成后才能答题）
  - **闯关考题配置（最后一步）**：
    - **AI生成考题按钮**（根据关卡内容、知识点、技能点等自动生成题目）
    - **AI生成结果展示和编辑**（可接受、修改或拒绝AI生成的题目）
    - 手动创建/编辑闯关考题
    - 题目自动保存到题库（从关卡中自动提取）
    - 设置通过条件、评分权重
  - 关卡界面布局配置
  - 关卡发布功能（在3.3中实现）
- [ ] 创建 `components/TaskConfigPanel.vue`：任务配置面板（含AI生成功能）
- [ ] 创建 `components/CardConfigPanel.vue`：卡片配置面板（含AI生成功能）
- [ ] 创建 `components/PhaseStepConfigPanel.vue`：环节步骤配置面板（含AI生成功能）
- [ ] 创建 `components/QuestionConfigPanel.vue`：考题配置面板（含AI生成功能，最后一步）
- [ ] 创建 `components/PhaseEditor.vue`：环节编辑器
- [ ] 创建 `components/StepEditor.vue`：步骤编辑器
- [ ] 创建 `components/QuestionEditor.vue`：题目编辑器
- [ ] 创建 `components/PhaseQuestionRelationConfig.vue`：环节与考题关联配置组件
- [ ] 创建 `components/LayoutConfigurator.vue`：布局配置组件
- [ ] 创建 `components/AIGeneratePanel.vue`：AI生成面板（通用组件）
- [ ] 创建 `api/levels.ts`、`api/tasks.ts`、`api/task_phases.ts`、`api/task_steps.ts`、`api/questions.ts`、`api/ai_assistant.ts`：相关 API 客户端

**验收标准：**
- 教师可在关卡编辑页面统一配置所有内容
- **AI助理可自动生成任务、卡片、环节步骤、考题**
- 教师可接受、修改或拒绝AI生成的内容
- 任务设置功能正常
- 知识技能卡片配置功能正常
- 环节步骤配置功能正常（支持多个环节，每个环节多个步骤）
- **闯关考题配置功能正常（最后一步）**
- **题目自动提取到题库**（创建题目时自动关联到关卡并保存到题库）
- 环节与考题关联关系设置功能正常
- 界面布局配置功能正常

#### 3.2 学生端：过关地图展示（仅显示已发布关卡）（2天）

**后端任务：**
- [ ] 创建 `models/student_level_progress.py`：学生关卡进度模型
- [ ] 实现 `StudentService.get_level_map()`：获取学生视角的地图数据
  - **只包含已发布的关卡**（过滤未发布的关卡）
  - 包含关卡树结构（基于鱼骨图）
  - 关卡状态（已通过/进行中/未解锁）
  - 宝箱状态（可开启/已开启）
  - 同学名单
- [ ] 创建 `api/routes/students.py` 扩展
  - `GET /api/v1/students/{id}/level-map?chapter_id={id}`：获取过关地图（仅包含已发布的关卡）

**前端任务（学生端）：**
- [ ] 集成鱼骨图展示组件
- [ ] 创建 `pages/student/LevelMap.vue`：过关地图页（关卡树样式）
  - 鱼骨图样式地图展示
  - 关卡节点状态显示（已通过/进行中/未解锁）
  - 关卡层级关系展示
  - 宝箱位置和状态
  - 关卡顺序连线
  - 同学名单展示（头像/昵称）
  - 地图缩放、展开/折叠、导航
  - 点击关卡节点可进入关卡学习（阶段4实现）
- [ ] 创建 `components/LevelNode.vue`：关卡节点组件
- [ ] 创建 `components/TreasureChest.vue`：宝箱组件
- [ ] 创建 `components/LearnerList.vue`：同学名单组件

**验收标准：**
- 学生只能看到已发布的关卡（未发布的关卡不显示）
- 关卡状态正确显示（已通过/进行中/未解锁）
- 关卡层级关系正确展示
- 宝箱位置和状态正确
- 同学名单正确显示
- 地图交互流畅（展开/折叠、缩放）
- 教师发布关卡后，学生端地图实时更新（或刷新后可见）

#### 3.3 教师端：关卡发布功能（1天）

**后端任务：**
- [ ] 完善 `Level` 模型，添加 `is_published`、`published_at` 字段
- [ ] 实现 `LevelService.publish_level()`：发布关卡逻辑
  - 检查关卡配置完整性（任务、环节步骤等）
  - 设置发布状态
  - 记录发布时间
- [ ] 实现 `LevelService.unpublish_level()`：取消发布逻辑
- [ ] 实现 `LevelService.check_publish_ready()`：检查关卡是否可发布
- [ ] 更新 `api/routes/levels.py`
  - `POST /api/v1/levels/{id}/publish`：发布关卡
  - `POST /api/v1/levels/{id}/unpublish`：取消发布
  - `GET /api/v1/levels/{id}/publish-status`：获取发布状态和检查结果

**前端任务（教师端）：**
- [ ] 在 `LevelEditor.vue` 中添加发布功能
  - 发布状态显示组件
  - 发布按钮（带发布前检查）
  - 取消发布按钮
  - 发布成功/失败提示
- [ ] 创建 `components/PublishStatus.vue`：发布状态组件
- [ ] 创建 `components/PublishCheckDialog.vue`：发布前检查对话框

**验收标准：**
- 教师可发布关卡（发布后学生端可见）
- 教师可取消发布关卡（取消后学生端不可见）
- 发布前检查功能正常（提示配置不完整项）
- 发布状态正确显示

#### 3.3 学生端：过关地图展示（仅显示已发布关卡）（2天）

**后端任务：**
- [ ] 创建 `models/student_level_progress.py`：学生关卡进度模型
- [ ] 实现 `StudentService.get_level_map()`：获取学生视角的地图数据
  - **只包含已发布的关卡**（过滤未发布的关卡）
  - 包含关卡树结构（基于鱼骨图）
  - 关卡状态（已通过/进行中/未解锁）
  - 宝箱状态（可开启/已开启）
  - 同学名单
- [ ] 创建 `api/routes/students.py` 扩展
  - `GET /api/v1/students/{id}/level-map?chapter_id={id}`：获取过关地图（仅包含已发布的关卡）

**前端任务（学生端）：**
- [ ] 集成鱼骨图展示组件
- [ ] 创建 `pages/student/LevelMap.vue`：过关地图页（关卡树样式）
  - 鱼骨图样式地图展示
  - 关卡节点状态显示（已通过/进行中/未解锁）
  - 关卡层级关系展示
  - 宝箱位置和状态
  - 关卡顺序连线
  - 同学名单展示（头像/昵称）
  - 地图缩放、展开/折叠、导航
  - 点击关卡节点可进入关卡学习（阶段4实现）
- [ ] 创建 `components/LevelNode.vue`：关卡节点组件
- [ ] 创建 `components/TreasureChest.vue`：宝箱组件
- [ ] 创建 `components/LearnerList.vue`：同学名单组件

**验收标准：**
- 学生只能看到已发布的关卡（未发布的关卡不显示）
- 关卡状态正确显示（已通过/进行中/未解锁）
- 关卡层级关系正确展示
- 宝箱位置和状态正确
- 同学名单正确显示
- 地图交互流畅（展开/折叠、缩放）
- 教师发布关卡后，学生端地图实时更新（或刷新后可见）

---

## 阶段4：学生关卡学习流程（5天）

### 目标
实现学生端按环节步骤顺序学习并提交的完整流程。学生只能学习已发布的关卡。

### 开发任务

#### 4.1 学生端：关卡学习流程（按环节步骤）（5天）

**后端任务：**
- [ ] 创建 `models/student_task_phase_record.py`：学生任务环节记录模型
- [ ] 创建 `models/submission.py`：环节步骤提交模型（关联到步骤）
- [ ] 创建 `models/submission_draft.py`：草稿模型
- [ ] 实现 `StudentService.get_level_detail()`：获取关卡详情（包含任务、知识卡片、技能卡片、环节步骤）
  - **只返回已发布的关卡**（未发布的关卡返回404或提示）
  - 检查关卡发布状态
- [ ] 实现 `TaskPhaseService.check_phase_completion()`：检查环节完成状态
- [ ] 实现 `TaskPhaseService.check_can_take_exam()`：检查是否可以答题（根据环节关联关系）
- [ ] 实现 `SubmissionService`：环节步骤提交和草稿管理
- [ ] 创建 `api/routes/students.py` 扩展
  - `GET /api/v1/levels/{id}/detail`：关卡详情（仅返回已发布的关卡，包含任务、知识卡片、技能卡片、环节步骤）
  - `GET /api/v1/tasks/{id}/phases`：获取任务环节列表
  - `GET /api/v1/tasks/{id}/phases/{phase_id}/steps`：获取环节步骤列表
  - `POST /api/v1/tasks/{id}/phases/{phase_id}/steps/{step_id}/submit`：提交环节步骤操作结果
  - `GET /api/v1/tasks/{id}/phases/{phase_id}/steps/{step_id}/status`：查询环节步骤完成状态
  - `GET /api/v1/tasks/{id}/can-take-exam`：检查是否可以答题
  - `POST /api/v1/levels/{id}/submissions/draft`：保存草稿
  - `GET /api/v1/levels/{id}/learners`：关卡学习同学列表

**前端任务（学生端）：**
- [ ] 创建 `pages/student/LevelDetail.vue`：关卡详情页
  - 任务说明展示
  - 知识卡片学习（图文、视频支持）
  - 技能卡片学习
  - 任务环节步骤展示和操作
    - 显示环节列表和步骤列表
    - 按环节步骤顺序进行操作
    - 查看环节步骤要求
    - 提交当前环节步骤的操作结果（支持草稿保存、多附件上传）
    - 显示环节步骤完成状态
    - 完成所有环节后（根据关联关系）显示闯关考题入口
  - 关卡界面布局渲染（根据教师配置）
- [ ] 创建 `components/KnowledgeCard.vue`：知识卡片组件
- [ ] 创建 `components/SkillCard.vue`：技能卡片组件
- [ ] 创建 `components/PhaseStepList.vue`：环节步骤列表组件
- [ ] 创建 `components/PhaseStepItem.vue`：环节步骤项组件
- [ ] 创建 `components/StepSubmissionForm.vue`：步骤提交表单组件
- [ ] 创建 `components/LearnerList.vue`：同学名单组件（复用）
- [ ] 创建 `api/submissions.ts`：提交 API 客户端

**验收标准：**
- 学生只能访问已发布的关卡（未发布的关卡无法访问，返回提示）
- 学生可查看关卡详情（仅已发布的关卡）
- 知识卡片和技能卡片学习功能正常
- 环节步骤列表正确显示
- 学生可按环节步骤顺序提交操作结果
- 环节完成状态正确显示
- 环节与答题的关联关系正确生效
- 关卡界面布局正确渲染
- 同学名单正确显示

---

## 阶段5：判题与答题（4天）

### 目标
实现判题和答题功能，学生端可答题（题目从已发布关卡中获取，题库从关卡自动提取）。

### 开发任务

#### 5.1 学生端：答题功能（4天）

**后端任务：**
- [ ] 创建 `models/student_answer.py`：学生答题记录模型
- [ ] 实现 `JudgeService`：判题服务
  - 客观题自动判分
  - 主观题待批阅队列
- [ ] 创建 `api/routes/assessments.py`：答题 API
  - `GET /api/v1/levels/{level_id}/questions`：获取题目（**仅已发布的关卡，题目从关卡中获取**）
  - `POST /api/v1/levels/{level_id}/assessments/submit`：提交答题（**仅已发布的关卡**）
  - `GET /api/v1/levels/{level_id}/assessments/result`：获取答题结果（**仅已发布的关卡**）

**前端任务（学生端）：**
- [ ] 创建 `pages/student/Assessment.vue`：答题页
  - 题目展示（支持多种题型）
  - 答题表单
  - 提交答题
  - 答题结果展示（客观题即时反馈）
- [ ] 创建 `components/QuestionDisplay.vue`：题目展示组件
- [ ] 创建 `api/assessments.ts`：答题 API 客户端

**验收标准：**
- 学生可正常答题
- 客观题自动判分功能正常
- 主观题进入待批阅队列
- 答题结果正确显示

---

## 阶段6：激励与积分商城（5天）

### 目标
实现激励系统和积分商城功能，教师端可管理商城，学生端可使用积分和开启宝箱。

### 开发任务

#### 6.1 教师端：积分商城管理（2天）

**后端任务：**
- [ ] 完善 `PointMall` 和 `PointMallItem` 模型
- [ ] 实现 `PointMallService`：商城和商品管理
- [ ] 创建 `api/routes/point_mall.py`：积分商城管理 API
  - `GET /api/v1/admin/point-mall`：商城列表
  - `POST /api/v1/admin/point-mall/items`：创建商品
  - `PUT /api/v1/admin/point-mall/items/{id}`：更新商品
  - `DELETE /api/v1/admin/point-mall/items/{id}`：删除商品
  - `GET /api/v1/admin/point-mall/exchanges`：兑换记录

**前端任务（教师端）：**
- [ ] 创建 `pages/teacher/PointMallManager.vue`：积分商城管理页
  - 商品列表
  - 商品创建/编辑表单
  - 库存管理
  - 兑换记录查看
- [ ] 创建 `api/point_mall_admin.ts`：商城管理 API 客户端

**验收标准：**
- 教师可管理积分商城商品
- 商品库存管理功能正常
- 兑换记录正确显示

#### 6.2 学生端：积分商城与宝箱（3天）

**后端任务：**
- [ ] 创建 `models/student_point.py`：学生积分模型
- [ ] 创建 `models/point_transaction.py`：积分交易记录模型
- [ ] 实现 `PointService`：积分管理和交易
- [ ] 实现 `TreasureChestService`：宝箱开启逻辑
- [ ] 创建 `api/routes/students.py` 扩展
  - `GET /api/v1/students/{id}/points`：积分余额
  - `GET /api/v1/point-mall`：积分商城商品列表
  - `POST /api/v1/point-mall/exchange`：积分兑换
  - `POST /api/v1/treasure-chests/{id}/open`：开启宝箱

**前端任务（学生端）：**
- [ ] 创建 `pages/student/PointMall.vue`：积分商城页
  - 商品列表展示
  - 积分余额显示
  - 兑换功能
  - 兑换记录
- [ ] 创建 `components/PointBalance.vue`：积分余额组件
- [ ] 创建 `components/TreasureChestModal.vue`：宝箱开启弹窗
- [ ] 创建 `api/point_mall.ts`：积分商城 API 客户端

**验收标准：**
- 学生可查看积分商城
- 积分兑换功能正常
- 宝箱开启功能正常
- 积分余额和交易记录正确

---

## 阶段7：数据分析与评阅（6天）

### 目标
实现数据分析和任务评阅功能，教师端可查看数据并评阅任务，学生端可查看总排名。

### 开发任务

#### 7.1 教师端：数据分析（3天）

**后端任务：**
- [ ] 创建 `models/analytics_metric.py`：分析指标模型
- [ ] 创建 `models/student_portrait.py`：学生画像模型（已有基础，需完善）
- [ ] 实现 `AnalyticsService`：数据分析服务
  - 关卡完成率统计
  - 得分分布统计
  - 知识点掌握情况
  - 技能树成长分析
- [ ] 创建 `api/routes/analytics.py`：数据分析 API
  - `GET /api/v1/analytics/chapters/{id}/overview`：篇章学习情况
  - `GET /api/v1/analytics/levels/{id}/statistics`：关卡统计分析
  - `GET /api/v1/analytics/students/{id}/portrait`：学生画像
  - `GET /api/v1/analytics/students/{id}/report`：学生报告

**前端任务（教师端）：**
- [ ] 创建 `pages/teacher/AnalyticsDashboard.vue`：数据分析仪表盘
  - 篇章/关卡完成率图表
  - 得分分布图表
  - 知识点掌握情况
  - 技能树成长分析
- [ ] 创建 `pages/teacher/StudentPortrait.vue`：学生画像页
  - 雷达图展示
  - 风险指示器
  - 行为时间轴
  - 个性化建议
- [ ] 创建 `components/PortraitRadar.vue`：雷达图组件
- [ ] 创建 `api/analytics.ts`：数据分析 API 客户端

**验收标准：**
- 教师可查看各种统计数据
- 图表展示正确
- 学生画像功能正常

#### 7.2 教师端：任务评阅（2天）

**后端任务：**
- [ ] 创建 `models/task_review.py`：任务评阅记录模型
- [ ] 实现 `ReviewService`：任务评阅服务
- [ ] 创建 `api/routes/reviews.py`：任务评阅 API
  - `GET /api/v1/tasks/{task_id}/submissions`：待评阅任务列表
  - `POST /api/v1/tasks/{task_id}/reviews`：任务评阅
  - `GET /api/v1/tasks/{task_id}/reviews/{review_id}`：评阅详情

**前端任务（教师端）：**
- [ ] 创建 `pages/teacher/TaskReview.vue`：任务评阅页
  - 待评阅任务列表
  - 任务提交内容查看
  - 评分表单（Rubric评分、批注）
  - 评分结果确认
- [ ] 创建 `components/ReviewForm.vue`：评阅表单组件
- [ ] 创建 `api/reviews.ts`：评阅 API 客户端

**验收标准：**
- 教师可查看待评阅任务
- 评阅功能正常
- 评分结果正确保存

#### 7.3 学生端：总排名展示（1天）

**后端任务：**
- [ ] 创建 `models/student_total_score.py`：总得分模型
- [ ] 实现 `ScoreService`：得分计算和排名服务
- [ ] 创建 `api/routes/scores.py`：得分排名 API
  - `GET /api/v1/students/{id}/total-score`：总得分和排名
  - `GET /api/v1/leaderboards/total-scores`：总排名列表

**前端任务（学生端）：**
- [ ] 创建 `pages/student/Leaderboard.vue`：总排名页
  - 总排名列表
  - 个人排名显示
  - 排名筛选和排序
- [ ] 创建 `components/RankCard.vue`：排名卡片组件
- [ ] 创建 `api/scores.ts`：得分排名 API 客户端

**验收标准：**
- 学生可查看总排名
- 排名数据正确
- 排名实时更新

---

## 阶段8：AI学习助手（3天）

### 目标
实现学生端AI学习助手功能，在学习过程中为学生提供AI辅助。

### 开发任务

#### 8.1 学生端：AI学习助手（3天）

**后端任务：**
- [ ] 实现 `AIService.learning_help()`：AI学习助手（基于阿里千问）
  - 学习指导
  - 知识点解释
  - 答题提示
  - 学习建议
- [ ] 创建 `api/routes/ai_assistant.py` 扩展
  - `POST /api/v1/ai-assistant/learning-help`：AI学习助手

**前端任务（学生端）：**
- [ ] 在关卡学习页面集成AI学习助手
  - AI学习指导
  - 知识点解释
  - 答题提示
  - 学习建议
- [ ] 创建 `components/AILearningAssistant.vue`：AI学习助手组件
- [ ] 创建 `api/ai_learning.ts`：AI学习助手 API 客户端

**验收标准：**
- 学生可使用AI学习助手
- AI指导和建议正确展示
- 交互流畅

---

## 阶段9：系统管理与优化（4天）

### 目标
完善系统管理功能，包括权限管理、系统配置等。

### 开发任务

#### 9.1 权限管理（2天）

**后端任务：**
- [ ] 完善 `Role` 和 `Permission` 模型
- [ ] 实现 `PermissionService`：权限管理服务
- [ ] 创建权限装饰器和中间件
- [ ] 创建 `api/routes/admin/permissions.py`：权限管理 API

**前端任务：**
- [ ] 创建 `pages/admin/PermissionManager.vue`：权限管理页
- [ ] 创建 `api/permissions.ts`：权限 API 客户端

**验收标准：**
- 权限管理功能正常
- 权限控制正确生效

#### 9.2 系统配置（1天）

**后端任务：**
- [ ] 创建 `models/system_config.py`：系统配置模型
- [ ] 实现 `ConfigService`：系统配置服务
- [ ] 创建 `api/routes/admin/config.py`：系统配置 API
  - `GET /api/v1/admin/config`：获取配置
  - `PUT /api/v1/admin/config`：更新配置
  - `GET /api/v1/admin/ai-config`：AI配置
  - `POST /api/v1/admin/ai-config`：更新AI配置

**前端任务：**
- [ ] 创建 `pages/admin/SystemConfig.vue`：系统配置页
- [ ] 创建 `api/config.ts`：配置 API 客户端

**验收标准：**
- 系统配置功能正常
- AI配置可正常管理

#### 9.3 测试与优化（1天）

**任务：**
- [ ] 编写单元测试
- [ ] 编写集成测试
- [ ] 性能优化
- [ ] 代码审查和重构

**验收标准：**
- 测试覆盖率达标
- 性能指标达标
- 代码质量良好

---

## 开发规范

### 代码规范
- **后端**：遵循 PEP 8，使用类型提示，函数和类添加文档字符串
- **前端**：遵循 ESLint 规则，使用 TypeScript，组件添加注释
- **提交信息**：使用约定式提交格式（feat/fix/docs等）

### 测试要求
- 每个模块完成后编写单元测试
- 关键功能编写集成测试
- 测试覆盖率 ≥ 70%

### 文档要求
- API 接口文档（使用 Swagger/OpenAPI）
- 数据库设计文档
- 部署文档

### 版本控制
- 使用 Git 进行版本控制
- 每个阶段完成后创建标签
- 主分支保护，通过 PR 合并代码

---

## 风险与应对

### 技术风险
- **AI API 调用失败**：实现重试机制和降级方案
- **高并发性能问题**：使用 Redis 缓存，优化数据库查询
- **数据一致性**：使用事务，实现幂等性

### 进度风险
- **功能复杂度超预期**：及时调整计划，优先实现核心功能
- **依赖问题**：提前调研和测试依赖库

### 质量风险
- **测试不充分**：每个阶段完成后进行充分测试
- **用户体验问题**：定期进行用户测试和反馈收集

---

## 里程碑

| 里程碑 | 完成时间 | 交付物 |
|--------|---------|--------|
| M1：基础架构完成 | 阶段1结束 | 数据模型、数据库初始化 |
| M2：核心功能MVP | 阶段4结束 | 篇章关卡、任务、知识技能卡片 |
| M3：完整功能闭环 | 阶段7结束 | 题库、激励、数据分析、评阅 |
| M4：AI能力集成 | 阶段2、3、8结束 | AI生成鱼骨图、AI生成任务/卡片/环节/考题、AI学习助手 |
| M5：系统完善 | 阶段9结束 | 权限管理、系统配置、测试完成 |

---

## 附录

### 开发环境
- Python 3.11+
- Node.js 20+
- SQLite（开发）/ PostgreSQL（生产）
- Redis（可选，用于缓存和排行榜）

### 工具链
- 后端：Flask, SQLAlchemy, Pydantic, Alembic
- 前端：Vue 3, TypeScript, Vite, Pinia, Vue Router
- 测试：Pytest, Vitest
- 代码质量：Black, ESLint, Prettier

### 参考文档
- `过关斩将游戏教学平台完整设计文档.md`
- Flask 官方文档
- Vue 3 官方文档
- 阿里千问 API 文档

