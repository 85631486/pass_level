# 任务5：缺失值侦查与处理

> ### ✅ 快速操作清单
> 1. 打开 `任务5-缺失值数据.csv`，先复制到 Excel 工作簿并另存备份。
> 2. 用筛选/COUNTBLANK/条件格式三种方法各操作一遍，完成“缺失值统计表”。
> 3. 按决策表确认每一列用“删除 / 均值 / 中位数 / 众数 / 重新计算”等方式处理。
> 4. 处理后再次统计缺失值是否归零，并在“操作记录”里写 3 条关键步骤。
> 5. 整理成果：干净数据表 + 缺失值统计表 + 处理记录截图，准备课堂展示。
> 
> `[截图：缺失值统计表+处理后数据的示例布局（待补充）]`

---

## 📌 学习目标（课程2 · 模块二 · 任务5/9）

通过本任务的学习，你将能够：

1. **知识目标**
   - 理解缺失值的概念、类型和产生原因
   - 掌握缺失值的识别方法和判断标准
   - 了解不同缺失值处理方法的适用场景
   - 认识缺失值对数据分析的影响

2. **技能目标**
   - 能够使用Excel快速发现数据中的缺失值
   - 能够计算缺失值的数量和比例
   - 能够根据情况选择合适的处理方法（删除、填充、标记）
   - 能够使用Excel函数和功能处理缺失值

3. **素养目标**
   - 培养数据质量意识和严谨的工作态度
   - 树立"先诊断、后治疗"的数据处理思维
   - 养成记录数据处理过程的良好习惯
   - 提升问题分析和决策能力

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 课程导入与理论讲解：25分钟
  - 方法演示与实践：50分钟
  - 成果展示与总结：15分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] AI助手账号（ChatGPT/文心一言/通义千问，至少一个）

> **AI 速用提醒**：向 AI 描述“我在课程2任务5处理缺失值，目前某列空白 12 个，想知道该删还是填”，并附上表头或截图，它能更快给出贴合本任务的建议。

### 📁 数据文件
**重要：请从课程数据文件夹中下载以下文件！**

- `任务5-缺失值数据.csv`（50条销售数据，包含10-30%的缺失值）

---

## 📋 操作步骤

### 步骤一：认识缺失值（10分钟）

#### 1.1 真实案例导入

**案例："某公司销售分析出错事故"**
- 背景：分析师计算月均销售额，结果偏高
- 原因：部分日期的销售额缺失，计算时被当作0
- 后果：错误决策，增加了库存，造成积压
- 教训：缺失值必须正确处理！

**💭 思考：**
- 你在整理数据时遇到过缺失值吗？
- 缺失值会对分析结果造成什么影响？

#### 1.2 什么是缺失值？

**定义：**
缺失值是指数据集中应该有值但实际没有记录的数据。

**常见表现形式：**
1. **空白单元格**：最常见
2. **NULL、NA、N/A**：标记为缺失
3. **0或-999**：用特殊值表示缺失（需要判断）
4. **空格或"未知"**：文本形式的缺失

**缺失值的产生原因：**
1. **数据收集问题**：受访者拒绝回答、设备故障
2. **数据录入错误**：遗漏、失误
3. **数据传输问题**：文件损坏、格式转换
4. **业务逻辑**：某些字段不适用（如单身人士的配偶信息）

#### 1.3 今天的侦探任务

**任务目标：**
1. 侦查：找出数据中的所有缺失值
2. 分析：评估缺失值的严重程度
3. 决策：选择合适的处理方法
4. 执行：处理缺失值并验证结果

---

### 步骤二：缺失值识别方法（15分钟）

#### 2.1 打开示例数据

**数据集介绍："任务5-缺失值数据.csv"**
- 主题：某店铺50天的销售记录
- 字段：日期、商品名称、销售数量、单价、销售额、销售员、备注
- 缺失情况：部分字段有缺失

**操作：**
```
打开Excel → 导入CSV文件 → 查看数据
```

#### 2.2 方法1：目视检查（适合少量数据）

**操作步骤：**
1. 滚动浏览数据
2. 观察是否有空白单元格
3. 记录缺失位置

**优点：** 直观  
**缺点：** 数据量大时容易遗漏

#### 2.3 方法2：筛选空白值（推荐）

**操作步骤：**
1. 选中数据区域
2. 数据 → 筛选
3. 点击列标题的下拉箭头
4. 取消全选 → 只勾选"空白"
5. 查看筛选结果

**💡 技巧：**
- 可以对每列逐一筛选
- 记录每列的缺失数量

**立即实践：**
- 对"销售数量"列使用筛选
- 显示所有缺失值行

`[截图：筛选“空白”界面示例（待补充）]`

#### 2.4 方法3：使用COUNTBLANK函数（精确统计）

**函数语法：**
```excel
=COUNTBLANK(区域)
```

**操作示例：**
```excel
在H1输入: 销售数量缺失个数
在H2输入: =COUNTBLANK(C2:C51)
```

**批量统计所有列：**
| 字段名 | 缺失个数 | 缺失比例 |
|--------|---------|---------|
| 日期 | =COUNTBLANK(A:A) | =H2/50 |
| 商品名称 | =COUNTBLANK(B:B) | =H3/50 |
| 销售数量 | =COUNTBLANK(C:C) | =H4/50 |
| ... | ... | ... |

**立即实践：**
- 创建"缺失值统计表"
- 统计每列的缺失数量和比例

`[截图：缺失值统计表（字段/缺失个数/比例）示例（待补充）]`

#### 2.5 方法4：条件格式高亮显示（可视化）

**操作步骤：**
1. 选中数据区域（A1:G51）
2. 开始 → 条件格式 → 新建规则
3. 选择"只为包含以下内容的单元格设置格式"
4. 单元格值 → 等于 → 空白
5. 设置格式：填充红色
6. 确定

**效果：**
- 所有空白单元格用红色标出
- 一目了然

**立即实践：**
- 设置条件格式
- 观察缺失值分布

`[截图：条件格式高亮缺失单元格示例（待补充）]`

#### 2.6 缺失值类型判断

**类型1：完全随机缺失（MCAR）**
- 缺失与任何变量无关
- 例如：数据录入时随机遗漏
- 处理：可以直接删除或填充

**类型2：随机缺失（MAR）**
- 缺失与其他变量有关
- 例如：高收入人群更不愿透露收入
- 处理：需要考虑相关性

**类型3：非随机缺失（MNAR）**
- 缺失与缺失值本身有关
- 例如：成绩太差不敢填
- 处理：最复杂，需要专业判断

#### 2.7 向AI学习环节

**教师演示提问：**
```
"Excel中如何快速找出所有包含缺失值的行？请给出多种方法。"
"缺失值有哪些类型？如何判断？不同类型应该如何处理？"
```

**你的任务：**
- 向AI提问："为什么要处理缺失值？如果不处理会有什么后果？"
- 记录AI的回答
- 分享给同学

---

### 步骤三：缺失值处理方法（25分钟）

#### 3.1 处理方法决策树

**决策流程：**
```
开始
  ↓
缺失比例>50%? → 是 → 考虑删除该列
  ↓ 否
该列重要? → 否 → 删除该列
  ↓ 是
缺失行<10%? → 是 → 删除行
  ↓ 否
数值型数据? → 是 → 填充(均值/中位数/回归)
  ↓ 否
分类型数据? → 是 → 填充(众数/新类别)
  ↓
特殊处理
```

#### 3.2 方法1：删除法

**适用场景：**
1. 缺失比例很小（<5%）
2. 数据量充足
3. 缺失是完全随机的

**操作1：删除包含缺失值的行**
```
步骤:
1. 选中数据区域
2. 开始 → 查找和选择 → 定位条件
3. 选择"空值"
4. 确定(所有空单元格被选中)
5. 右键 → 删除 → 整行
```

**操作2：删除缺失严重的列**
```
步骤:
1. 计算每列缺失比例
2. 如果>50%,考虑删除
3. 选中列 → 右键 → 删除
```

**⚠️ 注意事项：**
- 删除前要备份原始数据！
- 记录删除了多少行/列
- 评估删除后数据量是否充足

#### 3.3 方法2：填充法（数值型数据）

**策略1：用均值填充**

**适用：** 数据分布较均匀，无明显异常值

**操作：**
```excel
1. 计算均值: =AVERAGE(C2:C51)
2. 复制均值
3. 筛选出空白值
4. 选择性粘贴 → 值
```

**公式法：**
```excel
=IF(ISBLANK(C2), AVERAGE($C$2:$C$51), C2)
```

**策略2：用中位数填充**

**适用：** 数据有异常值或偏态分布

**操作：**
```excel
1. 计算中位数: =MEDIAN(C2:C51)
2. 填充方法同均值
```

**策略3：用前/后值填充**

**适用：** 时间序列数据，相邻值相似

**操作：**
```excel
前值填充: =IF(ISBLANK(C2), C1, C2)
后值填充: =IF(ISBLANK(C2), C3, C2)
```

**或使用"定位条件"：**
```
1. 选中列
2. Ctrl+G → 定位条件 → 空值
3. 输入: =C1 (引用上一个单元格)
4. Ctrl+Enter (批量填充)
5. 复制 → 选择性粘贴为值
```

**策略4：用固定值填充**

**适用：** 业务规则明确

**示例：**
- 销售额缺失填0（表示当天无销售）
- 折扣缺失填1（表示无折扣）

#### 3.4 方法3：填充法（分类型数据）

**策略1：用众数填充**

**适用：** 有明显的高频类别

**操作：**
```excel
1. 找出众数(出现最多的值)
   方法: 数据透视表或COUNTIF
2. 用众数填充空白值
```

**策略2：填充为"未知"或"其他"**

**适用：** 无法推断缺失值

**操作：**
```
直接在空白处输入"未知"或"其他"
```

**策略3：用相关字段推断**

**示例：**
- 根据商品名称推断商品类别
- 根据城市推断省份

#### 3.5 方法4：标记法

**适用场景：**
- 缺失本身有意义
- 需要区分"真实0值"和"缺失"

**操作：**
```
1. 新建一列"是否缺失"
2. 使用公式: =IF(ISBLANK(C2), "是", "否")
3. 保留缺失标记,方便后续分析
```

**应用场景：**
- 分析缺失模式
- 对比缺失组和非缺失组

---

### 步骤四：实战练习（25分钟）

#### 4.1 任务要求

**侦探任务：清洗销售数据**

**数据："任务5-缺失值数据.csv"**

**任务步骤：**

**步骤1：侦查（10分钟）**
1. 打开数据文件
2. 统计每列的缺失数量和比例
3. 创建"缺失值统计表"
4. 用条件格式高亮显示缺失值

**步骤2：决策（5分钟）**
根据以下规则制定处理方案：
- 日期：不应缺失，缺失行删除
- 商品名称：不应缺失，缺失行删除
- 销售数量：用中位数填充
- 单价：用该商品的平均单价填充
- 销售额：用公式重新计算（数量×单价）
- 销售员：用众数填充
- 备注：可以保留空白或填"无"

**步骤3：执行（10分钟）**
1. 按照决策方案处理缺失值
2. 验证处理结果
3. 记录处理过程

**步骤4：验证**
- 再次统计缺失值，应为0
- 检查数据的合理性

**完成标准：**
1. 所有缺失值已处理
2. 数据逻辑正确（如销售额=数量×单价）
3. 有完整的处理记录

`[截图：处理记录示例（步骤/操作/结果）待补充]`

#### 4.2 向AI求助环节

**鼓励提问：**
```
提问示例:
"Excel如何用中位数填充缺失值？请给出详细步骤和公式。"
"我有一列分类数据有缺失值，应该如何填充？有哪些方法？"
"如何快速删除包含缺失值的所有行？"
"缺失值用均值填充好还是中位数填充好？如何选择？"
```

**要求：**
- 每人至少向AI提问1个实际问题
- 根据AI建议优化处理方法

---

### 步骤五：成果展示与讨论（10分钟）

#### 5.1 展示内容

**展示内容：**
1. 展示缺失值统计表
2. 说明处理决策和理由
3. 展示处理后的干净数据
4. 分享遇到的困难和解决方法

#### 5.2 对比讨论

**讨论话题：**
1. 不同小组的处理方案有何不同？
2. 哪种方案更合理？为什么？
3. 不同处理方法会对后续分析产生什么影响？

---

### 步骤六：总结与拓展（5分钟）

#### 6.1 知识总结

**今天学会的内容：**
1. 缺失值的识别方法（筛选、函数、条件格式）
2. 缺失值的处理方法（删除、填充、标记）
3. 处理决策的制定原则

**缺失值处理原则：**
1. **先诊断后治疗**：了解缺失原因和类型
2. **保留原始数据**：处理前先备份
3. **记录处理过程**：方便回溯和复现
4. **验证处理结果**：确保逻辑正确

#### 6.2 课后任务

**任务1：独立完成缺失值处理（必做）**
- 下载"任务5-练习数据.csv"
- 独立完成缺失值侦查和处理
- 提交处理报告（包含：缺失统计、处理方案、处理结果）

**任务2：AI学习记录（必做）**
- 向AI提问："什么情况下应该删除缺失值？什么情况下应该填充？"
- 向AI提问："如何评估缺失值处理方法的好坏？"
- 记录学习心得

**任务3：拓展阅读（选做）**
- 了解高级填充方法：回归填充、KNN填充
- 学习Python中处理缺失值的方法（pandas）

#### 6.3 下次课预告

**下次课：异常值大搜捕**
- 学习识别异常值的方法
- 掌握异常值处理技巧
- 数据侦探技能再升级！

**课前思考：**
- 什么样的数据算是"异常"？
- 遇到异常数据应该删除还是保留？

---

## 📚 附录

### 附录1：缺失值识别函数速查

| 函数 | 语法 | 说明 | 示例 |
|------|------|------|------|
| ISBLANK | =ISBLANK(A1) | 判断是否为空 | 返回TRUE/FALSE |
| COUNTBLANK | =COUNTBLANK(A:A) | 统计空白单元格数 | 返回数字 |
| COUNTA | =COUNTA(A:A) | 统计非空单元格数 | 返回数字 |
| IF | =IF(ISBLANK(A1),"缺失","有值") | 条件判断 | 标记缺失 |

### 附录2：缺失值处理决策表

| 情况 | 缺失比例 | 数据类型 | 推荐方法 | 理由 |
|------|---------|---------|---------|------|
| 1 | <5% | 任意 | 删除行 | 影响小 |
| 2 | 5-30% | 数值 | 均值/中位数 | 保留数据量 |
| 3 | 5-30% | 分类 | 众数/"未知" | 保留数据量 |
| 4 | >30% | 不重要 | 删除列 | 数据质量差 |
| 5 | >30% | 重要 | 专业方法 | 需谨慎处理 |
| 6 | 任意 | 时间序列 | 前后值填充 | 保持连续性 |

### 附录3：常用填充公式

**均值填充：**
```excel
=IF(ISBLANK(A2), AVERAGE($A$2:$A$100), A2)
```

**中位数填充：**
```excel
=IF(ISBLANK(A2), MEDIAN($A$2:$A$100), A2)
```

**前值填充：**
```excel
=IF(ISBLANK(A2), A1, A2)
```

**条件均值（根据类别）：**
```excel
=IF(ISBLANK(C2), AVERAGEIF($B$2:$B$100, B2, $C$2:$C$100), C2)
```

### 附录4：常见错误及解决

**错误1：用0填充所有缺失值**
- 问题：0可能有实际意义，会混淆
- 正确：区分"真实的0"和"缺失"

**错误2：删除太多数据**
- 问题：数据量不足，影响分析
- 正确：优先考虑填充法

**错误3：不区分数据类型**
- 问题：分类数据用均值填充
- 正确：根据数据类型选择方法

**错误4：不验证结果**
- 问题：填充后出现不合理值
- 正确：检查逻辑（如销售额=数量×单价）

### 附录5：AI提问模板

```
"Excel中有哪些方法可以快速找出缺失值？请详细说明步骤。"
"缺失值用均值填充和中位数填充有什么区别？如何选择？"
"如何批量删除包含缺失值的行？请给出公式或操作步骤。"
"分类数据的缺失值应该如何处理？有哪些方法？"
"如何用Excel的定位功能处理缺失值？请给出详细教程。"
```

---

## 🆘 卡住了？先这样排查
- **COUNTBLANK 总是 0**：确认是否有空格或“,”等不可见字符，可用 `=LEN(A2)` 检查并用 TRIM/CLEAN 处理。
- **条件格式没反应**：确认选择的区域正确且未限定到某列；必要时清除规则后重新设置。
- **填充后多了小三角/公式**：记得复制整列 → 选择性粘贴为值，避免后续报错。
- **删多了数据**：永远用备份表操作；如果忘了，立即 Ctrl+Z 撤销，然后重新评估缺失比例。
- **不知道选均值还是中位数**：把数据列统计给 AI，看它根据分布建议（均值适合对称分布，中位数适合有极值）。

---

## 📂 成果示例参考
- 缺失值统计表：`[截图：字段-缺失个数-缺失比例表格（待补充）]`
- 处理记录：`[截图：处理步骤/方法/理由/结果示例（待补充）]`
- 处理后数据：`[截图：干净数据 + “0”缺失验证截图（待补充）]`

> 课堂分享会随机点名，请把 Excel 的“统计+清洗前后”区域都准备好，方便 1 分钟展示。

---

**祝你学习愉快！** 🎉