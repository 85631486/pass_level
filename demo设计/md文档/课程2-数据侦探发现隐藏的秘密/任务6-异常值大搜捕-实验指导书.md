# 任务6：异常值大搜捕

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 理解异常值的概念、类型和产生原因
   - 掌握异常值识别的三大方法：可视化法、统计法、业务规则法
   - 了解四分位数（IQR）和3σ原则的统计学原理

2. **技能目标**
   - 能够使用箱线图和散点图可视化识别异常值
   - 能够使用3σ原则和IQR方法计算异常值边界
   - 能够使用条件格式高亮显示异常值
   - 能够根据业务场景选择合适的异常值处理策略

3. **素养目标**
   - 培养对数据的敏感度和质疑精神
   - 树立"异常值不一定是错误值"的科学意识
   - 养成多角度验证数据的严谨习惯

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 课程导入与理论讲解：25分钟
  - 方法演示与实践：50分钟
  - 成果展示与总结：15分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] AI助手账号（ChatGPT/文心一言/通义千问，至少一个）

### 📁 数据文件
**重要：请从课程数据文件夹中下载以下文件！**

- `任务6-学生成绩异常数据.xlsx`（包含异常值的学生成绩数据）

---

## 📋 操作步骤

### 步骤一：认识异常值（10分钟）

#### 1.1 案例导入

**展示案例：**
"某公司员工工资显示9999万元，实际应为3500元，原因是系统测试数据未清理"

**💭 思考：**
- 你遇到过哪些异常数据？
- 异常数据一定是错误的吗？

#### 1.2 什么是异常值？

**定义：**
异常值（Outlier）是指明显偏离其他观测值的数据点。

**异常值的三种类型：**

1. **错误异常值**（应删除或修正）
   - 数据录入错误：成绩500分（满分100）
   - 测量设备故障
   - 系统bug

2. **真实异常值**（应保留并特别关注）
   - 真实存在的极端情况：双11销售额暴增
   - 罕见但合理的事件
   - 特征：虽然极端，但真实发生

3. **统计异常值**（需结合业务判断）
   - 统计上的离群点：全班唯一满分的学生
   - 符合业务逻辑，但在统计上偏离

---

### 步骤二：方法学习 - 可视化识别法（15分钟）

#### 2.1 方法一：箱线图（Box Plot）

**箱线图的组成：**
```
   上边缘 = Q3 + 1.5×IQR
      ×  ← 异常值
   ┌───┐
   │   │ ← Q3（第三四分位数）
   ├───┤ ← 中位数
   │   │ ← Q1（第一四分位数）
   └───┘
      ×  ← 异常值
   下边缘 = Q1 - 1.5×IQR
```

**演示步骤：使用Excel创建箱线图**
1. 选中数据列（B2:B101）
2. 插入 → 插入统计图表 → 箱形图
3. 设置数据系列格式 → 勾选"显示离群点"
4. 识别图中圆点标记的异常值

**立即实践：**
- 为语文、数学、英语成绩分别创建箱线图
- 观察哪些科目有异常值

---

### 步骤三：方法学习 - 统计检测法（20分钟）

#### 3.1 方法三：IQR方法（四分位距法）

**核心概念：**
- Q1（第一四分位数）：25%的数据小于此值
- Q3（第三四分位数）：75%的数据小于此值
- IQR = Q3 - Q1
- 下限 = Q1 - 1.5 × IQR
- 上限 = Q3 + 1.5 × IQR

**Excel公式实现：**

```excel
/* 假设数据在B2:B101 */

Q1: =QUARTILE.INC($B$2:$B$101, 1)
Q3: =QUARTILE.INC($B$2:$B$101, 3)
IQR: =Q3单元格 - Q1单元格
下限: =Q1单元格 - 1.5 * IQR单元格
上限: =Q3单元格 + 1.5 * IQR单元格

/* 标记异常值 */
=IF(OR(B2<下限, B2>上限), "异常", "正常")
```

**示例计算结果：**
```
数学成绩的IQR分析：
Q1 = 65
Q3 = 85
IQR = 20
下限 = 35
上限 = 115

异常值判断：成绩 < 35 或 > 115 → 异常
```

**立即实践：**
- 为数学成绩计算IQR边界
- 标记所有异常值

#### 3.2 方法四：3σ原则（标准差法）

**核心概念：**
- 99.7%的数据在 μ ± 3σ 范围内
- 超出此范围的可视为异常值

**Excel公式：**
```excel
均值: =AVERAGE($B$2:$B$101)
标准差: =STDEV.S($B$2:$B$101)
下限: =均值 - 3*标准差
上限: =均值 + 3*标准差
```

**立即实践：**
- 用3σ方法计算异常值边界
- 与IQR方法对比结果

---

### 步骤四：方法学习 - 业务规则法（10分钟）

**核心思想：**
根据业务逻辑和常识设定数据的合理范围。

**常见业务规则示例：**
1. 成绩数据：范围0-100分
2. 年龄数据：范围0-120岁
3. 逻辑一致性：总分 = 语文 + 数学 + 英语

**Excel公式实现：**
```excel
/* 检查成绩范围 */
=IF(OR(B2<0, B2>100), "超出范围", "正常")

/* 检查总分一致性 */
=IF(E2<>B2+C2+D2, "总分错误", "正常")
```

**立即实践：**
- 检查所有成绩是否在0-100范围内
- 检查总分是否正确

---

### 步骤五：异常值处理策略（15分钟）

#### 5.1 处理方法详解

**方法1：删除法**
- 适用：明确的错误异常值
- 操作：筛选标记为"异常"的行 → 删除
- 注意：删除前务必备份

**方法2：修正法**
- 适用：能够推断出正确值
- 案例：500分改为50分（录入时多打一个0）

**方法3：替换法**
- 策略1：用边界值替换
  ```excel
  =IF(B2>上限, 上限, IF(B2<下限, 下限, B2))
  ```
- 策略2：用中位数替换
  ```excel
  =IF(异常标记="异常", MEDIAN($B$2:$B$101), B2)
  ```

**方法4：保留并标记**
- 适用：确认是真实的极值
- 操作：新建列标记"是否异常值"

---

### 步骤六：实战练习（20分钟）

**任务目标：**
完成"任务6-学生成绩异常数据.xlsx"的全面异常值清洗

**步骤1：多方法检测异常值（10分钟）**
1. 为语文、数学、英语创建箱线图
2. 使用IQR方法计算异常值边界
3. 应用业务规则（0-100分范围）
4. 使用条件格式高亮异常值

**步骤2：制定处理方案（3分钟）**
- 判断异常值类型
- 根据决策流程选择处理方法

**步骤3：执行处理（5分钟）**
- 按照方案处理异常值
- 记录处理过程

**步骤4：验证结果（2分钟）**
- 重新创建箱线图检查
- 计算处理前后统计量对比

---

### 步骤七：总结提升（5分钟）

**今天学会的异常值识别方法：**
1. 可视化法：箱线图、散点图
2. 统计法：IQR方法、3σ方法
3. 业务规则法：根据业务逻辑设定范围

**异常值处理策略：**
- 删除：明确错误，数据量充足
- 修正：能找到正确值
- 替换：边界值/中位数/均值
- 保留：真实极值，标记后续分析

**重要原则：**
1. 异常值不一定是错误值
2. 多方法结合，交叉验证
3. 业务逻辑优先于统计方法

**课后任务：**
下载"课后练习-销售数据.xlsx"，使用三种方法识别异常值，制定处理方案，撰写100字分析说明。

---

## 📚 附录

### 附录1：IQR方法完整公式

```excel
Q1: =QUARTILE.INC($B$2:$B$101, 1)
Q3: =QUARTILE.INC($B$2:$B$101, 3)
IQR: =Q3-Q1
下限: =Q1-1.5*IQR
上限: =Q3+1.5*IQR
判断: =IF(OR(B2<下限, B2>上限), "异常", "正常")
```

### 附录2：异常值处理决策表

| 异常特征 | 示例 | 判断类型 | 推荐处理 |
|---------|------|---------|---------|
| 违反基本规则 | 年龄-10岁 | 错误异常值 | 删除 |
| 超出业务范围 | 成绩500分 | 错误异常值 | 修正或删除 |
| 真实极端事件 | 双11销售额10倍增长 | 真实异常值 | 保留标记 |
| 统计离群但正常 | 全班唯一满分 | 统计异常值 | 保留 |

### 附录3：常见问题FAQ

**Q1: 箱线图中的"×"点代表什么？**
A: 代表异常值，超出了Q1-1.5×IQR到Q3+1.5×IQR的范围。

**Q2: 如何判断是错误异常值还是真实极值？**
A: 判断标准：
1. 业务逻辑检查：是否违反基本规则
2. 数据来源核查：能否追溯到原始记录
3. 上下文分析：结合其他字段判断
4. 领域知识：该领域是否存在这样的极端情况

**Q3: IQR方法和3σ方法有什么区别？**
A:
- IQR方法：更稳健，不受极端值影响，适合任意分布
- 3σ方法：假设正态分布，如果数据不符合正态分布结果可能不准确
- 建议：优先使用IQR方法

---

**祝你学习愉快！** 🎉

