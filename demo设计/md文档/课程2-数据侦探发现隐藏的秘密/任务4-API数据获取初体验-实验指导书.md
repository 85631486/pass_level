# 任务4：API数据获取初体验

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 理解API的基本概念和工作原理
   - 掌握API返回数据的基本格式（JSON）
   - 认识常见的免费API资源

2. **技能目标**
   - 能够找到并使用免费的API接口
   - 能够通过浏览器调用API获取数据
   - 能够将API返回的JSON数据转换为Excel格式
   - 能够使用Excel的Power Query连接API数据源

3. **素养目标**
   - 培养获取实时数据的意识
   - 树立合理使用API的规范意识
   - 养成阅读API文档的习惯

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - API基础知识讲解：15分钟
  - 实战演示：20分钟
  - 实战练习：40分钟
  - 成果展示：10分钟
  - 总结：5分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] 网络连接正常
- [ ] 浏览器（Chrome、Edge等）
- [ ] Excel 2016及以上版本（支持Power Query）
- [ ] AI助手账号（用于提问和求助）

### 📁 数据文件
**重要：本任务需要从API获取数据！**

如果无法访问API，可以使用老师提供的示例数据。

---

## 📋 操作步骤

### 步骤一：了解API（10分钟）

#### 1.1 什么是API？

**通俗解释：**
API = Application Programming Interface（应用程序接口）

就像"数据的自动贩卖机"：
- 你投币（发送请求）→ 机器给你商品（返回数据）
- 不需要知道机器内部如何工作

**API的特点：**
1. ✅ **实时性**：数据实时更新（如天气、股票）
2. ✅ **标准化**：数据格式统一，易于处理
3. ✅ **自动化**：程序自动获取，无需人工

#### 1.2 API的工作原理

**关键概念：**

**1. 请求（Request）**
- URL：API的地址
  - 例如：`https://api.weather.com/v1/current?city=Beijing`
- 参数：告诉API你要什么数据
- API密钥（Key）：身份验证（有些API需要）

**2. 响应（Response）**
- 数据格式：通常是JSON
- 状态码：200成功、404未找到、401未授权

**3. JSON格式示例：**
```json
{
  "city": "北京",
  "temperature": "20°C",
  "weather": "晴天"
}
```

---

### 步骤二：认识免费API平台（15分钟）

#### 2.1 国内平台

**1. 聚合数据 (www.juhe.cn)**
- 特点：200+免费API
- 类型：天气、新闻、股票等
- 需要：注册账号，申请API Key

**2. 和风天气 (www.qweather.com)**
- 特点：专业天气API
- 免费额度：1000次/天
- 需要：注册账号

**3. 天行数据 (www.tianapi.com)**
- 特点：多种数据API
- 免费额度：100次/天
- 需要：注册账号

#### 2.2 国际平台（测试用）

**JSONPlaceholder (jsonplaceholder.typicode.com)**
- 特点：完全免费，无需注册
- 用途：测试和学习
- 数据：假数据，但格式真实

**💡 提示：** 向AI提问："推荐5个适合初学者的免费API，并说明如何使用"

---

### 步骤三：实战演示（20分钟）

#### 3.1 演示1：浏览器直接调用API

**使用JSONPlaceholder测试API（无需注册）**

**步骤1：打开API地址**
```
https://jsonplaceholder.typicode.com/users
```

**步骤2：理解返回数据**
- 浏览器会显示JSON格式的数据
- 可以安装JSON Viewer插件美化显示

**步骤3：添加参数获取单个用户**
```
https://jsonplaceholder.typicode.com/users/1
```

#### 3.2 演示2：将JSON转换为Excel

**方法1：在线工具（适合少量数据）**
1. 复制API返回的JSON数据
2. 打开在线JSON转Excel工具
   - 推荐：https://www.convertjson.com/json-to-excel.htm
3. 粘贴JSON数据，点击"Convert"
4. 下载Excel文件

**方法2：使用Excel Power Query（推荐）**

**步骤：**
1. 打开Excel
2. 数据选项卡 → 获取数据 → 从其他源 → 从Web
3. 输入API URL
4. Excel自动解析JSON数据
5. 选择需要的字段，点击"加载"
6. 数据导入Excel，可刷新更新

**💡 提示：** 向AI提问："Excel Power Query如何连接API？请给出详细步骤"

---

### 步骤四：实战练习（40分钟）

#### 4.1 练习任务

**任务要求：**
选择以下任意一个API完成数据获取：

**选项1：JSONPlaceholder（推荐新手）**
- 目标：获取用户列表
- URL: https://jsonplaceholder.typicode.com/users
- 要求：将数据转换为Excel表格

**选项2：和风天气API**
- 目标：获取某个城市的实时天气
- 要求：注册账号、申请Key、调用API、转为Excel

**完成标准：**
1. ✅ 成功调用API并看到返回数据
2. ✅ 将数据转换为Excel表格
3. ✅ Excel中至少有5列、10行数据

#### 4.2 操作步骤

**步骤1：选择API**
- 推荐新手：JSONPlaceholder（无需注册）
- 有经验：和风天气（需要注册）

**步骤2：调用API**
- 在浏览器中打开API URL
- 查看返回的JSON数据

**步骤3：转换为Excel**
- 方法1：使用在线工具
- 方法2：使用Excel Power Query（推荐）

**步骤4：验证数据**
- 检查数据是否完整
- 检查字段是否正确

#### 4.3 向AI求助环节

**鼓励提问：**
```
提问示例：
"我在调用API时遇到错误代码401，是什么原因？如何解决？"
"如何将这段JSON数据转换为Excel表格？"
"Excel Power Query如何连接API？请给出详细步骤。"
```

**要求：**
- 至少向AI提问1个实际问题
- 根据AI建议完成操作

---

### 步骤五：成果展示（10分钟）

#### 5.1 展示内容

**展示你的成果：**
1. 展示调用的API名称和用途
2. 展示浏览器中返回的JSON数据
3. 展示转换后的Excel表格
4. 分享遇到的问题和解决方法

---

### 步骤六：总结与拓展（5分钟）

#### 6.1 今天学会的内容

1. ✅ API的基本概念和工作原理
2. ✅ 如何通过浏览器调用API
3. ✅ JSON数据格式的基本认识
4. ✅ 将JSON转换为Excel的方法

#### 6.2 API使用规范

**必须遵守：**
- ⚠️ 遵守API的使用限制（调用次数、频率）
- ⚠️ 妥善保管API Key，不要泄露
- ⚠️ 注明数据来源
- ⚠️ 不要过度调用（可能被封）

---

## 📝 课后任务

### 任务1：API实战（必做）
- 选择2个不同的免费API，分别调用并获取数据
- 转换为Excel表格
- 建立"我的API清单"（名称、URL、用途）

### 任务2：AI学习记录（必做）
- 向AI提问："API和爬虫有什么区别？"
- 向AI提问："如何判断一个API是否可靠？"
- 记录学习心得

### 任务3：拓展探索（选做）
- 注册和风天气账号，获取实时天气数据
- 了解如何设置API自动刷新
- 探索更多免费API资源

---

## 📚 附录

### 附录1：免费API资源清单

| API名称 | 平台 | 类型 | 免费额度 | 需要注册 |
|---------|------|------|---------|---------|
| 和风天气 | qweather.com | 天气 | 1000次/天 | 是 |
| 聚合数据 | juhe.cn | 综合 | 100次/天 | 是 |
| JSONPlaceholder | jsonplaceholder.typicode.com | 测试数据 | 无限制 | 否 |

### 附录2：常见HTTP状态码

| 状态码 | 含义 | 原因 | 解决方法 |
|--------|------|------|----------|
| 200 | 成功 | API正常返回数据 | 无需处理 |
| 401 | 未授权 | API Key错误或缺失 | 检查Key是否正确 |
| 404 | 未找到 | URL错误 | 检查URL是否正确 |
| 429 | 请求过多 | 超过调用频率限制 | 减少调用频率 |

### 附录3：常见问题FAQ

**Q1: API Key在哪里找？**
A: 登录API平台 → 控制台 → 我的API → 复制API Key

**Q2: 调用API时返回乱码怎么办？**
A: 检查URL编码，中文参数需要转码

**Q3: 如何定时自动获取API数据？**
A: 使用Excel Power Query，设置自动刷新
   - 数据 → 查询和连接 → 属性 → 刷新控制
   - 勾选"打开文件时刷新"

**Q4: JSON数据看不懂怎么办？**
A: 
1. 使用JSON Viewer插件美化显示
2. 向AI提问："请解释这段JSON数据的结构：[粘贴JSON]"
3. 使用在线JSON格式化工具

### 附录4：AI提问模板

**API基础：**
```
"什么是API？能举个简单的例子吗？"
"API和爬虫有什么区别？"
"如何判断一个API是否可靠？"
```

**API使用：**
```
"我在调用API时遇到错误代码[代码]，是什么原因？如何解决？"
"如何将这段JSON数据转换为Excel表格？"
"Excel Power Query如何连接API？请给出详细步骤。"
```

**API选择：**
```
"推荐5个适合初学者的免费API，并说明如何使用"
"我想获取[类型]数据，应该使用哪个API？"
```

---

**祝你成功获取API数据，开启实时数据分析之旅！** 🎉

