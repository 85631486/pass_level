# 任务8：重复值侦破

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 理解重复值的定义和分类（完全重复、部分重复、业务重复）
   - 了解重复值产生的原因和对数据分析的影响
   - 掌握重复值的判断标准和处理原则

2. **技能目标**
   - 能够使用条件格式快速识别重复值
   - 能够使用COUNTIF函数标记重复值
   - 能够使用Excel内置"删除重复项"工具
   - 能够制定重复值处理规则

3. **素养目标**
   - 培养数据质量意识
   - 养成处理数据前备份的习惯
   - 培养审慎决策能力，删除前三思

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 课程导入与理论讲解：25分钟
  - 方法演示与实践：40分钟
  - 成果展示与总结：25分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] AI助手账号（ChatGPT/文心一言/通义千问，至少一个）

### 📁 数据文件
**重要：请从课程数据文件夹中下载以下文件！**

- `任务8-重复值数据.csv`（59条记录，包含多种重复情况）

---

## 📋 操作步骤

### 步骤一：课程导入（10分钟）

#### 1.1 案例导入

**案例导入：**
"某电商平台因未清除重复订单，导致重复发货，损失20万元"

**💭 思考：**
- 你遇到过数据重复的情况吗？
- 重复数据会造成什么影响？

#### 1.2 学习目标

**今天的学习目标：**
1. 学会识别3种类型的重复值
2. 掌握3种去重方法
3. 制定重复值处理规则

---

### 步骤二：理论讲解（15分钟）

#### 2.1 重复值分类

**1. 完全重复**
```
定义：所有字段的值都完全相同
示例：
订单号   商品    金额   日期
001     手机    5999   2024-11-20
001     手机    5999   2024-11-20  ← 完全重复

判断：100%是数据录入错误，应该删除
```

**2. 部分重复（关键字段重复）**
```
定义：关键字段相同，但其他字段不同
示例：
订单号   商品    金额   日期
001     手机    5999   2024-11-20
001     手机    6999   2024-11-21  ← 订单号重复

判断：可能是数据错误，需要核实
处理：保留最新/最完整的记录
```

**3. 业务重复（看似重复实际正常）**
```
定义：逻辑上重复，但业务上合理
示例：
客户    商品    金额   日期
张三    手机    5999   2024-11-20
张三    手机    5999   2024-12-20  ← 同一人购买两次

判断：不是重复，是正常业务
```

#### 2.2 重复值的危害

1. 统计失真：计数、求和都会出错
2. 分析偏差：重复数据被重复计算
3. 资源浪费：发送通知时重复发送

---

### 步骤三：方法演示（25分钟）

#### 3.1 方法一：条件格式高亮显示

**演示步骤：**
1. 选中要检查的数据区域（如A2:A100）
2. 开始 → 条件格式 → 突出显示单元格规则 → 重复值
3. 选择格式（如浅红色填充）
4. 确定，重复值自动高亮显示

**优点：**
- 快速、直观
- 不修改数据，只是显示
- 可以先观察再决定

**立即实践：**
- 对订单号列使用条件格式
- 观察哪些订单号重复

#### 3.2 方法二：COUNTIF函数标记

**演示步骤：**
```excel
步骤1：在辅助列输入标题"重复次数"

步骤2：在D2单元格输入公式:
=COUNTIF($A$2:$A$100,A2)

解释:
- $A$2:$A$100：整个数据范围(绝对引用)
- A2：当前行的值(相对引用)
- 含义：统计A2这个值在整个范围中出现的次数

步骤3：向下填充公式

步骤4：筛选D列>1的，就是重复值
```

**进阶技巧：**
```excel
/* 标记是否重复(返回TRUE/FALSE) */
=COUNTIF($A$2:$A$100,A2)>1

/* 标记第一次出现还是重复出现 */
=IF(COUNTIF($A$2:A2,A2)=1,"首次","重复")
```

**立即实践：**
- 使用COUNTIF标记所有重复值
- 筛选出重复的记录

#### 3.3 方法三：删除重复项（重点）

**演示步骤：**
```
⚠️ 警告：这个操作会永久删除数据，务必先备份!

步骤1：备份数据!复制一份到新工作表
步骤2：选中要去重的数据区域(包含标题行)
步骤3：数据 → 删除重复项
步骤4：选择用哪些列判断重复
  - 选所有列：完全重复才删除
  - 只选订单号：订单号相同就删除
步骤5：确定
步骤6：Excel提示删除了几条，保留了几条
```

**重要提醒：**
1. 必须先备份！删除操作不可恢复
2. 保留的是第一次出现的记录
3. 选择关键列很重要
4. 删除后要验证数据完整性

**立即实践：**
- 先备份数据
- 删除完全重复的记录
- 记录删除了多少条

---

### 步骤四：实战练习（30分钟）

**任务目标：**
打开"任务8-重复值数据.csv"（59条记录）

**具体任务：**

**任务1：识别完全重复（10分钟）**
1. 使用条件格式识别完全重复的记录
2. 有多少条完全重复？

**任务2：识别部分重复（10分钟）**
1. 找出订单号重复，但金额或日期不同的记录
2. 这些记录应该保留哪一条？

**任务3：识别业务正常（5分钟）**
1. 找出同一客户多次购买的记录
2. 这些是重复还是正常业务？

**任务4：执行去重（5分钟）**
1. 先备份数据到新工作表
2. 删除完全重复的记录
3. 记录删除了多少条

---

### 步骤五：成果展示（10分钟）

**展示内容：**
1. 展示去重后的数据表
2. 说明发现了哪些类型的重复
3. 说明制定的处理规则和依据
4. 展示去重前后的数据量对比

---

### 步骤六：总结提升（5分钟）

**今天学会的重复值处理方法：**
1. 条件格式：快速可视化
2. COUNTIF函数：灵活标记
3. 删除重复项：一键去重（需谨慎）

**重复值处理三原则：**
1. 先备份：删除前必须备份原数据
2. 先分析：搞清楚是哪种重复，制定规则
3. 后验证：删除后检查数据完整性

**课后任务：**
1. 找一份自己的数据检查是否有重复
2. 练习COUNTIF函数的3种用法
3. 向AI提问3个关于重复值处理的问题

---

## 📚 附录

### 附录1：常见问题FAQ

**Q1: 如何一次性检查多列组合是否重复?**
A: 添加辅助列，连接多列
```excel
=A2&B2&C2
然后用COUNTIF检查辅助列
```

**Q2: COUNTIF返回2，说明有多少条重复?**
A: 返回2说明该值总共出现2次，即有1条重复
- 返回1：唯一，无重复
- 返回2：重复1次
- 返回3：重复2次

**Q3: 删除重复项保留的是第一条还是最后一条?**
A: 默认保留第一次出现的记录。
如果想保留最后一条：
1. 先按日期降序排序
2. 再删除重复项

### 附录2：重复值类型判断速查表

| 现象 | 类型 | 处理建议 |
|------|------|----------|
| 所有字段完全相同 | 完全重复 | 删除 |
| 关键字段相同，其他不同 | 部分重复 | 核查，保留合理的 |
| 同一主体多条记录 | 业务正常 | 保留 |

### 附录3：COUNTIF函数高级用法

```excel
/* 用法1：统计重复次数 */
=COUNTIF($A$2:$A$100,A2)

/* 用法2：判断是否重复(TRUE/FALSE) */
=COUNTIF($A$2:$A$100,A2)>1

/* 用法3：标记是首次还是重复 */
=IF(COUNTIF($A$2:A2,A2)=1,"首次出现","重复出现")
```

---

**祝你学习愉快！** 🎉

