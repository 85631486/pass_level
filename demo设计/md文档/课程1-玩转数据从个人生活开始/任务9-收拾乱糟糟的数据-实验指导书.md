# 任务9：收拾乱糟糟的数据

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 了解常见的数据质量问题类型
   - 掌握Excel数据清洗的基本方法
   - 理解数据清洗在分析流程中的重要性

2. **技能目标**
   - 能够识别和清理空格、重复数据
   - 能够统一数据格式（日期、数字、文本）
   - 能够处理缺失值和异常值

3. **素养目标**
   - 培养数据质量意识
   - 养成数据清洗的良好习惯
   - 建立"脏数据影响分析"的认知

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 数据问题大发现：15分钟
  - 清洗工具箱：35分钟
  - 数据清洗流程：20分钟
  - 验证清洗结果：15分钟
  - 总结与作业：5分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] AI助手账号（可选）

### 📁 数据文件
**重要：本任务使用示例数据！**

请从课程平台下载：`任务9-脏数据样本.csv`

这个文件包含有各种问题的数据，专门用来练习数据清洗。

---

## 📋 操作步骤

### 步骤一：数据问题大发现（15分钟）

#### 1.1 导入案例

**展示一份"脏数据"示例：**

```
订单号      商品名称            金额      日期
001        Apple手机         1500     2024-01-15
002         Apple手机        1500     2024/01/16
003        apple手机         1,500    2024-1-17
001        Apple手机         1500     2024-01-15  （重复）
004        Samsung手机              2024-01-18  （缺失）
005         Samsung手机      2000     20240119    （格式）
006                          500      2024-01-20  （空白）
```

**思考：** 这份数据有什么问题？能直接用来分析吗？

**立即动手：**

1. 从课程平台下载：`任务9-脏数据样本.csv`
2. 用Excel打开这个文件（方法同任务1）
3. 仔细观察，找出所有问题
4. 在纸上写下发现的问题：
   - 问题1：________________
   - 问题2：________________
   - 问题3：________________

#### 1.2 六大常见数据问题

**问题1：多余空格**
```
问题表现：
- " Apple手机"（前导空格）
- "Apple手机 "（尾随空格）
- "Apple  手机"（中间多个空格）

影响：
- 查找、匹配失败
- VLOOKUP找不到" Apple手机"
- 分类统计不准确

示例：
=COUNTIF(A:A,"Apple手机")  → 找不到" Apple手机"
```

**问题2：重复数据**
```
问题表现：
- 完全相同的记录出现多次
- 订单001出现2次

影响：
- 统计数量不准
- 金额重复计算
- 分析结果偏差

示例：
总金额被重复计算，导致虚高
```

**问题3：格式不统一**
```
问题表现：
- 日期有"2024-01-15"、"2024/01/16"、"20240117"等多种格式
- 数字有"1500"、"1,500"、"1.500"等格式

影响：
- 排序错误
- 无法按日期筛选
- 计算失败

示例：
日期格式混乱，无法正确排序
```

**问题4：大小写不一致**
```
问题表现：
- "Apple"、"apple"、"APPLE"混合
- 同一商品被当作3种

影响：
- 分类统计不准确
- 查找匹配失败

示例：
COUNTIF统计时，"Apple"和"apple"被当作不同商品
```

**问题5：缺失值**
```
问题表现：
- 某些单元格为空
- 关键字段缺失（如金额）

影响：
- 计算错误（SUM会忽略空值，但COUNT会计算）
- 统计偏差
- 无法进行某些分析

示例：
金额缺失导致SUM不准，平均值计算错误
```

**问题6：数据类型错误**
```
问题表现：
- 数字存为文本（"1500"而非1500）
- 左对齐，有绿色三角标记
- 无法参与计算

影响：
- 无法计算
- 排序错误（文本排序：1, 10, 2, 20...）
- 公式返回错误

示例：
=SUM(A:A) 返回0，因为A列是文本格式
```

**练习：** 在你的数据文件中找出这些问题

**检查清单：**
- [ ] 检查是否有前后空格
- [ ] 检查是否有重复记录
- [ ] 检查日期格式是否统一
- [ ] 检查大小写是否一致
- [ ] 检查是否有空白单元格
- [ ] 检查数字是否为文本格式

#### 📝 课堂问答：数据问题大发现

完成上述操作后，请回答以下问题：

**问题1：** 数据中的多余空格会导致什么问题？

A. 没有影响  
B. 查找、匹配失败，分类统计不准确  
C. 数据丢失  
D. 文件损坏

**正确答案：B**

**解析：** 多余空格（如前导空格、尾随空格）会导致查找、匹配失败，例如VLOOKUP找不到" Apple手机"（有前导空格），分类统计时"Apple手机"和" Apple手机"会被当作不同类别，导致统计不准确。

---

**问题2：** 数据格式不统一（如日期有多种格式）会导致什么问题？

A. 没有影响  
B. 排序错误、无法按日期筛选、计算失败  
C. 数据丢失  
D. 文件无法打开

**正确答案：B**

**解析：** 数据格式不统一会导致排序错误（如日期格式混乱无法正确排序）、无法按日期筛选（筛选功能需要统一格式）、计算失败（如日期计算需要统一格式）等问题。

---

**问题3：** 如果数字被存为文本格式，会导致什么问题？

A. 没有影响  
B. 无法参与计算、排序错误（文本排序：1, 10, 2, 20...）、公式返回错误  
C. 数据丢失  
D. 文件损坏

**正确答案：B**

**解析：** 数字存为文本格式会导致无法参与计算（如SUM函数返回0）、排序错误（文本排序规则与数字不同，如1, 10, 2, 20...）、公式返回错误等问题。可以通过转换为数字格式解决。

---

### 步骤二：清洗工具箱（35分钟）

#### 2.1 清除空格（10分钟）

**方法1：TRIM函数**

**操作步骤：**

**步骤1：在辅助列输入公式**
```
1. 在D列（或任意空白列）输入：=TRIM(A2)
   - 找到数据表右侧的空白列（例如D列）
   - 用鼠标左键单击D2单元格（与A2同一行）
   - 在单元格中输入：=TRIM(A2)
   - 按Enter键确认
   - 单元格会显示去除空格后的内容（例如"Apple手机"而不是" Apple手机 "）

2. 向下填充公式（双击填充柄或拖拽）
   - 选中D2单元格（用鼠标左键单击）
   - 将鼠标指针移动到D2单元格右下角的填充柄上
   - 鼠标指针会变成黑色十字（+）
   - 双击填充柄，或者按住鼠标左键向下拖动到最后一个数据行
   - 松开鼠标左键
   - D列会显示所有去除空格后的数据

3. 查看结果，确认空格已删除
   - 检查D列的数据，确认前后空格已被删除
   - 对比A列和D列，确认内容一致但D列没有空格
```

**步骤2：复制为值并覆盖原列**
```
1. 选中D列（公式列）
   - 将鼠标指针移动到D列列标上（D列顶部的"D"字母）
   - 用鼠标左键单击D列列标
   - 整个D列会被选中（显示为蓝色背景）
   - 或者：将鼠标指针移动到D2单元格
   - 按住鼠标左键不松开，向下拖动到最后一个有数据的单元格
   - 松开鼠标左键

2. 复制（Ctrl+C）
   - 按住键盘左下角的Ctrl键不松开
   - 同时按键盘上的C键
   - 松开两个键
   - D列的数据会被复制到剪贴板
   - 选中的区域周围会出现虚线边框，表示已复制

3. 选中A列（原数据列）
   - 将鼠标指针移动到A列列标上（A列顶部的"A"字母）
   - 用鼠标左键单击A列列标
   - 整个A列会被选中（显示为蓝色背景）
   - 或者：将鼠标指针移动到A2单元格
   - 按住鼠标左键不松开，向下拖动到最后一个有数据的单元格
   - 松开鼠标左键

4. 右键 → 选择性粘贴 → 值
   - 在选中的A列上，用鼠标右键单击（点击鼠标右键）
   - 会弹出一个菜单
   - 在菜单中找到"选择性粘贴"选项
   - 将鼠标指针移动到"选择性粘贴"上
   - 会弹出子菜单
   - 在子菜单中找到"值"选项（通常显示为数字123的图标）
   - 用鼠标左键单击"值"选项
   - Excel会将D列的值（去除空格后的数据）粘贴到A列，覆盖原有数据

5. 确认覆盖原数据
   - Excel可能会弹出提示："是否替换目标单元格的内容？"
   - 如果弹出提示，点击"确定"按钮
   - A列的数据会被替换为去除空格后的数据
```

**步骤3：删除辅助列**
```
1. 右键点击D列
   - 将鼠标指针移动到D列列标上（D列顶部的"D"字母）
   - 用鼠标右键单击D列列标
   - 会弹出一个菜单

2. 选择"删除"
   - 在菜单中找到"删除"选项
   - 用鼠标左键单击"删除"选项

3. 确认删除
   - D列会被删除，数据会向左移动
   - 或者：选中D列后，按Delete键删除内容，然后调整列宽
```

**示例：**
```
原始数据：" Apple手机 "
公式：=TRIM(A2)
结果："Apple手机"（空格已删除）
```

**方法2：查找替换**

**操作步骤：**
```
1. 选中要清理的列（如A列）
2. 按Ctrl+H打开"查找和替换"对话框
3. 查找内容：输入一个空格（按空格键）
4. 替换为：留空（不输入任何内容）
5. 点击"全部替换"
6. 重复操作，替换所有空格
```

**注意：**
- 只能删除普通空格
- 无法删除不可见字符
- 会删除所有空格（包括单词间的空格）

#### 📝 课堂问答：清除空格

完成上述操作后，请回答以下问题：

**问题1：** TRIM函数的作用是什么？

A. 删除所有空格  
B. 删除文本前后的空格，以及文本中间多余的空格（只保留单词间的一个空格）  
C. 删除文本中的所有内容  
D. 添加空格

**正确答案：B**

**解析：** TRIM函数用于删除文本前后的空格（前导空格和尾随空格），以及文本中间多余的空格（只保留单词间的一个空格）。例如" Apple 手机 "会变成"Apple 手机"。

---

**问题2：** 使用TRIM函数清理数据后，如何将清理后的结果覆盖原数据？

A. 直接删除原列  
B. 复制公式列 → 选择性粘贴 → 值，覆盖原列  
C. 手动输入  
D. 无法覆盖

**正确答案：B**

**解析：** 使用TRIM函数清理数据后，需要将清理后的结果覆盖原数据。方法是：复制公式列（Ctrl+C），选中原数据列，右键 → 选择性粘贴 → 值，这样可以将公式结果（值）覆盖原数据，而不是公式本身。

---

**问题3：** 如果要同时清除空格和不可见字符，应该使用什么函数组合？

A. TRIM函数  
B. CLEAN函数  
C. TRIM(CLEAN())函数组合  
D. 无法实现

**正确答案：C**

**解析：** 如果要同时清除空格和不可见字符，应该使用TRIM(CLEAN())函数组合。CLEAN函数清除不可见字符，TRIM函数清除空格，组合使用可以同时处理两种问题。

---

**方法3：CLEAN函数（清除不可见字符）**

**操作步骤：**
```
1. 使用 =CLEAN(A2) 清除不可见字符
2. 或组合使用 =TRIM(CLEAN(A2)) 同时清除空格和不可见字符
3. 复制粘贴为值覆盖原列
```

**你的任务：**
1. 在样本文件中清理商品名称列的空格
2. 对比TRIM和替换的效果
3. 向AI提问：TRIM和替换有什么区别？什么时候用哪个？

**向AI提问模板：**
```
"我的Excel数据中有多余的空格，例如：
- ' Apple手机'（前导空格）
- 'Apple手机 '（尾随空格）
- 'Apple  手机'（中间多个空格）

应该用TRIM函数还是查找替换？有什么区别？"
```

---

#### 2.2 删除重复值（8分钟）

**方法：使用Excel的"删除重复值"工具**

**操作步骤：**

**步骤1：选中数据区域**
```
1. 选中包含标题行的整个数据区域
   - 将鼠标指针移动到数据表左上角（通常是A1单元格）
   - 按住鼠标左键不松开
   - 拖动鼠标到数据表右下角（最后一个有数据的单元格）
   - 松开鼠标左键
   - 此时整个数据表被选中（显示为蓝色背景）
   - 确保选中了标题行（第1行）和所有数据行

2. 或按Ctrl+A全选（如果数据连续）
   - 用鼠标左键单击数据表中的任意一个单元格（例如A2）
   - 按住键盘左下角的Ctrl键不松开
   - 同时按键盘上的A键
   - 松开两个键
   - Excel会自动选中整个连续的数据区域（包括标题行）

3. 确保包含所有列
   - 检查选中的区域是否包含了所有需要检查的列
   - 如果数据不连续（中间有空行或空列），需要手动选中整个区域
```

**步骤2：打开删除重复值对话框**
```
1. 点击"数据"选项卡
   - 在Excel顶部找到"数据"选项卡（通常在"插入"选项卡的右边）
   - 用鼠标左键单击"数据"选项卡

2. 找到"数据工具"组
   - 在"数据"选项卡的工具栏中，找到"数据工具"组
   - 这个组通常在工具栏的中间位置

3. 点击"删除重复值"按钮
   - 在"数据工具"组中，找到"删除重复值"按钮
   - 按钮上可能显示文字"删除重复值"或图标
   - 用鼠标左键单击"删除重复值"按钮
   - 会弹出一个对话框："删除重复值"
```

**步骤3：选择检查列**
```
1. 在对话框中，勾选要检查的列
   - 在"删除重复值"对话框中，会显示一个列表，列出所有列的名称
   - 每列前面有一个方框（复选框）
   - 用鼠标左键单击方框，可以勾选或取消勾选该列

2. 如果所有列都相同才算重复，全选
   - 如果希望所有列的数据都完全相同才算重复记录，需要勾选所有列
   - 用鼠标左键单击"全选"按钮（如果有），或者逐个勾选所有列
   - 例如：订单号、商品名称、金额、日期等所有列都勾选

3. 如果只检查特定列（如订单号），只勾选该列
   - 如果只希望根据特定列（如订单号）来判断重复，只勾选该列
   - 取消勾选其他列（用鼠标左键单击其他列的方框，去掉勾选）
   - 例如：只勾选"订单号"列，其他列不勾选
   - 这样只要订单号相同，就会被认为是重复记录

4. 点击"确定"
   - 在对话框右下角找到"确定"按钮
   - 用鼠标左键单击"确定"按钮
   - Excel会开始检查并删除重复值
```

**步骤4：确认删除结果**
```
Excel会提示：
"发现了X个重复值，已将其删除；保留了Y个唯一值。"
点击"确定"
   - Excel处理完成后，会弹出一个提示对话框
   - 对话框中会显示删除的结果：
     * "发现了X个重复值"：表示找到了X条重复记录
     * "已将其删除"：表示已删除这些重复记录
     * "保留了Y个唯一值"：表示保留了Y条不重复的记录
   - 阅读提示信息，确认删除结果是否符合预期
   - 在对话框右下角找到"确定"按钮
   - 用鼠标左键单击"确定"按钮
   - 对话框会关闭，回到Excel工作表
   - 检查数据表，确认重复记录已被删除
```

**注意事项：**
- ⚠️ **操作不可撤销**，务必先备份原始数据
- 默认保留第一次出现的记录
- 可以只检查特定列的重复（如只检查订单号）

**示例场景：**

**场景1：完全重复的记录**
```
订单号    商品      金额
001      Apple    1500
002      Samsung  2000
001      Apple    1500  ← 重复，会被删除
```

**场景2：部分列重复**
```
如果只检查"订单号"列：
- 订单号001出现2次，但金额不同
- 只保留第一次出现的记录
```

**你的任务：**
1. 删除样本文件中的重复订单
2. 记录删除了多少条
3. 思考：如何判断两条记录是否重复？

**向AI提问：**
```
"我的Excel数据中有重复记录，例如订单号001出现了2次。
我应该删除完全相同的行，还是只检查订单号列？
如何判断？"
```

---

#### 2.3 统一格式（10分钟）

**场景1：统一日期格式**

**问题：** 日期有"2024-01-15"、"2024/01/16"、"20240117"等多种格式

**解决方案1：文本到列（推荐）**

**操作步骤：**
```
1. 选中日期列
2. 点击"数据" → "分列"
3. 选择"分隔符号"或"固定宽度"
4. 点击"下一步"
5. 在"列数据格式"中选择"日期"
6. 选择日期格式（如YMD）
7. 点击"完成"
```

**解决方案2：公式转换**

**公式1：TEXT函数**
```
=TEXT(A2,"yyyy-mm-dd")
将日期转换为指定格式的文本
```

**公式2：DATEVALUE函数**
```
=DATEVALUE(A2)
将文本日期转换为日期值
```

**解决方案3：向AI求助**
```
"我有多种日期格式混合：
- 2024-01-15
- 2024/01/16
- 20240117

如何统一为yyyy-mm-dd格式？请给出Excel操作步骤。"
```

**你的任务：**
1. 统一样本文件的日期格式为"yyyy-mm-dd"
2. 尝试使用分列和公式两种方法
3. 对比效果

**场景2：统一大小写**

**问题：** "Apple"、"apple"、"APPLE"混合

**解决方案：使用函数转换**

**函数选择：**
```
=UPPER(A2)   → 全部大写（APPLE）
=LOWER(A2)   → 全部小写（apple）
=PROPER(A2)  → 首字母大写（Apple）
```

**操作步骤：**
```
1. 在辅助列输入公式（如 =PROPER(A2)）
2. 向下填充公式
3. 复制辅助列
4. 选择性粘贴为值到原列
5. 删除辅助列
```

**你的任务：**
1. 统一商品名称为首字母大写（PROPER）
2. 记录操作步骤

**场景3：数字文本转数字**

**问题：** 金额列是文本格式的数字（左对齐，有绿色三角标记）

**解决方案1：错误检查（最简单）**
```
1. 选中包含文本数字的列
2. 点击列标题旁的绿色三角
3. 选择"转换为数字"
```

**解决方案2：VALUE函数**
```
=VALUE(A2)
将文本数字转换为数值
```

**解决方案3：快捷操作（批量转换）**
```
1. 在空白单元格输入1
2. 复制这个1（Ctrl+C）
3. 选中文本数字列
4. 右键 → 选择性粘贴
5. 选择"乘"
6. 点击"确定"
```

**你的任务：**
1. 将文本数字转换为真正的数字
2. 尝试三种方法，选择最方便的

---

#### 2.4 处理缺失值（7分钟）

**策略选择：根据业务需求决定**

**策略1：删除包含缺失值的行**

**适用场景：**
- 缺失关键字段（如金额）
- 缺失值无法推算
- 缺失值比例较小

**操作步骤：**
```
1. 选中数据区域
2. 点击"数据" → "筛选"
3. 在缺失列的下拉菜单中，取消勾选所有值
4. 勾选"空白"
5. 选中筛选出的空白行
6. 右键 → 删除行
7. 取消筛选
```

**策略2：填充默认值**

**适用场景：**
- 可以用默认值替代
- 缺失值不影响主要分析

**操作步骤：**
```
1. 选中包含缺失值的列
2. 按Ctrl+H打开替换
3. 查找内容：留空（不输入）
4. 替换为：0 或 "未知" 或其他默认值
5. 点击"全部替换"
```

**策略3：填充上一个值**

**适用场景：**
- 连续记录中的重复值
- 如：同一订单的多行记录，商品名只填第一行

**操作步骤：**
```
1. 选中包含缺失值和上一个值的单元格
2. 按Ctrl+G打开定位
3. 定位条件 → 空值
4. 输入 = 然后按↑键（引用上一个单元格）
5. 按Ctrl+Enter批量填充
```

**策略4：使用公式填充**

**适用场景：**
- 可以从其他列推算
- 需要条件判断

**公式示例：**
```
=IF(ISBLANK(A2),"默认值",A2)
如果A2为空，显示"默认值"，否则显示A2的值
```

**你的任务：**
1. 识别样本文件中的缺失值
2. 根据情况选择处理策略
3. 向AI咨询：如何判断应该删除还是填充？

**向AI提问：**
```
"我的Excel数据中，金额列有8个空白单元格。
我应该删除这些行，还是填充默认值（如0）？
如何判断？"
```

---

### 步骤三：数据清洗流程（20分钟）

#### 3.1 标准流程

**数据清洗七步法：**

```
步骤1：备份原始数据
   ↓
步骤2：检查数据概况（行数、列数、数据类型）
   ↓
步骤3：识别质量问题（空格、重复、格式等）
   ↓
步骤4：清洗空格和不可见字符
   ↓
步骤5：删除重复值
   ↓
步骤6：统一格式（日期、大小写、数字）
   ↓
步骤7：处理缺失值和异常值
   ↓
步骤8：验证清洗结果
```

**详细说明：**

**步骤1：备份原始数据**
```
操作：复制整个工作表，命名为"原始数据备份"
原因：清洗操作可能不可撤销，需要保留原始数据
```

**步骤2：检查数据概况**
```
检查项：
- 总行数：=COUNTA(A:A)-1（减去标题行）
- 总列数：目视检查
- 数据类型：选中列查看格式
- 是否有空行空列
```

**步骤3：识别质量问题**
```
使用检查清单：
□ 前后空格
□ 重复数据
□ 日期格式
□ 大小写
□ 缺失值
□ 文本数字
```

**步骤4-7：按顺序清洗**
```
按照前面学习的方法，逐步清洗
每完成一步，记录结果
```

**步骤8：验证清洗结果**
```
使用验证方法检查清洗是否成功
```

#### 3.2 综合实战

**任务：** 完整清洗 `任务9-脏数据样本.csv`

**要求清单：**

**□ 清除所有多余空格**
- [ ] 商品名称列
- [ ] 其他文本列

**□ 删除重复记录**
- [ ] 检查完全重复的行
- [ ] 记录删除数量

**□ 统一日期格式为"yyyy-mm-dd"**
- [ ] 检查日期列
- [ ] 统一格式

**□ 统一商品名称为首字母大写**
- [ ] 使用PROPER函数
- [ ] 覆盖原列

**□ 将文本数字转换为数字格式**
- [ ] 检查金额列
- [ ] 转换为数字

**□ 处理缺失的金额**
- [ ] 识别缺失值
- [ ] 选择策略（删除或填充）
- [ ] 执行操作

**□ 创建清洗日志**
```
记录每步操作：
1. 清除空格：删除了X个前导/尾随空格
2. 删除重复：删除了X条重复记录
3. 统一日期：转换了X个日期格式
4. ...
```

**你的任务：**
1. 按照七步法完整清洗数据
2. 记录清洗前后数据对比
3. 遇到问题向AI求助
4. 创建清洗日志

**清洗日志模板：**
```
数据清洗日志

原始数据：
- 总行数：120
- 总列数：4
- 发现的问题：空格、重复、格式不统一、缺失值

清洗过程：
1. 清除空格
   - 操作：使用TRIM函数
   - 结果：清除了15个前导空格，8个尾随空格

2. 删除重复值
   - 操作：数据→删除重复值
   - 结果：删除了12条重复记录

3. 统一日期格式
   - 操作：使用分列功能
   - 结果：统一了35个日期格式

4. 统一大小写
   - 操作：使用PROPER函数
   - 结果：统一了28个商品名称

5. 转换数字格式
   - 操作：使用VALUE函数
   - 结果：转换了10个文本数字

6. 处理缺失值
   - 操作：删除包含缺失金额的行
   - 结果：删除了5行

清洗后数据：
- 总行数：103
- 数据质量：已通过验证
```

---

### 步骤四：验证清洗结果（15分钟）

#### 4.1 质量检查

**检查项1：空格是否清除**

**方法1：使用COUNTIF查找前导空格**
```
=COUNTIF(A:A," *")
查找以空格开头的单元格，结果应为0
```

**方法2：使用LEN函数对比**
```
=IF(LEN(A2)<>LEN(TRIM(A2)),"有空格","无空格")
如果长度不同，说明有空格
```

**检查项2：重复是否删除**

**方法：使用条件格式**
```
1. 选中数据区域
2. 开始 → 条件格式 → 突出显示单元格规则 → 重复值
3. 应该没有重复项高亮
```

**检查项3：格式是否统一**

**方法：使用公式检查**
```
日期列：=TEXT(A2,"yyyy-mm-dd")=A2
应该全为TRUE（如果A2已经是yyyy-mm-dd格式）

或使用：=ISNUMBER(A2) 检查是否为日期值
```

**检查项4：数据类型是否正确**

**方法：使用ISNUMBER函数**
```
=ISNUMBER(金额列)
应该全为TRUE（如果金额列是数字）
```

**检查项5：缺失值是否处理**

**方法：使用COUNTBLANK函数**
```
=COUNTBLANK(A:A)
关键列应为0（或可接受的缺失数量）
```

**你的任务：**
1. 对清洗后的数据执行以上检查
2. 记录检查结果
3. 如有问题，继续清洗

#### 4.2 对比分析

**统计清洗效果：**

**清洗前统计：**
```
- 总行数：120
- 重复行：15
- 缺失值：8
- 格式问题：35
- 空格问题：23
```

**清洗后统计：**
```
- 总行数：103（删除了重复和缺失）
- 重复行：0
- 缺失值：0
- 格式问题：0
- 空格问题：0
```

**清洗效果计算：**
```
清洗率 = (处理的问题数 / 原始问题数) × 100%
数据保留率 = (清洗后行数 / 清洗前行数) × 100%

示例：
清洗率 = (15+8+35+23) / (15+8+35+23) × 100% = 100%
数据保留率 = 103 / 120 × 100% = 85.8%
```

**你的任务：**
1. 制作清洗前后对比表
2. 计算清洗效果
3. 分析数据质量提升情况

---

## 📝 作业要求

### 提交内容

**实践任务：**

**任务1：清洗示例数据（必做）**
- 使用七步法清洗你的消费数据
- 记录清洗日志
- 制作清洗前后对比图表

**任务2：制作清洗模板（选做）**
- 创建一个可重复使用的清洗模板
- 包含常用清洗公式
- 添加使用说明

**提交内容：**

**文档：数据清洗报告（500字）**
```
一、原始数据概况
   - 数据来源：[说明数据来源]
   - 行数/列数：[具体数字]
   - 发现的问题清单：[列出所有问题]

二、清洗过程
   - 步骤1：[操作和结果]
   - 步骤2：[操作和结果]
   - 步骤3：[操作和结果]
   - ...（详细记录每一步）

三、清洗结果
   - 清洗前后对比表：
     | 项目 | 清洗前 | 清洗后 | 改善 |
     |------|--------|--------|------|
     | 总行数 | 120 | 103 | -17 |
     | 重复行 | 15 | 0 | -15 |
     | 缺失值 | 8 | 0 | -8 |
     | ... | ... | ... | ... |
   
   - 质量检查结果：
     □ 空格已清除
     □ 重复已删除
     □ 格式已统一
     □ 数据类型正确
     □ 缺失值已处理
   
   - 数据可用性评估：[说明数据现在是否可以用于分析]

四、经验总结
   - 遇到的难点：[描述遇到的问题]
   - 解决方法：[如何解决的]
   - AI的帮助：[AI提供了哪些帮助]
   - 心得体会：[学到了什么]
```

**Excel文件：**
- 清洗前数据（原始备份）
- 清洗后数据
- 清洗过程工作表（含公式和日志）

**文件命名：**
- `学号_姓名_任务9_数据清洗.docx`
- `学号_姓名_任务9_数据清洗.xlsx`

**提交截止：**下次上课前

### 加分项（可选）
- 开发自动化清洗宏（VBA）
- 总结"数据清洗最佳实践"文档
- 制作清洗效果可视化对比图表
- 帮助同学解决清洗问题

---

## ❓ 常见问题

### Q1: 清洗操作后数据变少了，正常吗？
**A:** 
- 正常，如果删除了重复值和缺失值，行数会减少
- 这是数据质量提升的表现
- 但要确保删除的数据确实应该删除

### Q2: TRIM函数和查找替换有什么区别？
**A:** 
- TRIM：只删除前后空格，保留单词间的一个空格
- 查找替换：删除所有空格（包括单词间的）
- 一般用TRIM更安全

### Q3: 如何判断缺失值应该删除还是填充？
**A:** 
- 关键字段缺失（如金额）→ 删除
- 非关键字段缺失（如备注）→ 可以填充
- 缺失比例很小（<5%）→ 可以删除
- 缺失比例很大（>20%）→ 需要分析原因

### Q4: 清洗后公式报错怎么办？
**A:** 
- 检查数据类型是否正确
- 检查单元格引用是否有效
- 使用任务8学到的debug方法
- 向AI求助

---

## 💡 学习提示

1. **先备份**：清洗前务必备份原始数据
2. **系统化**：按照七步法逐步清洗，不要跳步
3. **记录过程**：详细记录每步操作，便于复查
4. **验证结果**：清洗后一定要验证，确保质量
5. **善用AI**：遇到问题及时向AI求助

---

## 📚 数据清洗速查表

| 问题 | 检测方法 | 清洗方法 | 函数/工具 |
|------|----------|----------|-----------|
| 前后空格 | 长度对比 | TRIM函数 | =TRIM(A1) |
| 不可见字符 | CLEAN检测 | CLEAN函数 | =CLEAN(A1) |
| 重复数据 | 条件格式 | 删除重复值 | 数据→删除重复值 |
| 日期格式 | 目视/公式 | TEXT/分列 | =TEXT(A1,"yyyy-mm-dd") |
| 大小写 | 目视检查 | UPPER/LOWER | =UPPER(A1) |
| 文本数字 | ISNUMBER | VALUE/乘1 | =VALUE(A1) |
| 缺失值 | COUNTBLANK | 删除/填充 | =IF(ISBLANK(A1),...) |
| 异常值 | 统计分析 | 筛选/IF | 根据业务规则 |

---

## 📚 常用清洗公式

**综合清洗公式：**
```
=TRIM(CLEAN(A2))
同时清除空格和不可见字符
```

**条件清洗：**
```
=IF(ISBLANK(A2),"默认值",TRIM(A2))
清洗并处理空值
```

**格式转换：**
```
=TEXT(A2,"yyyy-mm-dd")  日期格式
=VALUE(A2)              文本转数字
=UPPER(A2)              转大写
=PROPER(A2)             首字母大写
```

---

## 📚 数据质量检查清单

**□ 完整性检查**
- [ ] 所有必填字段无缺失
- [ ] 记录数符合预期
- [ ] 关键列无空白

**□ 准确性检查**
- [ ] 数据类型正确
- [ ] 数值范围合理
- [ ] 日期逻辑正确

**□ 一致性检查**
- [ ] 格式统一
- [ ] 编码规范
- [ ] 命名一致

**□ 唯一性检查**
- [ ] 无重复记录
- [ ] 主键唯一
- [ ] 组合唯一性

**□ 有效性检查**
- [ ] 数据符合业务规则
- [ ] 关联关系正确
- [ ] 逻辑约束满足

---

## 🎯 自我检查

完成本任务后，请检查：

- [ ] 能够识别六种常见数据质量问题
- [ ] 掌握了清除空格的方法（TRIM、替换）
- [ ] 能够删除重复值
- [ ] 能够统一日期、大小写、数字格式
- [ ] 能够处理缺失值（删除或填充）
- [ ] 按照七步法完成了数据清洗
- [ ] 验证了清洗结果
- [ ] 完成了作业提交

---

**祝你学习顺利！** 🎉

