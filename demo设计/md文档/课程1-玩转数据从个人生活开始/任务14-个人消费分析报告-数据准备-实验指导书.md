# 任务14：个人消费分析报告-数据准备

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 了解数据分析项目的完整流程
   - 掌握数据准备的关键步骤
   - 理解分析需求和数据之间的关系

2. **技能目标**
   - 能够整合和清洗消费数据
   - 能够创建分析所需的辅助列
   - 能够验证数据质量

3. **素养目标**
   - 培养项目思维和规划能力
   - 建立数据分析的系统化方法论
   - 养成严谨的数据处理习惯

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 项目导入：15分钟
  - 明确分析需求：20分钟
  - 数据整合与清洗：30分钟
  - 创建辅助列：30分钟
  - 数据结构检查：10分钟
  - 保存与备份：5分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] 任务1的示例数据文件（任务1-示例网购数据.csv）
- [ ] AI助手账号（可选）

### 📁 数据说明
**本任务使用任务1的示例数据，不需要导出自己的数据！**

如果之前已经对示例数据进行了分类和处理，直接使用即可。
如果没有，我们会在这个任务中一起完成。

---

## 📋 操作步骤

### 步骤一：项目导入（15分钟）

#### 1.1 项目目标

**最终成果展示：**

一份完整的个人消费分析报告，包含：

**第一部分：数据概览**
- 消费总金额
- 订单总数
- 平均每单金额
- 消费时间范围

**第二部分：时间分析**
- 每月消费趋势图
- 消费高峰期识别
- 周末vs工作日消费对比

**第三部分：类别分析**
- 各类别消费占比饼图
- 类别消费排名
- 主要消费类别分析

**第四部分：店铺分析**
- 常购店铺TOP10
- 店铺消费金额对比
- 忠诚度分析

**第五部分：洞察与建议**
- 消费习惯总结
- 节省建议
- 优化方向

#### 1.2 项目规划

**四个任务分工：**

```
任务14（本次）：数据准备
- 数据整合
- 数据清洗
- 辅助列创建
- 质量验证

任务15：图表制作
- 趋势图
- 饼图
- 柱状图
- 组合图

任务16：发现与建议
- 数据洞察
- 规律总结
- 建议提出

任务17：排版美化
- 报告布局
- 格式统一
- 视觉优化

任务18：展示互评
- 成果展示
- 互相评价
- 经验分享
```

**今天的目标：**准备好干净、完整、结构合理的数据，为后续分析打基础

**你的任务：**
1. 理解项目整体规划
2. 明确本次任务的目标
3. 准备任务1的示例数据文件

---

### 步骤二：明确分析需求（20分钟）

#### 2.1 提出分析问题

**引导思考：关于你的消费，你想知道什么？**

**时间维度：**
- 每月花多少钱？趋势如何？
- 哪个月花得最多/最少？
- 周末和工作日消费有差异吗？
- 有消费高峰期吗？

**类别维度：**
- 钱都花在哪些类别上？
- 哪个类别占比最大？
- 有哪些"非必要消费"？

**店铺维度：**
- 最常在哪些店铺购物？
- 哪个店铺花费最多？
- 有特别偏好的品牌吗？

**金额维度：**
- 平均每笔消费多少？
- 大额消费（>500）有多少？
- 小额消费（<100）占比？

**行为洞察：**
- 有冲动消费吗？
- 消费是否合理？
- 哪些可以节省？

**你的任务：**
1. 列出自己的问题清单（至少5个）
2. 记录在文档中

#### 2.2 需求转换为数据字段

**分析需求 → 需要的数据字段**

| 分析需求 | 需要的字段 | 如何获得 |
|----------|------------|----------|
| 每月消费趋势 | 月份 | 从日期提取 |
| 类别占比 | 消费类别 | 手动分类或规则提取 |
| 周末vs工作日 | 星期几/是否周末 | 从日期计算 |
| 大额消费占比 | 消费等级 | 根据金额分类 |
| 店铺偏好 | 店铺名称、品牌 | 清洗店铺名 |
| 平均每单 | 金额 | 原始数据 |
| 消费合理性 | 必要性标签 | 手动标注 |

**示例：**
```
问题：我想知道每月消费趋势

数据需求：
1. 日期字段（原始数据有）
2. 月份字段（需要新增：从日期提取）
3. 金额字段（原始数据有）

实现方法：
新增"月份"列：=MONTH(日期列)
或 =TEXT(日期列,"yyyy-mm")
```

**你的任务：**
1. 将你的5个分析问题转换为数据字段需求
2. 列出需要创建的辅助列
3. 向AI提问：如何实现某个分析需求？

**向AI提问模板：**
```
"我想分析[具体问题]，
需要哪些数据字段？
如何从现有数据中获得这些字段？"
```

---

### 步骤三：数据整合与清洗（30分钟）

#### 3.1 数据整合

**场景：数据来自多个来源**

**数据来源示例：**
```
- Sheet1：淘宝订单（50条）
- Sheet2：京东订单（30条）
- Sheet3：线下消费（20条）
```

**整合步骤：**

**步骤1：创建新工作表**
```
1. 创建新工作表"汇总数据"
2. 设计统一的表头结构
```

**步骤2：统一列名**
```
统一为：日期、商品、金额、来源
确保所有数据源的列名一致
```

**步骤3：复制数据**
```
1. 从Sheet1复制数据到汇总表
2. 从Sheet2复制数据到汇总表
3. 从Sheet3复制数据到汇总表
4. 添加"数据来源"列标注每条记录的来源
```

**步骤4：统一格式**
```
1. 统一日期格式（yyyy-mm-dd）
2. 统一金额单位（元）
3. 统一文本格式
```

**步骤5：检查**
```
- 总行数核对：50+30+20=100
- 无重复数据
- 格式一致
```

**你的任务：**
1. 使用任务1的示例数据（如果之前有处理过，继续使用；如果没有，现在开始处理）
2. 统一列名和格式
3. 添加数据来源标注

#### 3.2 数据清洗

**应用前面学过的技能：**

**清洗清单：**
```
□ 删除完全重复的记录
□ 清除多余空格（TRIM）
□ 统一日期格式（yyyy-mm-dd）
□ 统一大小写（PROPER）
□ 删除或填充缺失值
□ 转换文本数字为数字
□ 删除无效记录（金额为0等）
```

**操作步骤：**

**步骤1：删除重复**
```
1. 选中数据区域
2. 数据 → 删除重复值
3. 记录删除数量
```

**步骤2：清除空格**
```
1. 使用TRIM函数清除前后空格
2. 复制粘贴为值
```

**步骤3：统一格式**
```
1. 统一日期格式
2. 统一大小写
3. 转换文本数字
```

**步骤4：处理缺失值**
```
1. 识别缺失值
2. 根据情况删除或填充
```

**你的任务：**
1. 检查数据质量
2. 执行清洗步骤
3. 记录清洗前后对比

**清洗日志模板：**
```
数据清洗日志

清洗前：
- 总行数：120
- 重复行：5
- 格式问题：15
- 缺失值：3

清洗操作：
1. 删除重复：删除了5条
2. 清除空格：处理了10个
3. 统一格式：处理了15个
4. 处理缺失：删除了3条

清洗后：
- 总行数：112
- 数据质量：已通过验证
```

#### 3.3 数据验证

**质量检查：**
```
□ 日期范围合理（如2024年）
□ 金额都大于0
□ 没有明显异常值
□ 商品/店铺名称规范
□ 无重复记录
□ 无空白关键字段
```

**统计信息：**
```
- 总记录数：___条
- 日期范围：___至___
- 金额范围：___至___
- 总金额：___元
- 平均金额：___元
```

**你的任务：**
1. 完成质量检查
2. 记录统计信息
3. 如有问题，继续清洗

---

### 步骤四：创建辅助列（30分钟）

#### 4.1 时间维度辅助列

**需要创建的列：**

**列1：年份**
```
=YEAR(日期列)
作用：年度对比分析
```

**列2：月份**
```
=MONTH(日期列)
作用：月度趋势分析
```

**列3：年月**
```
=TEXT(日期列,"yyyy-mm")
作用：按月统计时更清晰
```

**列4：星期几**
```
=WEEKDAY(日期列)
返回：1-7（1=周日）

或用TEXT显示中文：
=TEXT(日期列,"aaaa")
返回：星期一、星期二...
```

**列5：是否周末**
```
=IF(OR(WEEKDAY(日期列)=1,WEEKDAY(日期列)=7),"周末","工作日")
```

**列6：季度**
```
="Q"&ROUNDUP(MONTH(日期列)/3,0)
返回：Q1, Q2, Q3, Q4
```

**你的任务：**
1. 创建所有时间维度列
2. 验证公式是否正确
3. 填充到所有行

#### 4.2 金额维度辅助列

**列7：消费等级**
```
=IF(金额>1000,"大额",IF(金额>500,"中额","小额"))
或更细：
=IF(金额>2000,"特大额",IF(金额>1000,"大额",IF(金额>500,"中额",IF(金额>100,"小额","微额"))))
```

**列8：占总额比例**
```
=金额/SUM($金额列$2:$金额列$最后一行)
格式设置为百分比

注意：使用绝对引用固定总和范围
```

**列9：累计金额**
```
=SUM($金额列$2:金额列当前行)
作用：查看消费累积情况
```

**你的任务：**
1. 创建金额维度辅助列
2. 设置百分比格式
3. 验证计算结果

#### 4.3 分类维度辅助列

**列10：消费类别**

**方法1：手动分类（简单但费时）**
```
根据商品名称手动标注：
- 电子产品
- 服装鞋帽
- 食品饮料
- 日用百货
- 图书教育
- 娱乐休闲
- 其他
```

**方法2：关键词自动分类（推荐）**
```
=IF(ISNUMBER(FIND("手机",商品名)),"电子产品",
  IF(ISNUMBER(FIND("衣服",商品名)),"服装",
  IF(ISNUMBER(FIND("食品",商品名)),"食品",
  "其他")))
```

**方法3：使用VLOOKUP查找表**
```
创建分类对照表：
关键词    类别
手机      电子产品
电脑      电子产品
衣服      服装
裤子      服装
...

公式（可向AI求助）
```

**你的任务：**
1. 选择一种方法给数据分类
2. 至少分5个类别
3. 向AI提问：如何根据商品名自动分类？

**向AI提问：**
```
"我有商品名称列，想根据关键词自动分类，
类别有：电子、服装、食品、日用、其他
应该用什么公式？请给出完整的嵌套IF公式。"
```

**列11：品牌**
```
从店铺名或商品名提取品牌
=LEFT(店铺名,FIND("官",店铺名)-1)
或手动标注主要品牌
```

#### 4.4 其他辅助列

**列12：序号**
```
=ROW()-1
作用：恢复排序、引用
```

**列13：必要性（可选）**
```
手动标注：必需/可选/冲动
作用：分析消费合理性
```

**列14：备注**
```
记录特殊情况
```

**你的任务：**
1. 创建必要的辅助列
2. 确保所有公式正确
3. 填充到所有行

---

### 步骤五：数据结构检查（10分钟）

#### 5.1 最终数据结构

**必备列清单：**
```
□ 序号
□ 日期（原始）
□ 年份
□ 月份
□ 年月
□ 星期几
□ 是否周末
□ 商品名称
□ 消费类别
□ 金额
□ 消费等级
□ 占比
□ 店铺/品牌
□ 数据来源
```

**表头示例：**
| 序号 | 日期 | 年月 | 周末 | 商品 | 类别 | 金额 | 等级 | 店铺 | 品牌 |
|------|------|------|------|------|------|------|------|------|------|

**你的任务：**
1. 检查是否所有必备列都已创建
2. 调整列的顺序（可选）
3. 确保表头清晰

#### 5.2 质量终检

**检查项：**
```
□ 所有列都有标题
□ 数据无空白（关键列）
□ 格式统一
□ 公式无错误
□ 总数核对正确
□ 辅助列填充完整
□ 数据已保存
```

**统计摘要：**
```
记录总数：___
金额总计：___元
时间跨度：___ ~ ___
类别数量：___个
店铺数量：___个
```

**你的任务：**
1. 完成所有检查项
2. 记录统计摘要
3. 如有问题，及时修复

---

### 步骤六：保存与备份（5分钟）

#### 6.1 文件组织

**工作表结构：**
```
Sheet1：原始数据（备份，只读）
Sheet2：清洗数据（处理后的）
Sheet3：辅助列完整数据（最终用于分析）
Sheet4：分类对照表（如有）
Sheet5：数据说明
```

#### 6.2 保存规范

**文件命名：**
```
学号_姓名_个人消费分析数据_v1.0.xlsx
```

**保存位置：**
```
指定文件夹
```

**备份：**
```
另存一份到云盘/U盘
```

**你的任务：**
1. 组织工作表结构
2. 保存文件
3. 创建备份

---

## 📝 作业要求

### 提交内容

**实践任务：**

**任务1：完成数据准备（必做）**
1. 整合所有消费数据
2. 完成数据清洗
3. 创建所有必要的辅助列
4. 完成质量检查

**任务2：数据准备报告（必做）**
记录数据准备过程

**提交内容：**

**Excel文件：**
- 包含所有工作表的完整数据文件
- 文件命名：`学号_姓名_任务14_数据准备.xlsx`

**Word文档（500字）：**
```
一、数据整合
   - 数据来源：[列出数据来源]
   - 整合方法：[如何整合的]
   - 整合结果：[总记录数、时间范围等]

二、数据清洗
   - 发现的问题：[列出发现的问题]
   - 清洗操作：[执行的清洗步骤]
   - 清洗结果：[清洗前后对比]

三、辅助列创建
   - 创建的辅助列：[列出所有辅助列]
   - 创建方法：[使用的公式]
   - 用途说明：[每个辅助列的用途]

四、质量检查
   - 检查结果：[质量检查结果]
   - 统计摘要：[记录总数、金额总计等]
   - 数据可用性：[数据是否可用于分析]

五、心得体会
   - 遇到的难点：[描述遇到的问题]
   - 解决方法：[如何解决的]
   - AI的帮助：[AI提供了哪些帮助]
   - 学习收获：[学到了什么]
```

**文件命名：**
- `学号_姓名_任务14_数据准备.xlsx`
- `学号_姓名_任务14_数据准备.docx`

**提交截止：**下次上课前

### 加分项（可选）
- 创建更详细的分类体系
- 使用高级公式自动分类
- 创建数据字典文档
- 设计数据质量监控表

---

## ❓ 常见问题

### Q1: 数据来自多个平台，格式不一致？
**A:** 
- 先统一列名
- 统一日期和金额格式
- 添加数据来源列标注

### Q2: 如何快速给商品分类？
**A:** 
- 使用关键词自动分类公式
- 或创建分类对照表用VLOOKUP
- 或向AI求助设计分类公式

### Q3: 辅助列公式填充后出错？
**A:** 
- 检查引用是否正确
- 检查数据类型是否匹配
- 使用任务8学到的debug方法

### Q4: 数据量太大，处理慢？
**A:** 
- 先处理部分数据测试
- 使用批量操作
- 公式填充后转换为值

### Q5: 如何验证数据质量？
**A:** 
- 检查关键字段无空白
- 检查数值范围合理
- 检查格式统一
- 统计总数核对

---

## 💡 学习提示

1. **系统化处理**：按照步骤逐步完成，不要跳步
2. **记录过程**：详细记录每步操作，便于复查
3. **验证结果**：每完成一步都要验证结果
4. **善用AI**：遇到问题及时向AI求助
5. **备份重要**：处理前先备份原始数据

---

## 📚 辅助列创建速查表

| 辅助列 | 公式 | 用途 |
|--------|------|------|
| 年份 | =YEAR(日期) | 年度分析 |
| 月份 | =MONTH(日期) | 月度分析 |
| 年月 | =TEXT(日期,"yyyy-mm") | 按月统计 |
| 星期几 | =TEXT(日期,"aaaa") | 星期分析 |
| 是否周末 | =IF(OR(WEEKDAY(日期)=1,WEEKDAY(日期)=7),"周末","工作日") | 周末对比 |
| 季度 | ="Q"&ROUNDUP(MONTH(日期)/3,0) | 季度分析 |
| 消费等级 | =IF(金额>1000,"大额",IF(金额>500,"中额","小额")) | 金额分类 |
| 占比 | =金额/SUM($金额列) | 占比分析 |
| 累计金额 | =SUM($金额列$2:当前行) | 累计分析 |

---

## 🎯 自我检查

完成本任务后，请检查：

- [ ] 数据已整合完成
- [ ] 数据已清洗完成
- [ ] 所有辅助列已创建
- [ ] 质量检查已通过
- [ ] 文件已保存和备份
- [ ] 完成了作业提交

---

**祝你学习顺利！** 🎉

