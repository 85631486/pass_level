# 任务13：数据验证和保护

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 了解数据验证的作用和类型
   - 掌握工作表保护的基本方法
   - 理解数据规范化的重要性

2. **技能目标**
   - 能够设置数据验证规则
   - 能够保护工作表和工作簿
   - 能够创建下拉列表和输入提示

3. **素养目标**
   - 培养数据质量管理意识
   - 建立规范操作习惯
   - 养成数据安全保护意识

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 为什么需要数据验证：10分钟
  - 数据验证基础：30分钟
  - 高级下拉列表：25分钟
  - 工作表保护：20分钟
  - 综合应用：5分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] 任务1的示例数据文件（任务1-示例网购数据.csv）
- [ ] 课程提供的演示文件（如有）

---

## 📋 操作步骤

### 步骤一：为什么需要数据验证（10分钟）

#### 1.1 问题场景

**场景1：错误输入**
```
问题：消费数据中金额列输入了"很贵"、"不记得了"等文本
影响：无法求和、计算平均值
原因：没有限制输入类型
```

**场景2：超出范围**
```
问题：月份列输入了13、0、-1等无效值
影响：日期计算错误
原因：没有设置有效范围
```

**场景3：格式不统一**
```
问题：店铺名有"Apple店"、"apple"、"苹果店"等多种写法
影响：分类统计不准确
原因：没有提供标准选项
```

**思考：** 你的数据中遇到过这些问题吗？

#### 1.2 数据验证的价值

**价值1：预防错误**
```
在输入时就阻止错误数据
比事后检查修改效率高100倍
```

**价值2：提高效率**
```
提供下拉选择，无需手动输入
减少拼写错误和格式不一致
```

**价值3：保证质量**
```
确保数据符合业务规则
为后续分析提供可靠基础
```

**价值4：用户友好**
```
提供输入提示和错误说明
降低使用门槛
```

**你的任务：**
1. 检查示例数据，找出可能的问题
2. 思考：如何用数据验证预防这些问题？

---

### 步骤二：数据验证基础（30分钟）

#### 2.1 创建第一个数据验证

**场景：限制金额只能输入数字**

**操作步骤：**

**步骤1：选中数据区域**
```
选中金额列（如C2:C100）
   - 将鼠标指针移动到C2单元格（第一个金额数据）
   - 按住鼠标左键不松开
   - 向下拖动鼠标，直到C100单元格（或最后一个有数据的单元格）
   - 松开鼠标左键
   - 此时C2到C100的所有单元格都被选中（显示为蓝色背景）
   - 或者：用鼠标左键单击C列列标（C列顶部的"C"字母），选中整个C列
```

**步骤2：打开数据验证对话框**
```
1. 点击"数据"选项卡
   - 在Excel顶部找到"数据"选项卡（通常在"插入"选项卡的右边）
   - 用鼠标左键单击"数据"选项卡

2. 点击"数据验证" → "数据验证"
   - 在"数据"选项卡的工具栏中，找到"数据工具"组
   - 在"数据工具"组中，找到"数据验证"按钮
   - 用鼠标左键单击"数据验证"按钮
   - 会弹出一个菜单，选择"数据验证"选项（菜单中的第一个选项）
   - 用鼠标左键单击"数据验证"选项
   - 会弹出一个对话框："数据验证"
```

**步骤3：设置验证规则**
```
在"设置"选项卡：
- 允许：整数（或小数）
  * 在对话框顶部，确保选中的是"设置"选项卡（如果不是，用鼠标左键单击"设置"选项卡）
  * 找到"允许"下拉菜单（通常在对话框的第一行）
  * 用鼠标左键单击"允许"下拉菜单
  * 会弹出一个列表，选择"整数"（如果金额必须是整数）或"小数"（如果金额可以是小数）
  * 用鼠标左键单击"整数"或"小数"选项

- 数据：大于
  * 找到"数据"下拉菜单（在"允许"下方）
  * 用鼠标左键单击"数据"下拉菜单
  * 会弹出一个列表，选择"大于"选项
  * 用鼠标左键单击"大于"选项

- 最小值：0
  * 找到"最小值"输入框（在"数据"下方）
  * 用鼠标左键单击"最小值"输入框
  * 用键盘输入数字：0
  * 或者：用鼠标左键单击输入框右侧的按钮，选择单元格引用
```

**步骤4：设置输入信息（可选）**
```
在"输入信息"选项卡：
- 勾选"选定单元格时显示输入信息"
  * 在对话框顶部，用鼠标左键单击"输入信息"选项卡
  * 找到"选定单元格时显示输入信息"复选框
  * 用鼠标左键单击复选框，打上勾（☑）

- 标题："输入金额"
  * 找到"标题"输入框
  * 用鼠标左键单击"标题"输入框
  * 用键盘输入文字：输入金额

- 内容："请输入大于0的数字"
  * 找到"输入信息"输入框（在"标题"下方）
  * 用鼠标左键单击"输入信息"输入框
  * 用键盘输入文字：请输入大于0的数字
  * 这个提示会在用户选中单元格时显示
```

**步骤5：设置出错警告（可选）**
```
在"出错警告"选项卡：
- 勾选"输入无效数据时显示出错警告"
  * 在对话框顶部，用鼠标左键单击"出错警告"选项卡
  * 找到"输入无效数据时显示出错警告"复选框
  * 用鼠标左键单击复选框，打上勾（☑）

- 样式：停止（禁止输入）/警告（提示但允许）/信息（仅提示）
  * 找到"样式"下拉菜单
  * 用鼠标左键单击"样式"下拉菜单
  * 会弹出一个列表，有三个选项：
    - "停止"：禁止输入无效数据，必须输入有效数据才能继续
    - "警告"：提示用户，但允许输入（用户可以选择继续或取消）
    - "信息"：仅提示用户，不阻止输入
  * 用鼠标左键单击"停止"选项（推荐，最严格）

- 标题："输入错误"
  * 找到"标题"输入框
  * 用鼠标左键单击"标题"输入框
  * 用键盘输入文字：输入错误

- 内容："金额必须是大于0的数字"
  * 找到"错误信息"输入框（在"标题"下方）
  * 用鼠标左键单击"错误信息"输入框
  * 用键盘输入文字：金额必须是大于0的数字
  * 这个提示会在用户输入无效数据时显示
```

**步骤6：确定**
```
点击"确定"
   - 在对话框右下角找到"确定"按钮
   - 用鼠标左键单击"确定"按钮
   - 对话框会关闭，数据验证规则已应用到选中的单元格
   - 测试：尝试在C2单元格输入无效数据（如文字"很贵"），会弹出错误提示
   - 尝试输入有效数据（如数字100），可以正常输入
```

**三种警告样式对比：**
```
停止：❌ 完全禁止输入错误数据（推荐）
警告：⚠️ 提示但可选择继续输入
信息：ℹ️ 仅提示，不阻止输入
```

**测试：**
```
- 输入数字100 → 成功 ✓
- 输入文本"abc" → 弹出错误提示 ✗
- 输入负数-100 → 弹出错误提示 ✗
```

**你的任务：**
1. 为金额列设置数据验证（大于0的数字）
2. 测试输入各种数据
3. 体验三种警告样式的区别

#### 2.2 数据验证类型

**类型1：整数/小数**

**应用：** 金额、数量、年龄等

**示例1：年龄18-60**
```
- 允许：整数
- 数据：介于
- 最小值：18
- 最大值：60
```

**示例2：价格0-10000**
```
- 允许：小数
- 数据：介于
- 最小值：0
- 最大值：10000
```

**类型2：日期**

**应用：** 限制日期范围

**示例：只能输入2024年的日期**
```
- 允许：日期
- 数据：介于
- 开始日期：2024-01-01
- 结束日期：2024-12-31
```

**示例：不能输入未来日期**
```
- 允许：日期
- 数据：小于或等于
- 结束日期：=TODAY()
```

**类型3：时间**

**应用：** 工作时间等

**示例：工作时间8:00-18:00**
```
- 允许：时间
- 数据：介于
- 开始时间：8:00
- 结束时间：18:00
```

**类型4：文本长度**

**应用：** 电话号码、身份证等

**示例：手机号11位**
```
- 允许：文本长度
- 数据：等于
- 长度：11
```

**类型5：序列（下拉列表）**

**应用：** 固定选项（重点）

**示例：店铺选择**
```
- 允许：序列
- 来源：Apple店,Samsung店,Xiaomi店
  （用逗号分隔）

效果：单元格出现下拉箭头，只能选择列表中的值
```

**类型6：自定义（公式）**

**应用：** 复杂业务规则

**示例：金额必须是100的倍数**
```
- 允许：自定义
- 公式：=MOD(C2,100)=0
```

**示例：不允许重复**
```
- 允许：自定义
- 公式：=COUNTIF($C$2:$C$100,C2)=1
```

**你的任务：**
1. 为日期列设置验证（只能输入2024年）
2. 为店铺列设置下拉列表
3. 为金额列设置范围（0-10000）
4. 尝试自定义公式验证

#### 2.3 实用技巧

**技巧1：复制验证规则**

**方法1：格式刷**
```
1. 选中已设置验证的单元格
2. 点击"格式刷"
3. 刷目标单元格
```

**方法2：选择性粘贴**
```
1. 复制已设置验证的单元格
2. 选中目标区域
3. 右键 → 选择性粘贴 → 验证
```

**技巧2：查找有验证的单元格**
```
开始 → 查找和选择 → 定位条件 → 数据验证
可以找到所有设置了验证的单元格
```

**技巧3：清除验证**
```
选中单元格 → 数据验证 → 全部清除
```

**你的任务：**
1. 尝试复制验证规则到其他列
2. 查找所有设置了验证的单元格
3. 尝试清除验证

---

### 步骤三：高级下拉列表（25分钟）

#### 3.1 引用区域创建下拉列表

**场景：店铺选项很多，不适合手动输入**

**操作步骤：**

**步骤1：在另一个位置列出所有选项**
```
例如：在Sheet2的A列列出所有店铺名
Apple官方旗舰店
Samsung旗舰店
Xiaomi官方店
...
```

**步骤2：定义名称（可选但推荐）**
```
1. 选中Sheet2!A1:A10
2. 公式 → 定义名称
3. 名称：店铺列表
4. 确定
```

**步骤3：设置数据验证**
```
1. 选中需要验证的列
2. 数据验证 → 序列
3. 来源：=Sheet2!$A$1:$A$10
   或 =店铺列表（如果定义了名称）
4. 确定
```

**优势：**
```
- 选项集中管理，修改方便
- 可以包含很多选项
- 可以隐藏选项列表工作表
```

**你的任务：**
1. 在新工作表创建店铺列表
2. 为数据列创建引用区域的下拉列表
3. 修改选项列表，观察下拉列表变化

#### 3.2 动态下拉列表

**场景：选项列表会增减，希望自动更新**

**方法1：使用表格（推荐）**

**步骤1：将选项区域转换为表格**
```
1. 选中选项区域
2. Ctrl+T 或 插入 → 表格
3. 命名表格：店铺表
```

**步骤2：设置数据验证**
```
来源：=INDIRECT("店铺表[店铺名]")
或
来源：=店铺表[店铺名]（Excel 2019+）
```

**效果：** 在表格中添加/删除选项，下拉列表自动更新

**方法2：使用OFFSET函数**
```
公式：
=OFFSET(Sheet2!$A$1,0,0,COUNTA(Sheet2!$A:$A),1)

解释：
- 从A1开始
- 行数=A列非空单元格数量
- 列数=1

效果：选项列表长度自动调整
```

**你的任务：**
1. 创建动态下拉列表
2. 在选项列表中添加新项
3. 验证下拉列表是否自动更新

#### 3.3 二级联动下拉列表（选学）

**场景：先选类别，再选具体商品**

**数据准备：**
```
Sheet2：
A列        B列        C列
电子产品   手机       Apple手机
电子产品   电脑       Dell电脑
服装       上衣       T恤
服装       裤子       牛仔裤
```

**步骤1：第一个下拉列表（类别）**
```
来源：电子产品,服装
```

**步骤2：第二个下拉列表（商品）**
```
使用INDIRECT函数：
=INDIRECT(A2)

配合定义名称：
- 定义名称"电子产品"：手机,电脑
- 定义名称"服装"：上衣,裤子
```

**效果：**
```
- A2选择"电子产品" → B2下拉显示：手机、电脑
- A2选择"服装" → B2下拉显示：上衣、裤子
```

**你的任务：**
1. 了解二级联动下拉列表的概念
2. 如果感兴趣，尝试创建
3. 向AI提问：如何创建三级联动下拉列表？

**向AI提问：**
```
"我想创建一个三级联动下拉列表：
第一级：类别（电子产品、服装）
第二级：子类别（手机、电脑、上衣、裤子）
第三级：具体商品（Apple手机、Dell电脑等）

应该如何设置？"
```

---

### 步骤四：工作表保护（20分钟）

#### 4.1 保护工作表

**场景：公式不想被修改，但允许输入数据**

**操作步骤：**

**步骤1：解锁可编辑区域**
```
1. 选中数据输入区域（如A2:C100）
2. 右键 → 设置单元格格式 → 保护
3. 取消勾选"锁定"
4. 确定
```

**步骤2：保护工作表**
```
1. 审阅 → 保护工作表
2. 设置密码（可选，建议设置）
3. 勾选允许的操作：
   ☑ 选定锁定单元格
   ☑ 选定未锁定单元格
   ☑ 设置单元格格式
   ☐ 插入行/列
   ☐ 删除行/列
4. 确定
```

**效果：**
```
- 公式单元格无法修改（被锁定）
- 数据单元格可以编辑（已解锁）
- 无法删除行列（未授权）
```

**保护后可以做什么：**
```
✅ 在解锁单元格输入数据
✅ 复制粘贴（如果允许）
✅ 使用筛选和排序
❌ 修改公式
❌ 删除行列（如果未授权）
❌ 修改工作表结构
```

**取消保护：**
```
审阅 → 撤销工作表保护
（如有密码需输入密码）
```

**你的任务：**
1. 解锁数据输入区域
2. 保护工作表
3. 测试哪些操作可以/不可以执行
4. 取消保护，调整设置

#### 4.2 保护工作簿

**保护工作簿结构：**
```
审阅 → 保护工作簿 → 结构

效果：
❌ 不能插入/删除/重命名工作表
❌ 不能移动/复制工作表
❌ 不能隐藏/显示工作表
✅ 可以编辑单元格内容（如工作表未保护）
```

**保护文件：**
```
文件 → 信息 → 保护工作簿 → 用密码进行加密

效果：
- 打开文件需要密码
- 适用于敏感数据

⚠️ 密码忘记无法找回！
```

**你的任务：**
1. 尝试保护工作簿结构
2. 了解文件密码保护（不建议实际设置，除非必要）

#### 4.3 保护最佳实践

**原则1：最小权限**
```
只开放必要的编辑权限
降低误操作风险
```

**原则2：分层保护**
```
- 数据输入区：解锁
- 公式计算区：锁定
- 辅助工作表：隐藏+保护
- 重要文件：密码保护
```

**原则3：用户友好**
```
- 清晰标注哪些区域可编辑（用颜色）
- 提供操作说明
- 密码告知使用者（内部使用）
```

**原则4：备份原则**
```
保护前保存未保护版本
密码记录在安全的地方
```

**你的任务：**
1. 理解保护原则
2. 设计自己的保护策略
3. 向AI提问：如何平衡保护和便利性？

---

### 步骤五：综合应用（5分钟）

**综合任务：创建规范的消费记录表**

**要求：**
1. 日期列：只能输入2024年日期
2. 商品列：文本长度1-50字符
3. 金额列：0-10000的数字
4. 店铺列：下拉列表选择
5. 类别列：下拉列表（电子、服装、食品、其他）
6. 备注列：可自由输入
7. 保护计算列（序号、占比等）
8. 保护工作表但允许数据输入

**操作流程：**

**步骤1：设置数据验证**
```
- 日期列：日期验证（2024-01-01 至 2024-12-31）
- 商品列：文本长度（1-50）
- 金额列：小数验证（0-10000）
- 店铺列：序列下拉列表
- 类别列：序列下拉列表
```

**步骤2：设置保护**
```
- 解锁数据输入区域（日期、商品、金额、店铺、类别、备注）
- 锁定计算列（序号、占比等）
- 保护工作表
```

**步骤3：测试**
```
- 测试数据验证是否生效
- 测试保护是否生效
- 验证可以输入数据，不能修改公式
```

**你的任务：**
1. 完成以上所有要求
2. 测试验证规则
3. 测试保护效果
4. 记录操作过程

---

## 📝 作业要求

### 提交内容

**实践任务：**

**任务1：规范化示例数据（必做）**
为你的消费数据表添加：
1. 所有列的数据验证
2. 至少2个下拉列表
3. 输入提示和错误警告
4. 工作表保护

**任务2：设计数据录入表（必做）**
设计一个家庭支出记录表：
- 日期、类别、子类别、金额、备注
- 使用二级联动下拉列表（可选）
- 设置所有验证规则
- 保护公式和结构

**提交内容：**

**Excel文件：**
- 规范化的个人数据表
- 家庭支出记录表模板

**Word文档（500字）：**
```
一、数据验证设置
   - 每列的验证规则：[列出每列的验证规则]
   - 设置理由：[说明为什么这样设置]
   - 测试结果：[测试了哪些情况，结果如何]

二、保护策略
   - 哪些区域锁定/解锁：[说明锁定和解锁的区域]
   - 保护级别选择：[工作表保护/工作簿保护]
   - 安全性考虑：[如何平衡安全和便利]

三、心得体会
   - 数据验证的价值：[说明数据验证在数据管理中的作用]
   - 保护的必要性：[说明为什么需要保护]
   - AI的帮助：[AI提供了哪些帮助]
   - 学习收获：[学到了什么，有什么启发]
```

**文件命名：**
- `学号_姓名_任务13_验证保护.xlsx`
- `学号_姓名_任务13_验证保护.docx`

**提交截止：**下次上课前

### 加分项（可选）
- 创建复杂的联动下拉列表
- 使用自定义公式验证
- 设计用户友好的录入界面
- 帮助同学解决验证保护问题

---

## ❓ 常见问题

### Q1: 数据验证不生效？
**A:** 
- 检查是否选中了正确的单元格
- 检查验证规则设置是否正确
- 检查是否有其他验证规则冲突

### Q2: 下拉列表显示不全？
**A:** 
- 检查来源区域是否正确
- 检查是否有空单元格
- 检查引用路径是否正确

### Q3: 保护后无法输入数据？
**A:** 
- 检查是否解锁了数据输入区域
- 检查保护设置中是否允许编辑
- 取消保护，重新设置

### Q4: 忘记保护密码？
**A:** 
- 密码无法找回
- 只能重新设置保护
- 建议记录密码在安全的地方

### Q5: 如何批量设置验证规则？
**A:** 
- 先设置一个单元格
- 使用格式刷或选择性粘贴复制规则
- 或选中区域后统一设置

### Q6: 自定义公式验证怎么写？
**A:** 
- 公式必须返回TRUE或FALSE
- TRUE表示验证通过，FALSE表示验证失败
- 向AI求助设计公式

---

## 💡 学习提示

1. **先设计再设置**：先想好需要什么验证规则，再设置
2. **测试充分**：设置后测试各种情况
3. **用户友好**：提供清晰的输入提示和错误说明
4. **备份重要**：保护前保存未保护版本
5. **记录密码**：密码记录在安全的地方

---

## 📚 数据验证类型速查表

| 类型 | 适用场景 | 设置示例 | 常见问题 |
|------|----------|----------|----------|
| 整数 | 年龄、数量 | 18-60 | 注意包含/不包含边界 |
| 小数 | 金额、比例 | 0-1或>0 | 设置小数位数 |
| 日期 | 订单日期 | 2024年 | 使用TODAY()函数 |
| 时间 | 工作时间 | 8:00-18:00 | 格式为hh:mm |
| 文本长度 | 电话、ID | =11 | 无法验证内容 |
| 序列 | 固定选项 | 来源列表 | 逗号分隔或引用 |
| 自定义 | 复杂规则 | 公式=TRUE | 公式需返回布尔值 |

---

## 📚 常用验证公式

**不允许重复：**
```
=COUNTIF($A$2:$A$100,A2)=1
```

**必须是100的倍数：**
```
=MOD(A2,100)=0
```

**不能早于今天：**
```
=A2>=TODAY()
```

**金额必须大于上一行：**
```
=A2>A1
```

**文本必须包含特定字符：**
```
=ISNUMBER(FIND("关键词",A2))
```

**必须是email格式：**
```
=AND(ISNUMBER(FIND("@",A2)),ISNUMBER(FIND(".",A2)))
```

---

## 📚 保护功能对比

| 功能 | 保护对象 | 限制内容 | 适用场景 |
|------|----------|----------|----------|
| 锁定单元格 | 单个单元格 | 修改内容 | 保护公式 |
| 保护工作表 | 整个工作表 | 结构+内容 | 防止误操作 |
| 保护工作簿 | 工作簿结构 | 增删工作表 | 固定结构 |
| 密码加密 | 整个文件 | 打开文件 | 敏感数据 |
| 只读推荐 | 整个文件 | 提示只读 | 提醒用户 |

---

## 📚 设置保护的步骤清单

**□ 保护工作表前**
- [ ] 确定哪些区域需要编辑
- [ ] 解锁这些区域（格式→保护→取消锁定）
- [ ] 锁定公式和重要区域（默认锁定）
- [ ] 用颜色标注可编辑区域

**□ 设置保护**
- [ ] 审阅→保护工作表
- [ ] 设置密码（可选）
- [ ] 选择允许的操作
- [ ] 记录密码（重要！）

**□ 测试保护**
- [ ] 尝试修改锁定区域
- [ ] 尝试编辑解锁区域
- [ ] 测试所有授权操作
- [ ] 确认符合预期

**□ 文档说明**
- [ ] 标注可编辑区域
- [ ] 提供操作指南
- [ ] 说明密码（如适用）
- [ ] 备份未保护版本

---

## 🎯 自我检查

完成本任务后，请检查：

- [ ] 能够设置各种类型的数据验证
- [ ] 能够创建下拉列表（手动和引用）
- [ ] 能够创建动态下拉列表
- [ ] 能够设置输入提示和错误警告
- [ ] 能够锁定/解锁单元格
- [ ] 能够保护工作表
- [ ] 能够保护工作簿结构
- [ ] 完成了作业提交

---

**祝你学习顺利！** 🎉

