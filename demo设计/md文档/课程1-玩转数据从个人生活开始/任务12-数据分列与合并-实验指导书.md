# 任务12：数据分列与合并

## 📌 学习目标

通过本任务的学习，你将能够：

1. **知识目标**
   - 了解数据分列和合并的应用场景
   - 掌握"分列"工具的使用方法
   - 理解文本函数在数据处理中的作用

2. **技能目标**
   - 能够将一列数据拆分为多列
   - 能够将多列数据合并为一列
   - 能够使用文本函数提取部分内容

3. **素养目标**
   - 培养数据结构化意识
   - 建立灵活处理数据的思维
   - 养成数据标准化习惯

---

## ⏰ 任务时间

- **总时长**：2学时（90分钟）
- **建议分配**：
  - 认识分列与合并：10分钟
  - 数据分列：30分钟
  - 数据合并：25分钟
  - 文本函数提取：20分钟
  - 综合实战：5分钟

---

## 🛠️ 准备工作

### 必备工具
- [ ] Excel 2016及以上版本 或 WPS Office
- [ ] 任务1的示例数据文件（任务1-示例网购数据.csv）
- [ ] 课程提供的练习数据（如有）

---

## 📋 操作步骤

### 步骤一：认识分列与合并（10分钟）

#### 1.1 实际场景

**场景1：分列（拆分）**

**原始数据：**
```
A列：姓名-电话-地址
张三-13800138000-北京市
李四-13900139000-上海市
```

**需求：拆分为三列**
```
B列：姓名
C列：电话
D列：地址
```

**场景2：合并**

**原始数据：**
```
A列：姓
B列：名
C列：年级
```

**需求：合并为"张三-2024级"格式**

**思考：** 你的数据中有类似的情况吗？

#### 1.2 常见应用

**分列应用：**
- 导入外部数据时，多个字段挤在一列
- 从完整地址中提取省市区
- 从商品编码中提取类别信息
- 拆分"姓名-电话"这样的组合数据

**合并应用：**
- 生成唯一标识（ID+日期）
- 拼接完整地址
- 生成报表标题
- 合并多个字段用于查找

**你的任务：**
1. 检查示例数据，找出需要分列或合并的地方
2. 列出2-3个应用场景

---

### 步骤二：数据分列（30分钟）

#### 2.1 使用分列工具

**场景：拆分"商品-店铺"数据**

**原始数据（A列）：**
```
Apple手机-Apple官方旗舰店
Samsung电脑-Samsung旗舰店
Xiaomi耳机-Xiaomi官方店
```

**目标：拆分为B列（商品）和C列（店铺）**

**操作步骤：**

**步骤1：选中数据**
```
1. 选中A列数据（或包含数据的区域）
   - 将鼠标指针移动到A列列标上（A列顶部的"A"字母）
   - 用鼠标左键单击A列列标
   - 整个A列会被选中（显示为蓝色背景）
   - 或者：将鼠标指针移动到A1单元格
   - 按住鼠标左键不松开，向下拖动到最后一个有数据的单元格（例如A100）
   - 松开鼠标左键
   - 此时A列的数据区域被选中

2. 确保右侧列是空的（分列会覆盖右侧数据）
   - 检查B列、C列等右侧列是否有数据
   - 如果有重要数据，先复制到其他位置备份
   - 分列操作会将数据拆分到右侧列，会覆盖原有数据
   - 如果右侧列是空的，可以安全进行分列操作
```

**步骤2：打开分列向导**
```
1. 点击"数据"选项卡
   - 在Excel顶部找到"数据"选项卡（通常在"插入"选项卡的右边）
   - 用鼠标左键单击"数据"选项卡

2. 点击"分列"按钮
   - 在"数据"选项卡的工具栏中找到"分列"按钮
   - 这个按钮通常在工具栏的左侧，可能在"数据工具"组中
   - 按钮上可能显示文字"分列"或图标（通常是一个箭头指向两列的图标）
   - 用鼠标左键单击"分列"按钮
   - 会弹出一个对话框："文本分列向导 - 第1步，共3步"
```

**步骤3：选择数据类型**
```
选择"分隔符号"（如果数据由特定字符分隔）
   - 在对话框中，有两个选项：
     * "分隔符号"：数据由特定字符（如逗号、空格、横线等）分隔
     * "固定宽度"：每个字段固定占用若干字符（如身份证号、电话号码等）
   - 用鼠标左键单击"分隔符号"前面的圆圈（选中该选项）
   - 圆圈会变成实心圆点，表示已选中

或选择"固定宽度"（如果每个字段固定占用若干字符）
   - 如果数据是固定宽度格式，选择"固定宽度"
   - 用鼠标左键单击"固定宽度"前面的圆圈

一般选择"分隔符号" → 下一步
   - 选择"分隔符号"后，点击对话框右下角的"下一步"按钮
   - 用鼠标左键单击"下一步"按钮
   - 对话框会进入第2步
```

**步骤4：选择分隔符**
```
常见分隔符：
☑ Tab键（制表符）
   - 如果数据是用Tab键分隔的（通常从其他程序复制粘贴时会出现）
   - 用鼠标左键单击"Tab键"前面的方框，打上勾（☑）

☑ 分号
   - 如果数据是用分号（;）分隔的
   - 用鼠标左键单击"分号"前面的方框，打上勾（☑）

☑ 逗号
   - 如果数据是用逗号（,）分隔的（CSV文件常用）
   - 用鼠标左键单击"逗号"前面的方框，打上勾（☑）

☑ 空格
   - 如果数据是用空格分隔的
   - 用鼠标左键单击"空格"前面的方框，打上勾（☑）

☑ 其他：自定义（如 - / | ）
   - 如果数据是用其他字符分隔的（如横线-、斜杠/、竖线|等）
   - 用鼠标左键单击"其他"前面的方框，打上勾（☑）
   - 在"其他"后面的输入框中，输入分隔符（例如输入"-"）

本例：勾选"其他"，输入"-"
   - 用鼠标左键单击"其他"前面的方框，打上勾（☑）
   - 在"其他"后面的输入框中，用键盘输入：-
   - 在对话框下方的"数据预览"区域，可以看到数据被分列的预览效果
   - 如果预览效果正确，继续下一步

可多选：例如同时按空格和逗号分列
   - 可以同时勾选多个分隔符
   - 例如：同时勾选"空格"和"逗号"
   - Excel会按照这些分隔符进行分列
   - 在"数据预览"区域可以看到效果

选择完成后，点击"下一步"按钮
```

**步骤5：设置列数据格式**
```
常规：自动识别
   - Excel会自动识别每列的数据类型（数字、文本、日期等）
   - 用鼠标左键单击"常规"前面的圆圈（选中该选项）

文本：保留原样（推荐，避免格式丢失）
   - 将所有列都设置为文本格式，保留原始内容
   - 在"数据预览"区域，用鼠标左键单击某一列的列标题（例如"列1"）
   - 该列会被选中（显示为黑色背景）
   - 在"列数据格式"区域，用鼠标左键单击"文本"前面的圆圈
   - 重复此操作，为所有列设置"文本"格式
   - 这样可以避免数字被转换、日期格式丢失等问题

日期：指定日期格式
   - 如果某列是日期数据，可以选择"日期"
   - 在右侧的下拉菜单中选择日期格式（如"YMD"表示年月日）
   - 用鼠标左键单击下拉菜单，选择格式

不导入此列：跳过某列
   - 如果不想导入某列数据，可以选择"不导入此列（跳过）"
   - 在"数据预览"区域，选中该列
   - 选择"不导入此列（跳过）"

建议：选择"文本"，保留原样
   - 为了避免数据格式丢失，建议所有列都选择"文本"格式
   - 设置完成后，点击"下一步"按钮
```

**步骤6：完成**
```
点击"完成"
   - 在对话框右下角找到"完成"按钮
   - 用鼠标左键单击"完成"按钮
   - Excel会执行分列操作
   - 对话框会关闭

查看分列结果
   - 回到Excel工作表
   - 可以看到A列的数据已经被拆分
   - 原来的数据（如"Apple手机-Apple官方旗舰店"）被拆分到多列
   - B列显示：Apple手机
   - C列显示：Apple官方旗舰店
   - 检查结果是否正确
   - 如果结果不对，可以按Ctrl+Z撤销，重新操作
```

**结果：**
```
B列：Apple手机、Samsung电脑、Xiaomi耳机
C列：Apple官方旗舰店、Samsung旗舰店、Xiaomi官方店
```

**⚠️ 重要注意事项：**
- 分列会覆盖右侧数据，先确保右侧列为空
- 操作前先备份数据
- 如果分隔符不统一，需要先清洗数据

**你的任务：**
1. 准备测试数据："商品-店铺"格式
2. 按照步骤完成分列
3. 检查结果是否正确

#### 2.2 不同分隔符实战

**案例1：空格分隔**

**原始数据：**
```
张三 男 25 北京
```

**操作：**
```
1. 选中数据
2. 分列 → 分隔符号
3. 勾选"空格"
4. 完成
```

**结果：** 姓名、性别、年龄、城市 四列

**案例2：逗号分隔（CSV）**

**原始数据：**
```
2024-01-15,Apple手机,1500,Apple店
```

**操作：**
```
1. 选中数据
2. 分列 → 分隔符号
3. 勾选"逗号"
4. 完成
```

**结果：** 日期、商品、金额、店铺 四列

**案例3：多种分隔符**

**原始数据：**
```
张三,男;25;北京
```

**操作：**
```
1. 选中数据
2. 分列 → 分隔符号
3. 同时勾选"逗号"和"分号"
4. 完成
```

**案例4：固定宽度**

**原始数据：**
```
001张三    北京
002李四    上海
（编号3位，姓名6位，城市4位）
```

**操作：**
```
1. 选中数据
2. 分列 → 固定宽度
3. 手动设置分隔线位置（点击数据预览区域）
4. 完成
```

**你的任务：**
1. 分列 "商品-价格-店铺" 格式数据
2. 分列空格分隔的数据
3. 尝试固定宽度分列
4. 向AI提问处理不规则分隔符

**向AI提问：**
```
"我的数据格式是'商品-价格-店铺'，
但有些商品名中也有'-'，导致分列错误。
应该如何处理？"
```

#### 2.3 处理分列问题

**问题1：分隔符在数据内部**

**原始数据：**
```
小米-Note 10-小米旗舰店
```

**问题：** 商品名中也有"-"

**解决方案：**
```
方法1：更换分隔符（改用|或其他）
方法2：用公式提取（FIND+LEFT等）
方法3：向AI求助定制方案
```

**问题2：数据不规则**

**原始数据：**
```
张三-北京
李四-上海-浦东区（有的有3段，有的2段）
```

**解决：**
```
分列时会自动处理，短的留空
```

**问题3：数字前导零丢失**

**原始数据：**
```
001, 002, 003
```

**分列后变成：**
```
1, 2, 3（前导零丢失）
```

**解决：**
```
步骤3选择"文本"格式，保留前导零
```

**你的任务：**
1. 尝试处理包含分隔符的数据
2. 处理不规则数据
3. 保留数字的前导零

---

### 步骤三：数据合并（25分钟）

#### 3.1 使用&符号合并

**场景：合并姓名和年级**

**数据：**
```
A列：姓名（张三）
B列：年级（2024级）
```

**目标：C列显示"张三-2024级"**

**公式：**
```
C2: =A2&"-"&B2
```

**结果：** 张三-2024级

**合并多列：**
```
合并姓、名、年级：
=A2&B2&"-"&C2&"级"

示例：
A2=张, B2=三, C2=2024
结果：张三-2024级
```

**添加固定文本：**
```
="学生："&A2&"，来自"&B2
结果：学生：张三，来自北京
```

**你的任务：**
1. 合并商品和店铺（用"-"连接）
2. 合并日期和描述
3. 生成"XX月在XX店购买XX"描述

#### 3.2 CONCATENATE函数

**语法：**
```
=CONCATENATE(文本1, 文本2, ...)
```

**示例：**
```
=CONCATENATE(A2, "-", B2, "-", C2)
等同于：=A2&"-"&B2&"-"&C2

优势：参数清晰，可读性强
劣势：比&符号麻烦
```

**新版本函数：CONCAT和TEXTJOIN**

**CONCAT（Excel 2016+）：**
```
=CONCAT(A2:C2)
直接合并区域，不需要一个个写
```

**TEXTJOIN（Excel 2019+，推荐）：**
```
=TEXTJOIN("-", TRUE, A2:C2)
参数1：分隔符"-"
参数2：是否忽略空值（TRUE=忽略）
参数3：要合并的区域

优势：自动添加分隔符，忽略空值
```

**对比示例：**

**数据：** A2=张三, B2=(空), C2=北京

**& 符号：**
```
=A2&"-"&B2&"-"&C2
结果：张三--北京（有两个-）
```

**TEXTJOIN：**
```
=TEXTJOIN("-",TRUE,A2:C2)
结果：张三-北京（自动忽略空值）
```

**你的任务：**
1. 用CONCATENATE合并数据
2. 如果有新版本，用TEXTJOIN合并
3. 对比三种方法的优劣

#### 3.3 合并后转换为值

**问题：公式结果依赖原数据**

**场景：**
```
C列用公式合并A、B列
如果删除A、B列，C列会显示#REF!
```

**解决：转换为值**

**操作步骤：**
```
1. 选中C列公式区域
2. Ctrl+C复制
3. 右键 → 选择性粘贴 → 值
4. 现在C列是纯文本，可以删除A、B列
```

**何时需要转换为值：**
- 合并完成后不再需要原数据
- 要删除原列
- 要分享文件给他人

**你的任务：**
1. 合并数据后，转换为值
2. 删除原列，验证结果

#### 3.4 合并后的应用

**应用1：生成唯一ID**
```
=A2&"-"&TEXT(B2,"yyyymmdd")
结果：张三-20240115
用于标识唯一记录
```

**应用2：生成完整描述**
```
=TEXT(A2,"m月d日")&"在"&B2&"购买"&C2&"，花费"&D2&"元"
结果：1月15日在Apple店购买手机，花费1500元
```

**应用3：合并用于VLOOKUP**
```
原表：姓 名 成绩
查找：需要用姓+名查找

辅助列：=A2&B2
VLOOKUP：=VLOOKUP(E2&F2, 辅助列:成绩列, 2, 0)
```

**你的任务：**
1. 生成唯一ID
2. 生成完整描述
3. 尝试用合并字段进行查找

---

### 步骤四：文本函数提取（20分钟）

#### 4.1 LEFT、RIGHT、MID函数

**LEFT函数（从左提取）：**

**语法：**
```
=LEFT(文本, 提取字符数)
```

**示例1：提取姓氏**
```
A2: 张三丰
=LEFT(A2, 1)
结果：张
```

**示例2：提取年份**
```
A2: 2024-01-15
=LEFT(A2, 4)
结果：2024
```

**RIGHT函数（从右提取）：**

**语法：**
```
=RIGHT(文本, 提取字符数)
```

**示例1：提取文件扩展名**
```
A2: 报告.xlsx
=RIGHT(A2, 4)
结果：xlsx
```

**示例2：提取日**
```
A2: 2024-01-15
=RIGHT(A2, 2)
结果：15
```

**MID函数（从中间提取）：**

**语法：**
```
=MID(文本, 起始位置, 提取字符数)
```

**示例1：提取月份**
```
A2: 2024-01-15
=MID(A2, 6, 2)
结果：01（从第6个字符开始，提取2个）
```

**示例2：提取中间名**
```
A2: 张三丰
=MID(A2, 2, 1)
结果：三
```

**你的任务：**
1. 从日期中提取年、月、日
2. 从文件名中提取扩展名
3. 从文本中提取中间部分

#### 4.2 FIND和LEN函数辅助

**FIND函数（查找位置）：**

**语法：**
```
=FIND(要找的文本, 在哪找, 起始位置)
```

**示例：找"-"的位置**
```
A2: Apple手机-Apple店
=FIND("-", A2)
结果：5（"-"在第5个字符位置）
```

**LEN函数（计算长度）：**

**语法：**
```
=LEN(文本)
```

**示例：**
```
A2: Apple手机
=LEN(A2)
结果：7（共7个字符）
```

**组合使用：提取分隔符前的内容**

**场景：提取"-"前的商品名**

**数据：**
```
A2: Apple手机-Apple店
```

**分析：**
```
- 找到"-"的位置：=FIND("-",A2)  返回5
- 提取前4个字符：=LEFT(A2, FIND("-",A2)-1)
```

**公式：**
```
=LEFT(A2, FIND("-", A2)-1)
结果：Apple手机
```

**提取分隔符后的内容：**

**数据：**
```
A2: Apple手机-Apple店
```

**分析：**
```
- "-"位置：5
- 总长度：=LEN(A2)  返回14
- 提取从第6位到末尾
```

**公式：**
```
=RIGHT(A2, LEN(A2)-FIND("-",A2))
或
=MID(A2, FIND("-",A2)+1, 999)

结果：Apple店
```

**你的任务：**
1. 用函数提取"姓名-电话"中的电话
2. 提取邮箱中@前的用户名
3. 向AI提问复杂提取需求

**向AI提问：**
```
"我的数据格式是'商品-店铺-价格'，
想提取店铺名（中间部分），
应该用什么函数？请给出公式。"
```

---

### 步骤五：综合实战（5分钟）

**综合任务：清洗和重组数据**

**原始数据：**
```
A列：商品-店铺-价格
Apple手机-Apple官方旗舰店-1500
Samsung电脑-Samsung旗舰店-3000
```

**要求：**
1. 分列为三列（商品、店铺、价格）
2. 从店铺名提取品牌（第一个词）
3. 合并生成描述："在XX购买XX，价格XX元"
4. 生成唯一ID：品牌-日期

**操作流程：**

**步骤1：分列**
```
选中A列 → 分列 → 分隔符"-"
结果：B列商品、C列店铺、D列价格
```

**步骤2：提取品牌**
```
E2输入：=LEFT(C2, FIND("官", C2)-1)
或
E2输入：=LEFT(C2, FIND("-", C2)-1)（如果店铺名有-）
双击填充柄
```

**步骤3：生成描述**
```
F2输入：="在"&C2&"购买"&B2&"，价格"&D2&"元"
双击填充柄
```

**步骤4：生成ID**
```
G2输入：=E2&"-"&TEXT(TODAY(),"yyyymmdd")
双击填充柄
```

**你的任务：**
1. 完成以上所有步骤
2. 检查每个公式的结果
3. 记录操作过程

---

## 📝 作业要求

### 提交内容

**实践任务：**

**任务1：处理示例数据（必做）**
1. 如果你的数据有组合字段，进行分列
2. 创建一个描述列，合并多个字段
3. 用文本函数提取有用信息（如月份）

**任务2：综合练习（必做）**
处理以下格式数据：
- 原始："2024-01-15|Apple手机|1500|Apple官方旗舰店"
- 任务：
  - 分列为4列
  - 提取月份
  - 提取品牌（店铺中的第一个词）
  - 合并生成："1月购买Apple品牌手机，花费1500元"

**提交内容：**

**Excel文件：**
- 原始数据表
- 分列结果表
- 合并结果表
- 文本提取工作表

**Word文档（500字）：**
```
一、分列操作
   - 原始数据格式：[描述格式]
   - 分隔符选择：[选择的分隔符及原因]
   - 遇到的问题：[遇到的问题及解决方法]

二、合并操作
   - 合并目标：[要合并成什么]
   - 使用的方法：[&符号/CONCATENATE/TEXTJOIN]
   - 公式说明：[公式及含义]
   - 结果示例：[展示结果]

三、文本提取
   - 提取需求：[要提取什么]
   - 函数组合：[使用的函数及公式]
   - 结果验证：[验证结果是否正确]

四、心得体会
   - 分列合并的价值：[说明在数据处理中的作用]
   - 遇到的问题和解决：[描述遇到的问题及解决方法]
   - AI的帮助：[AI提供了哪些帮助]
   - 学习收获：[学到了什么，有什么启发]
```

**文件命名：**
- `学号_姓名_任务12_分列合并.xlsx`
- `学号_姓名_任务12_分列合并.docx`

**提交截止：**下次上课前

### 加分项（可选）
- 处理复杂不规则数据
- 总结10个文本函数技巧
- 创建分列合并工具模板
- 帮助同学解决分列合并问题

---

## ❓ 常见问题

### Q1: 分列后数据格式变了？
**A:** 
- 在分列向导第3步选择"文本"格式
- 或分列后重新设置格式

### Q2: 分隔符在数据内部，分列错误？
**A:** 
- 更换分隔符（改用|或其他）
- 或用公式提取（FIND+LEFT等）
- 向AI求助定制方案

### Q3: 合并后有两个分隔符？
**A:** 
- 使用TEXTJOIN函数，设置忽略空值
- 或检查是否有空单元格

### Q4: 如何提取最后一个分隔符后的内容？
**A:** 
- 使用复杂公式（SUBSTITUTE+FIND）
- 或向AI求助
- 或分列后取最后一列

### Q5: LEFT/RIGHT/MID提取的字符数不对？
**A:** 
- 检查起始位置是否正确
- 使用FIND函数动态查找位置
- 使用LEN函数计算总长度

### Q6: 分列会覆盖右侧数据？
**A:** 
- 是的，分列前确保右侧列为空
- 或先备份数据
- 或插入空列后再分列

---

## 💡 学习提示

1. **先备份**：分列会覆盖数据，操作前先备份
2. **选择分隔符**：仔细检查数据中的分隔符
3. **设置格式**：分列时选择"文本"格式，避免格式丢失
4. **验证结果**：分列合并后检查结果是否正确
5. **善用函数**：复杂提取需求使用函数组合

---

## 📚 文本函数速查表

| 函数 | 功能 | 语法 | 示例 |
|------|------|------|------|
| LEFT | 从左提取 | =LEFT(文本,字符数) | =LEFT("Apple",2) → "Ap" |
| RIGHT | 从右提取 | =RIGHT(文本,字符数) | =RIGHT("Apple",2) → "le" |
| MID | 从中间提取 | =MID(文本,起始,字符数) | =MID("Apple",2,2) → "pp" |
| LEN | 计算长度 | =LEN(文本) | =LEN("Apple") → 5 |
| FIND | 查找位置 | =FIND(查找文本,在哪找) | =FIND("p","Apple") → 2 |
| CONCATENATE | 合并文本 | =CONCATENATE(文本1,文本2,...) | =CONCATENATE("A","B") → "AB" |
| TEXTJOIN | 智能合并 | =TEXTJOIN(分隔符,忽略空,区域) | =TEXTJOIN("-",TRUE,A1:C1) |
| TRIM | 删除空格 | =TRIM(文本) | =TRIM(" A ") → "A" |
| SUBSTITUTE | 替换文本 | =SUBSTITUTE(文本,旧,新) | =SUBSTITUTE("Apple","p","b") → "Abble" |

---

## 📚 常见分隔符

| 分隔符 | 名称 | 常见场景 | 输入方法 |
|--------|------|----------|----------|
| , | 逗号 | CSV文件 | 直接输入 |
| Tab | 制表符 | 复制粘贴 | 勾选Tab |
| 空格 | 空格 | 文本数据 | 勾选空格 |
| - | 连字符 | 组合字段 | 其他→输入- |
| / | 斜杠 | 日期/路径 | 其他→输入/ |
| \| | 竖线 | 数据库导出 | 其他→输入\| |
| ; | 分号 | 欧洲CSV | 勾选分号 |

---

## 📚 文本提取公式模板

**提取分隔符前的内容：**
```
=LEFT(A1, FIND("分隔符", A1)-1)
```

**提取分隔符后的内容：**
```
=MID(A1, FIND("分隔符", A1)+1, 999)
或
=RIGHT(A1, LEN(A1)-FIND("分隔符", A1))
```

**提取两个分隔符之间的内容：**
```
=MID(A1, FIND("分隔符1", A1)+1, FIND("分隔符2", A1)-FIND("分隔符1", A1)-1)
```

---

## 🎯 自我检查

完成本任务后，请检查：

- [ ] 能够使用分列工具拆分数据
- [ ] 能够选择正确的分隔符
- [ ] 能够使用&符号合并数据
- [ ] 能够使用CONCATENATE或TEXTJOIN合并
- [ ] 能够使用LEFT/RIGHT/MID提取文本
- [ ] 能够使用FIND/LEN辅助提取
- [ ] 能够处理分列合并中的问题
- [ ] 完成了作业提交

---

**祝你学习顺利！** 🎉

