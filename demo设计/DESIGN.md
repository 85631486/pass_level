# 过关斩将 - 游戏教学平台 2.0 系统设计概览

## 🎯 设计理念

本系统采用**游戏化学习**的设计理念，将传统的教学文档转化为互动式学习体验。通过关卡、积分、徽章等机制，激发学生的学习兴趣，在实际操作中不断发现和掌握知识技巧。

## 🎨 界面设计

### 1. 色彩方案
- **主色调**：白色 + 灰色系（简洁、专业）
- **强调色**：渐变紫色 (#667eea → #764ba2)
- **功能色**：
  - 成功：绿色 (#67c23a)
  - 警告：橙色 (#ffa500)
  - 信息：蓝色 (#409eff)
  - 错误：红色 (#f56c6c)

### 2. 布局结构

```
┌─────────────────────────────────────────────────────────────┐
│  顶部导航栏                                                   │
│  [返回] 任务标题   [进度条]   [积分显示] [学习进度]           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      主内容区                                │
│                                                             │
│  ┌───────────────────────────────────┐                      │
│  │  关卡标题：第X关 - 操作名称        │                      │
│  └───────────────────────────────────┘                      │
│                                                             │
│  ┌───────────────────────────────────┐                      │
│  │  📄 操作说明                       │                      │
│  │  详细说明文字...                   │                      │
│  └───────────────────────────────────┘                      │
│                                                             │
│  ┌───────────────────────────────────┐                      │
│  │  📋 详细步骤                       │                      │
│  │  1. 步骤一                         │                      │
│  │  2. 步骤二                         │                      │
│  │  ...                               │                      │
│  └───────────────────────────────────┘                      │
│                                                             │
│  ┌───────────────────────────────────┐    ┌──────────────┐ │
│  │  🎯 立即动手                       │    │ 知识卡片浮层 │ │
│  │  练习任务描述...                   │    │              │ │
│  └───────────────────────────────────┘    │ 💡 小技巧    │ │
│                                           │              │ │
│  ┌───────────────────────────────────┐    │ 内容...      │ │
│  │  📤 提交操作结果                   │    │              │ │
│  │  [选择文件] [提交]                 │    │ [收集]       │ │
│  └───────────────────────────────────┘    └──────────────┘ │
│                                                             │
│  [上一步]                        [下一步] / [完成所有操作]   │
│                                                             │
└─────────────────────────────────────────────────────────────┘

                                              ┌───────────────┐
                                              │  浮动按钮组   │
                                              │  [📌 目标]    │
                                              │  [📝 记录]    │
                                              │  [💡 卡片]    │
                                              │  [❓测试]    │
                                              └───────────────┘
```

### 3. 抽屉设计

右侧抽屉宽度：500px
抽屉内容：
- 📌 学习目标
- 📝 我的提交记录
- 💡 知识卡片收集箱
- ❓ 统一测试答题区
- 📊 学习进度总览

## 🎮 游戏化元素

### 1. 关卡系统
- 每个操作 = 一个关卡
- 关卡徽章显示：第X关
- 进度条显示总体完成度

### 2. 积分系统
| 行为 | 积分 |
|------|------|
| 完成操作并提交 | +10分 |
| 即时测试题答对 | +5分 |
| 统一测试题答对 | +10分 |
| 收集知识卡片 | +0分（收藏功能）|

### 3. 徽章系统
| 徽章名称 | 解锁条件 |
|----------|----------|
| 任务完成 | 完成一个任务 |
| 操作大师 | 完成所有操作 |
| 满分学霸 | 获得满分 |
| 速度之星 | 在规定时间内完成 |
| 知识收藏家 | 收集所有知识卡片 |

### 4. 知识卡片
- **类型**：tip（技巧）、warning（注意）、info（信息）、success（成功）
- **触发时机**：before（操作前）、during（操作中）、after（操作后）
- **显示位置**：右侧浮动显示
- **收集功能**：点击收集按钮，卡片进入收集箱

## 📱 交互流程

### 学生学习流程

```
登录 → 选择任务 → 开始学习 → 循环以下步骤：
    ├─ 阅读操作说明
    ├─ 查看详细步骤
    ├─ 实际操作练习
    ├─ 查看知识卡片（自动弹出）
    ├─ 收集知识卡片
    ├─ 上传操作结果
    ├─ 回答即时测试题
    └─ 进入下一操作
→ 完成所有操作 → 统一测试答题 → 提交完成 → 查看学习总结
```

### 即时测试题流程

```
完成操作 → 自动弹出测试题弹窗 → 选择答案 → 提交
→ 显示结果（正确/错误）→ 显示正确答案和解析 → 显示获得积分
```

### 知识卡片流程

```
进入操作 → 卡片自动在右侧浮动显示 → 学生阅读
→ 点击收集按钮 → 卡片进入收集箱 → 随时在抽屉中查看
```

## 🗄️ 数据流设计

### 前端状态管理（Pinia）

**userStore（用户状态）**
```javascript
{
  user: {
    id: 1,
    student_id: '20240001',
    name: '张三'
  },
  isLoggedIn: true
}
```

**learningStore（学习状态）**
```javascript
{
  currentProgress: {
    task_id: 1,
    current_operation: 0,      // 当前操作索引
    operations_completed: 5,   // 已完成操作数
    total_points: 75,          // 总积分
    questions_correct: 10,     // 答对题数
    status: 'in_progress'
  },
  collectedCards: [],          // 收集的知识卡片
  badges: [],                  // 获得的徽章
  submissions: {}              // 提交记录
}
```

### 后端API数据流

**学习进度更新流程**
```
前端操作 → API请求 → 后端处理 → 更新数据库 → 返回新状态 → 前端更新Store
```

**示例：提交操作**
```
1. 用户选择文件并点击提交
2. 前端发送 POST /api/operations/:id/submit（FormData）
3. 后端保存文件到 uploads/student_{id}/
4. 创建 operation_submissions 记录
5. 更新 student_progress 表（operations_completed++, total_points+=10）
6. 返回积分信息
7. 前端更新 learningStore
8. 显示成功提示
```

## 🔐 安全设计

### 1. 密码安全
- 使用 Werkzeug 的 `generate_password_hash` 加密存储
- 登录时使用 `check_password_hash` 验证

### 2. 文件上传安全
- 限制文件大小：16MB
- 限制文件类型：png, jpg, jpeg, gif, pdf, docx, xlsx
- 使用 `secure_filename` 处理文件名
- 文件存储在学生专属目录

### 3. SQL注入防护
- 使用 SQLAlchemy ORM，自动防止SQL注入

### 4. CORS配置
- 开发环境：允许所有来源
- 生产环境：限制为指定域名

## 📊 数据统计设计

### 学习总结包含数据
1. **基础数据**
   - 总积分
   - 完成操作数
   - 学习时长

2. **答题情况**
   - 即时测试题正确率
   - 统一测试题正确率

3. **收集情况**
   - 知识卡片收集数
   - 获得徽章数

4. **完成度评价**
   - 完成百分比
   - 等级评价（优秀/良好/需要努力）

## 🚀 性能优化

### 前端优化
1. **路由懒加载**：所有页面组件使用动态导入
2. **图标按需加载**：Element Plus图标按需注册
3. **数据缓存**：localStorage缓存用户信息

### 后端优化
1. **数据库索引**：为常用查询字段添加索引
2. **分页查询**：大数据量列表使用分页
3. **文件存储优化**：按学生ID分目录存储

## 🔄 扩展性设计

### 1. 多课程支持
- 数据库已设计课程表（courses）
- 任务与课程关联（task.course_id）

### 2. 多任务支持
- 课程下可以有多个任务
- 任务按 task_order 排序

### 3. 自定义配置
- 操作积分可配置（operation.points）
- 测试题积分可配置（question.points）
- 徽章解锁条件可配置（badge.unlock_condition JSON）

### 4. 数据导入工具
- 提供 Markdown 文件解析导入工具
- 可扩展为支持其他格式（JSON, Excel等）

## 📝 开发规范

### 前端代码规范
- 组件命名：PascalCase
- 文件命名：PascalCase.vue
- 变量命名：camelCase
- 常量命名：UPPER_SNAKE_CASE

### 后端代码规范
- 函数命名：snake_case
- 类命名：PascalCase
- 常量命名：UPPER_SNAKE_CASE
- API路由：使用RESTful风格

### Git提交规范
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 重构
- test: 测试相关

## 🎯 未来优化方向

### 短期优化
1. 添加后台管理界面
2. 完善数据导入工具
3. 添加数据导出功能
4. 优化移动端适配

### 长期优化
1. 集成AI助教功能
2. 添加协作学习功能
3. 支持视频教程嵌入
4. 实现自动评分系统
5. 开发排行榜功能

---

**设计完成时间**: 2025年
**设计者**: Claude Code
**版本**: 1.0.0
